<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#00FFE7" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Son1kVers3" />
  <link rel="manifest" href="/manifest.json" />
  <title>Son1kVers3 — La Resistencia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui'] },
          colors: { 
            neon: '#00FFE7', 
            coal: '#0B0B0F', 
            haze: '#0f111a',
            'neon-purple': '#8b5cf6',
            'neon-blue': '#06b6d4' 
          },
          boxShadow: { glow: '0 0 40px rgba(0,255,231,.25)' }
        }
      }
    }
  </script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { background: #0f111a !important; height: 100%; }
    body { background: #0f111a !important; color: #e4e4e7 !important; font-family: Inter, ui-sans-serif, system-ui !important; min-height: 100vh; }
    
    /* Layout System */
    .app-container {
      display: grid;
      grid-template-rows: auto 1fr;
      min-height: 100vh;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .main-grid {
      display: grid;
      grid-template-columns: 300px 1fr 300px;
      gap: 1.5rem;
      padding: 1rem;
      min-height: calc(100vh - 80px);
    }
    
    .sidebar { 
      background: rgba(15, 17, 26, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
      height: fit-content;
      position: sticky;
      top: 1rem;
    }
    
    .main-content {
      background: rgba(15, 17, 26, 0.9);
      border: 1px solid rgba(0, 255, 231, 0.2);
      border-radius: 16px;
      padding: 2rem;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 30px rgba(0, 255, 231, 0.1);
      min-height: 600px;
    }
    
    /* Navigation */
    .nav-bar {
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.75rem 1rem;
      position: sticky;
      top: 0;
      z-index: 50;
    }
    
    .nav-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .nav-tabs {
      display: flex;
      gap: 0.5rem;
    }
    
    .nav-tab {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e4e4e7;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.875rem;
    }
    
    .nav-tab:hover {
      background: rgba(0, 255, 231, 0.1);
      border-color: rgba(0, 255, 231, 0.3);
    }
    
    .nav-tab.active {
      background: linear-gradient(45deg, #00FFE7, #8b5cf6);
      color: #000;
      border-color: #00FFE7;
    }
    
    /* Controls */
    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .control-item {
      text-align: center;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Vintage Hardware Knobs - Analog Obsession Style */
    .knob { 
      width: 80px; 
      height: 80px; 
      border-radius: 50%; 
      position: relative; 
      background: 
        radial-gradient(circle at 20% 20%, #6a6a6a, #2a2a2a),
        linear-gradient(145deg, #4a4a4a, #1a1a1a);
      box-shadow: 
        inset 0 3px 6px rgba(255,255,255,0.15),
        inset 0 -3px 6px rgba(0,0,0,0.4),
        0 2px 8px rgba(0,0,0,0.8),
        0 0 0 2px #333,
        0 0 0 3px #555;
      transition: all 0.1s ease;
      border: 1px solid #666;
      margin: 0 auto 0.5rem;
      cursor: pointer;
      overflow: hidden;
    }
    
    /* Knob wear effects */
    .knob::before {
      content: '';
      position: absolute;
      top: 6px;
      left: 6px;
      right: 6px;
      bottom: 6px;
      border-radius: 50%;
      background: 
        radial-gradient(circle at 30% 30%, #7a7a7a, #3a3a3a),
        linear-gradient(145deg, #5a5a5a, #2a2a2a);
      box-shadow: 
        inset 0 2px 4px rgba(255,255,255,0.2),
        inset 0 -2px 4px rgba(0,0,0,0.4),
        0 1px 2px rgba(0,0,0,0.6);
    }
    
    /* Knob scratches and wear */
    .knob .knob-wear {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
      pointer-events: none;
    }
    
    .knob .knob-wear::before {
      content: '';
      position: absolute;
      top: 20%;
      left: 15%;
      width: 30%;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: rotate(-15deg);
    }
    
    .knob .knob-wear::after {
      content: '';
      position: absolute;
      bottom: 25%;
      right: 20%;
      width: 25%;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(0,0,0,0.2), transparent);
      transform: rotate(10deg);
    }

    /* Floating Player Styles */
    #floatingPlayer {
      backdrop-filter: blur(10px);
      background: rgba(17, 24, 39, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.3);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }

    #floatingPlayer:hover {
      transform: translateY(-2px);
      box-shadow: 0 32px 64px -12px rgba(0, 0, 0, 0.6);
    }

    #progressBar {
      background: linear-gradient(90deg, #374151, #4B5563);
      border-radius: 4px;
      overflow: hidden;
    }

    #progressFill {
      background: linear-gradient(90deg, #8B5CF6, #EC4899);
      border-radius: 4px;
      transition: width 0.1s ease;
    }

    #volumeSlider {
      background: linear-gradient(90deg, #374151, #4B5563);
      border-radius: 4px;
      outline: none;
    }

    #volumeSlider::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      background: linear-gradient(45deg, #8B5CF6, #EC4899);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    #volumeSlider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      background: linear-gradient(45deg, #8B5CF6, #EC4899);
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .track-item {
      transition: all 0.2s ease;
    }

    .track-item:hover {
      background: rgba(75, 85, 99, 0.5);
      transform: translateX(4px);
    }

    .track-item.active {
      background: rgba(139, 92, 246, 0.2);
      border-left: 3px solid #8B5CF6;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 1; }
    }

    .waveform-bar {
      animation: pulse 0.5s ease-in-out infinite alternate;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      #floatingPlayer {
        bottom: 1rem;
        right: 1rem;
        left: 1rem;
        min-width: auto;
        max-width: none;
      }
    }
    
    .knob:hover { 
      transform: scale(1.05); 
      box-shadow: 
        inset 0 3px 6px rgba(255,255,255,0.2),
        inset 0 -3px 6px rgba(0,0,0,0.5),
        0 4px 12px rgba(0,0,0,0.9),
        0 0 0 2px #444,
        0 0 0 3px #666,
        0 0 15px rgba(0,255,231,0.3); 
    }
    
    .knob::before {
      content: '';
      position: absolute;
      top: 6px;
      left: 6px;
      right: 6px;
      bottom: 6px;
      border-radius: 50%;
      background: 
        radial-gradient(circle at 30% 30%, #7a7a7a, #3a3a3a),
        linear-gradient(145deg, #5a5a5a, #2a2a2a);
      box-shadow: 
        inset 0 2px 4px rgba(255,255,255,0.2),
        inset 0 -2px 4px rgba(0,0,0,0.4),
        0 1px 2px rgba(0,0,0,0.6);
    }
    
    .knob::after { 
      content: ''; 
      position: absolute; 
      left: 50%; 
      top: 8px; 
      width: 2px; 
      height: 28px; 
      background: linear-gradient(to bottom, #ffffff, #cccccc); 
      transform: translateX(-50%) rotate(var(--rotation, 0deg)); 
      transform-origin: center bottom; 
      border-radius: 1px;
      box-shadow: 
        0 0 4px rgba(255,255,255,0.8),
        0 0 1px rgba(0,0,0,0.5);
      z-index: 3;
      transition: transform 0.1s ease;
    }
    
    /* Knob scale markings */
    .knob-scale {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
      pointer-events: none;
    }
    
    .knob-scale::before {
      content: '';
      position: absolute;
      top: 4px;
      left: 4px;
      right: 4px;
      bottom: 4px;
      border-radius: 50%;
      background: conic-gradient(
        from 0deg,
        transparent 0deg,
        transparent 45deg,
        rgba(255,255,255,0.3) 45deg,
        rgba(255,255,255,0.3) 315deg,
        transparent 315deg
      );
    }
    
    /* Knob value display */
    .knob-value {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Courier New', monospace;
      font-size: 10px;
      color: #00ff88;
      text-shadow: 0 0 4px rgba(0,255,136,0.5);
      font-weight: bold;
    }
    
    /* SSL EQ Module */
    .ssl-eq {
      background: 
        linear-gradient(145deg, #2a2a2a, #1a1a1a),
        radial-gradient(circle at 20% 20%, rgba(255,255,255,0.05), transparent);
      border: 2px solid #444;
      border-radius: 6px;
      padding: 16px;
      position: relative;
      overflow: hidden;
    }
    
    .ssl-eq::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        linear-gradient(45deg, 
          transparent 0%, 
          rgba(255,255,255,0.02) 25%, 
          transparent 50%, 
          rgba(0,0,0,0.1) 75%, 
          transparent 100%);
      pointer-events: none;
    }
    
    .ssl-eq h4 {
      color: #00ff88;
      text-shadow: 0 0 6px rgba(0,255,136,0.4);
      font-family: 'Courier New', monospace;
      font-weight: bold;
      letter-spacing: 1px;
      font-size: 12px;
      text-align: center;
      margin-bottom: 12px;
    }
    
    .eq-band {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .eq-band label {
      font-family: 'Courier New', monospace;
      font-size: 8px;
      color: #ccc;
      margin-bottom: 4px;
      text-transform: uppercase;
    }
    
    .eq-slider {
      width: 4px;
      height: 60px;
      background: linear-gradient(to bottom, #333, #666);
      border-radius: 2px;
      position: relative;
      cursor: pointer;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.5);
    }
    
    .eq-slider::before {
      content: '';
      position: absolute;
      left: -2px;
      right: -2px;
      top: 0;
      bottom: 0;
      background: linear-gradient(to bottom, #555, #222);
      border-radius: 3px;
      box-shadow: inset 0 1px 1px rgba(255,255,255,0.1);
    }
    
    .eq-slider::after {
      content: '';
      position: absolute;
      left: 50%;
      top: var(--eq-value, 50%);
      transform: translateX(-50%);
      width: 8px;
      height: 8px;
      background: linear-gradient(45deg, #00ff88, #00cc66);
      border-radius: 50%;
      box-shadow: 
        0 0 4px rgba(0,255,136,0.6),
        0 0 1px rgba(0,255,136,0.8);
      border: 1px solid #333;
    }
    
    .eq-slider:hover::after {
      box-shadow: 
        0 0 6px rgba(0,255,136,0.8),
        0 0 2px rgba(0,255,136,1);
    }
    
    .eq-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      align-items: end;
    }
    
    .eq-value {
      font-family: 'Courier New', monospace;
      font-size: 8px;
      color: #00ff88;
      text-align: center;
      margin-top: 4px;
    }
    
    /* Knob Value Indicators */
    .knob-indicators {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
    }
    
    .knob-indicators::before {
      content: '';
      position: absolute;
      top: 6px;
      left: 6px;
      right: 6px;
      bottom: 6px;
      border-radius: 50%;
      background: conic-gradient(
        from 0deg,
        transparent 0deg,
        transparent 45deg,
        rgba(0,255,231,0.3) 45deg,
        rgba(0,255,231,0.3) 315deg,
        transparent 315deg
      );
    }
    
    /* Vintage Hardware Panels - Analog Obsession Style */
    .vintage-panel {
      background: 
        linear-gradient(145deg, #3a3a3a, #1a1a1a),
        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.08), transparent);
      border: 3px solid #555;
      border-radius: 4px;
      box-shadow: 
        inset 0 3px 6px rgba(255,255,255,0.15),
        inset 0 -3px 6px rgba(0,0,0,0.4),
        0 6px 16px rgba(0,0,0,0.8),
        0 0 0 1px #666;
      position: relative;
      overflow: hidden;
    }
    
    /* Panel corner screws */
    .vintage-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 2px;
      background: 
        linear-gradient(45deg, 
          transparent 0%, 
          rgba(255,255,255,0.03) 25%, 
          transparent 50%, 
          rgba(0,0,0,0.15) 75%, 
          transparent 100%);
      pointer-events: none;
    }
    
    /* Corner screws */
    .vintage-panel::after {
      content: '';
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      bottom: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 2px;
      pointer-events: none;
    }
    
    /* Screw holes in corners */
    .vintage-panel .screw {
      position: absolute;
      width: 12px;
      height: 12px;
      background: 
        radial-gradient(circle at 30% 30%, #666, #333),
        linear-gradient(45deg, #555, #222);
      border-radius: 50%;
      box-shadow: 
        inset 0 1px 2px rgba(255,255,255,0.2),
        inset 0 -1px 2px rgba(0,0,0,0.4),
        0 1px 3px rgba(0,0,0,0.6);
    }
    
    .vintage-panel .screw::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      right: 2px;
      bottom: 2px;
      border-radius: 50%;
      background: 
        radial-gradient(circle at 30% 30%, #888, #444);
      box-shadow: 
        inset 0 1px 1px rgba(255,255,255,0.3);
    }
    
    .vintage-panel .screw::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: 
        linear-gradient(45deg, #aaa, #666);
      box-shadow: 
        inset 0 1px 1px rgba(255,255,255,0.4);
    }
    
    /* Screw positions */
    .vintage-panel .screw.top-left {
      top: 6px;
      left: 6px;
    }
    
    .vintage-panel .screw.top-right {
      top: 6px;
      right: 6px;
    }
    
    .vintage-panel .screw.bottom-left {
      bottom: 6px;
      left: 6px;
    }
    
    .vintage-panel .screw.bottom-right {
      bottom: 6px;
      right: 6px;
    }
    
    /* Wear and tear effects */
    .vintage-panel .wear {
      position: absolute;
      pointer-events: none;
    }
    
    .vintage-panel .wear.scratch-1 {
      top: 20%;
      left: 10%;
      width: 60%;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: rotate(-2deg);
    }
    
    .vintage-panel .wear.scratch-2 {
      top: 60%;
      right: 15%;
      width: 40%;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(0,0,0,0.3), transparent);
      transform: rotate(1deg);
    }
    
    .vintage-panel .wear.dent {
      top: 30%;
      right: 20%;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(0,0,0,0.4), transparent);
    }
    
    .vintage-panel .wear.fade {
      top: 0;
      left: 0;
      right: 0;
      height: 20px;
      background: linear-gradient(to bottom, rgba(255,255,255,0.05), transparent);
    }
    
    .vintage-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 2px;
      background: 
        linear-gradient(45deg, 
          transparent 0%, 
          rgba(255,255,255,0.03) 25%, 
          transparent 50%, 
          rgba(0,0,0,0.15) 75%, 
          transparent 100%);
      pointer-events: none;
    }
    
    .vintage-panel::after {
      content: '';
      position: absolute;
      top: 8px;
      left: 8px;
      right: 8px;
      bottom: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 2px;
      pointer-events: none;
    }
    
    .vintage-panel h3 {
      color: #00ff88;
      text-shadow: 0 0 6px rgba(0,255,136,0.4);
      font-family: 'Courier New', monospace;
      font-weight: bold;
      letter-spacing: 2px;
      font-size: 14px;
    }
    
    /* Vintage Control Labels */
    .control-item {
      text-align: center;
      padding: 8px;
    }
    
    .control-item p {
      color: #ccc;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      letter-spacing: 0.5px;
      margin: 4px 0;
    }
    
    .control-item .text-neon {
      color: #ffd700;
      font-weight: bold;
      text-shadow: 0 0 4px rgba(255,215,0,0.5);
    }
    
    /* Input Controls */
    .input-group {
      margin: 1rem 0;
    }
    
    .input-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #00FFE7;
    }
    
    .input-group textarea, .input-group input, .input-group select {
      width: 100%;
      padding: 0.75rem;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: #e4e4e7;
      font-size: 0.875rem;
      transition: border-color 0.2s ease;
    }
    
    .input-group textarea:focus, .input-group input:focus, .input-group select:focus {
      outline: none;
      border-color: #00FFE7;
      box-shadow: 0 0 0 3px rgba(0, 255, 231, 0.1);
    }
    
    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      font-size: 0.875rem;
    }
    
    .btn-primary {
      background: #00FFE7;
      color: #000;
    }
    
    .btn-primary:hover {
      background: rgba(0, 255, 231, 0.9);
      box-shadow: 0 0 20px rgba(0, 255, 231, 0.3);
    }
    
    .btn-secondary {
      background: transparent;
      color: #e4e4e7;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: #00FFE7;
    }
    
    /* Section Management */
    .section {
      display: none;
    }
    
    .section.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Responsive Design */
    @media (max-width: 1200px) {
      .main-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      .sidebar {
        order: 2;
        position: static;
      }
      .main-content {
        order: 1;
      }
    }
    
    @media (max-width: 768px) {
      .nav-tabs {
        flex-wrap: wrap;
        gap: 0.25rem;
      }
      .nav-tab {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
      }
      .controls-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      .knob {
        width: 70px;
        height: 70px;
      }
      
      .knob::before {
        top: 5px;
        left: 5px;
        right: 5px;
        bottom: 5px;
      }
      
      .knob::after {
        top: 7px;
        height: 24px;
      }
      
      .knob-value {
        font-size: 9px;
        bottom: -22px;
      }
    }
    
    /* Utility Classes */
    .text-neon { color: #00FFE7 !important; }
    .text-purple { color: #8b5cf6 !important; }
    
    /* Vintage Console Buttons */
    .console-button {
      background: 
        linear-gradient(145deg, #2a2a2a, #1a1a1a),
        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.05), transparent);
      border: 2px solid #444;
      border-radius: 4px;
      padding: 12px 20px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #ccc;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
      box-shadow: 
        inset 0 2px 4px rgba(255,255,255,0.1),
        inset 0 -2px 4px rgba(0,0,0,0.3),
        0 2px 8px rgba(0,0,0,0.6);
      overflow: hidden;
    }
    
    .console-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        linear-gradient(45deg, 
          transparent 0%, 
          rgba(255,255,255,0.02) 25%, 
          transparent 50%, 
          rgba(0,0,0,0.1) 75%, 
          transparent 100%);
      pointer-events: none;
    }
    
    .console-button::after {
      content: '';
      position: absolute;
      top: 4px;
      left: 4px;
      right: 4px;
      bottom: 4px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 2px;
      pointer-events: none;
    }
    
    .console-button:hover {
      transform: translateY(-1px);
      box-shadow: 
        inset 0 2px 4px rgba(255,255,255,0.15),
        inset 0 -2px 4px rgba(0,0,0,0.4),
        0 4px 12px rgba(0,0,0,0.8);
      color: #fff;
    }
    
    .console-button:active {
      transform: translateY(0);
      box-shadow: 
        inset 0 2px 4px rgba(0,0,0,0.4),
        inset 0 -2px 4px rgba(255,255,255,0.1);
    }
    
    /* Red Console Button (Active State) */
    .console-button.red {
      background: 
        linear-gradient(145deg, #4a1a1a, #2a0a0a),
        radial-gradient(circle at 30% 30%, rgba(255,0,0,0.1), transparent);
      border-color: #666;
      color: #ff6666;
      box-shadow: 
        inset 0 2px 4px rgba(255,0,0,0.2),
        inset 0 -2px 4px rgba(0,0,0,0.4),
        0 2px 8px rgba(255,0,0,0.3),
        0 0 20px rgba(255,0,0,0.2);
    }
    
    .console-button.red:hover {
      color: #ff9999;
      box-shadow: 
        inset 0 2px 4px rgba(255,0,0,0.3),
        inset 0 -2px 4px rgba(0,0,0,0.5),
        0 4px 12px rgba(255,0,0,0.4),
        0 0 25px rgba(255,0,0,0.3);
    }
    
    .console-button.red.active {
      background: 
        linear-gradient(145deg, #6a2a2a, #4a1a1a),
        radial-gradient(circle at 30% 30%, rgba(255,0,0,0.2), transparent);
      color: #ffaaaa;
      box-shadow: 
        inset 0 2px 4px rgba(255,0,0,0.4),
        inset 0 -2px 4px rgba(0,0,0,0.3),
        0 2px 8px rgba(255,0,0,0.5),
        0 0 30px rgba(255,0,0,0.4);
      animation: pulse-red 2s infinite;
    }
    
    @keyframes pulse-red {
      0%, 100% { 
        box-shadow: 
          inset 0 2px 4px rgba(255,0,0,0.4),
          inset 0 -2px 4px rgba(0,0,0,0.3),
          0 2px 8px rgba(255,0,0,0.5),
          0 0 30px rgba(255,0,0,0.4);
      }
      50% { 
        box-shadow: 
          inset 0 2px 4px rgba(255,0,0,0.6),
          inset 0 -2px 4px rgba(0,0,0,0.2),
          0 2px 8px rgba(255,0,0,0.7),
          0 0 40px rgba(255,0,0,0.6);
      }
    }
    
    /* Green Console Button (Active State) */
    .console-button.green {
      background: 
        linear-gradient(145deg, #1a4a1a, #0a2a0a),
        radial-gradient(circle at 30% 30%, rgba(0,255,0,0.1), transparent);
      border-color: #666;
      color: #66ff66;
      box-shadow: 
        inset 0 2px 4px rgba(0,255,0,0.2),
        inset 0 -2px 4px rgba(0,0,0,0.4),
        0 2px 8px rgba(0,255,0,0.3),
        0 0 20px rgba(0,255,0,0.2);
    }
    
    .console-button.green:hover {
      color: #99ff99;
      box-shadow: 
        inset 0 2px 4px rgba(0,255,0,0.3),
        inset 0 -2px 4px rgba(0,0,0,0.5),
        0 4px 12px rgba(0,255,0,0.4),
        0 0 25px rgba(0,255,0,0.3);
    }
    
    .console-button.green.active {
      background: 
        linear-gradient(145deg, #2a6a2a, #1a4a1a),
        radial-gradient(circle at 30% 30%, rgba(0,255,0,0.2), transparent);
      color: #aaffaa;
      box-shadow: 
        inset 0 2px 4px rgba(0,255,0,0.4),
        inset 0 -2px 4px rgba(0,0,0,0.3),
        0 2px 8px rgba(0,255,0,0.5),
        0 0 30px rgba(0,255,0,0.4);
      animation: pulse-green 2s infinite;
    }
    
    @keyframes pulse-green {
      0%, 100% { 
        box-shadow: 
          inset 0 2px 4px rgba(0,255,0,0.4),
          inset 0 -2px 4px rgba(0,0,0,0.3),
          0 2px 8px rgba(0,255,0,0.5),
          0 0 30px rgba(0,255,0,0.4);
      }
      50% { 
        box-shadow: 
          inset 0 2px 4px rgba(0,255,0,0.6),
          inset 0 -2px 4px rgba(0,0,0,0.2),
          0 2px 8px rgba(0,255,0,0.7),
          0 0 40px rgba(0,255,0,0.6);
      }
    }
    
    /* Blue Console Button (Active State) */
    .console-button.blue {
      background: 
        linear-gradient(145deg, #1a1a4a, #0a0a2a),
        radial-gradient(circle at 30% 30%, rgba(0,0,255,0.1), transparent);
      border-color: #666;
      color: #6666ff;
      box-shadow: 
        inset 0 2px 4px rgba(0,0,255,0.2),
        inset 0 -2px 4px rgba(0,0,0,0.4),
        0 2px 8px rgba(0,0,255,0.3),
        0 0 20px rgba(0,0,255,0.2);
    }
    
    .console-button.blue:hover {
      color: #9999ff;
      box-shadow: 
        inset 0 2px 4px rgba(0,0,255,0.3),
        inset 0 -2px 4px rgba(0,0,0,0.5),
        0 4px 12px rgba(0,0,255,0.4),
        0 0 25px rgba(0,0,255,0.3);
    }
    
    .console-button.blue.active {
      background: 
        linear-gradient(145deg, #2a2a6a, #1a1a4a),
        radial-gradient(circle at 30% 30%, rgba(0,0,255,0.2), transparent);
      color: #aaaaff;
      box-shadow: 
        inset 0 2px 4px rgba(0,0,255,0.4),
        inset 0 -2px 4px rgba(0,0,0,0.3),
        0 2px 8px rgba(0,0,255,0.5),
        0 0 30px rgba(0,0,255,0.4);
      animation: pulse-blue 2s infinite;
    }
    
    @keyframes pulse-blue {
      0%, 100% { 
        box-shadow: 
          inset 0 2px 4px rgba(0,0,255,0.4),
          inset 0 -2px 4px rgba(0,0,0,0.3),
          0 2px 8px rgba(0,0,255,0.5),
          0 0 30px rgba(0,0,255,0.4);
      }
      50% { 
        box-shadow: 
          inset 0 2px 4px rgba(0,0,255,0.6),
          inset 0 -2px 4px rgba(0,0,0,0.2),
          0 2px 8px rgba(0,0,255,0.7),
          0 0 40px rgba(0,0,255,0.6);
      }
    }
    
    /* Orange Console Button (Active State) */
    .console-button.orange {
      background: 
        linear-gradient(145deg, #4a3a1a, #2a1a0a),
        radial-gradient(circle at 30% 30%, rgba(255,165,0,0.1), transparent);
      border-color: #666;
      color: #ffaa66;
      box-shadow: 
        inset 0 2px 4px rgba(255,165,0,0.2),
        inset 0 -2px 4px rgba(0,0,0,0.4),
        0 2px 8px rgba(255,165,0,0.3),
        0 0 20px rgba(255,165,0,0.2);
    }
    
    .console-button.orange:hover {
      color: #ffcc99;
      box-shadow: 
        inset 0 2px 4px rgba(255,165,0,0.3),
        inset 0 -2px 4px rgba(0,0,0,0.5),
        0 4px 12px rgba(255,165,0,0.4),
        0 0 25px rgba(255,165,0,0.3);
    }
    
    .console-button.orange.active {
      background: 
        linear-gradient(145deg, #6a4a2a, #4a3a1a),
        radial-gradient(circle at 30% 30%, rgba(255,165,0,0.2), transparent);
      color: #ffdd99;
      box-shadow: 
        inset 0 2px 4px rgba(255,165,0,0.4),
        inset 0 -2px 4px rgba(0,0,0,0.3),
        0 2px 8px rgba(255,165,0,0.5),
        0 0 30px rgba(255,165,0,0.4);
      animation: pulse-orange 2s infinite;
    }
    
    @keyframes pulse-orange {
      0%, 100% { 
        box-shadow: 
          inset 0 2px 4px rgba(255,165,0,0.4),
          inset 0 -2px 4px rgba(0,0,0,0.3),
          0 2px 8px rgba(255,165,0,0.5),
          0 0 30px rgba(255,165,0,0.4);
      }
      50% { 
        box-shadow: 
          inset 0 2px 4px rgba(255,165,0,0.6),
          inset 0 -2px 4px rgba(0,0,0,0.2),
          0 2px 8px rgba(255,165,0,0.7),
          0 0 40px rgba(255,165,0,0.6);
      }
    }
    .text-zinc { color: #a1a1aa !important; }
    .bg-neon { background-color: #00FFE7 !important; }
    .hidden { display: none !important; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .space-y-2 > * + * { margin-top: 0.5rem; }
    .text-center { text-align: center; }
    .font-bold { font-weight: 700; }
    .text-lg { font-size: 1.125rem; }
    .text-xl { font-size: 1.25rem; }
    .text-2xl { font-size: 1.5rem; }
    .text-3xl { font-size: 1.875rem; }
    .text-sm { font-size: 0.875rem; }
    .text-xs { font-size: 0.75rem; }
    .mt-4 { margin-top: 1rem; }
    .mb-4 { margin-bottom: 1rem; }
    .p-4 { padding: 1rem; }
    .rounded { border-radius: 0.5rem; }
  </style>
</head>

<body>
  <div class="app-container">
    <!-- NAVIGATION -->
    <nav class="nav-bar">
      <div class="nav-content">
        <div class="flex items-center space-x-3">
          <div style="width: 32px; height: 32px; background: linear-gradient(45deg, #00FFE7, #8b5cf6); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 12px; font-weight: bold; color: black;">S3</span>
          </div>
          <span class="text-xl font-bold text-neon">SON1KVERS3</span>
        </div>
        
        <div class="nav-tabs">
          <button class="nav-tab active" data-section="home">Historia</button>
          <button class="nav-tab" data-section="ghost-studio">Ghost Studio</button>
          <button class="nav-tab" data-section="clone-station">Clone Station</button>
          <button class="nav-tab" data-section="nova-post-pilot">NPP</button>
          <button class="nav-tab" data-section="nexus">NEXUS</button>
          <button class="nav-tab" data-section="generacion">Generación</button>
          <button class="nav-tab" data-section="archivo">Archivo</button>
          <button class="nav-tab" data-section="santuario">Santuario</button>
          <button class="nav-tab" data-section="planes">Planes</button>
        </div>
        
        <div class="flex items-center gap-3">
          <div class="text-sm">
            <div class="text-zinc">Plan: <span class="text-neon" id="userPlan">Free</span></div>
            <div class="text-zinc">Pistas: <span id="userTracks">0</span>/<span class="text-neon" id="userLimit">3</span></div>
          </div>
          <button id="loginBtn" class="btn btn-primary text-sm">Iniciar Sesión</button>
        </div>
      </div>
    </nav>

    <!-- MAIN CONTENT GRID -->
    <div class="main-grid">
      <!-- LEFT SIDEBAR -->
      <div class="sidebar">
        <div class="space-y-4">
          <h3 class="text-neon font-bold text-lg">LA RESISTENCIA</h3>
          
          <!-- User Info -->
          <div class="space-y-2">
            <div class="text-sm">
              <div class="text-zinc">Estado: <span class="text-neon">Activo</span></div>
              <div class="text-zinc">Sesión: <span class="text-neon">Conectado</span></div>
            </div>
          </div>
          
          <!-- Audio Visualizer -->
          <div class="p-4 bg-black/30 rounded">
            <h4 class="text-neon text-sm font-bold mb-2">Visualizador</h4>
            <canvas id="visualizerCanvas" width="200" height="60" style="width: 100%; height: 60px; background: rgba(0,0,0,0.5); border-radius: 4px;"></canvas>
          </div>
          
          <!-- System Status -->
          <div class="p-4 bg-black/30 rounded">
            <h4 class="text-neon text-sm font-bold mb-2">Sistema</h4>
            <div class="space-y-1 text-xs">
              <div class="flex justify-between">
                <span>NOV4-IX Engine:</span>
                <span class="text-green-400">●</span>
              </div>
              <div class="flex justify-between">
                <span>Resistencia AI:</span>
                <span class="text-green-400">●</span>
              </div>
              <div class="flex justify-between">
                <span>Storage:</span>
                <span class="text-green-400">●</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CENTER CONTENT -->
      <div class="main-content">
        <!-- HOME SECTION -->
        <section id="home" class="section active">
          <div class="text-center space-y-4">
            <div class="space-y-2">
              <p class="text-sm text-zinc uppercase tracking-wider">LA RESISTENCIA</p>
              <h1 class="text-3xl md:text-4xl font-bold">
                Lo imperfecto también<br>
                <span class="text-neon">es sagrado</span>
              </h1>
              <h2 class="text-lg text-zinc">
                Componer con alma en un mundo de máquinas.
              </h2>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-3 justify-center mt-6">
              <button id="entrarEstudio" class="btn btn-primary">Entrar al Estudio</button>
              <button id="conocerUniverso" class="btn btn-secondary" data-clicks="0">Conocer el Universo</button>
            </div>
            
            <p class="text-sm text-zinc max-w-lg mx-auto mt-4">
              Genera música, clona voces cantadas, mezcla con calidad de estudio y guarda tu proceso en un archivo vivo. Bienvenido al Estudio Fantasma.
            </p>
          </div>
          
          <!-- Expression Controls -->
          <div class="vintage-panel mt-8 p-6">
            <!-- Corner screws -->
            <div class="screw top-left"></div>
            <div class="screw top-right"></div>
            <div class="screw bottom-left"></div>
            <div class="screw bottom-right"></div>
            
            <!-- Wear effects -->
            <div class="wear scratch-1"></div>
            <div class="wear scratch-2"></div>
            <div class="wear dent"></div>
            <div class="wear fade"></div>
            
            <h3 class="text-lg font-bold text-center mb-6">EXPRESSION CONTROLS</h3>
            <div class="controls-grid">
              <div class="control-item">
                <div class="knob" data-knob="expresividad" data-value="75">
                  <div class="knob-scale"></div>
                  <div class="knob-wear"></div>
                  <div class="knob-value" id="expresividadDisplay">75%</div>
                </div>
                <p class="text-sm text-zinc font-mono">EXPRESSION</p>
              </div>
              <div class="control-item">
                <div class="knob" data-knob="rareza" data-value="60">
                  <div class="knob-scale"></div>
                  <div class="knob-wear"></div>
                  <div class="knob-value" id="rarezaDisplay">60%</div>
                </div>
                <p class="text-sm text-zinc font-mono">RAREZA</p>
              </div>
              <div class="control-item">
                <div class="knob" data-knob="garage" data-value="80">
                  <div class="knob-scale"></div>
                  <div class="knob-wear"></div>
                  <div class="knob-value" id="garageDisplay">80%</div>
                </div>
                <p class="text-sm text-zinc font-mono">GARAGE</p>
              </div>
            </div>
          </div>
    </section>

    <!-- NEXUS SECTION -->
    <section id="nexus" class="hidden">
      <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
          <h2 class="text-4xl font-bold text-cyan-400 mb-4 font-mono">NEXUS</h2>
          <p class="text-center text-amber-300 mb-2 font-mono">Resistance Command Center - Advanced AI Operations</p>
          <div class="text-center mb-6">
            <span class="text-red-400 font-mono text-sm">NEXUS ACTIVE</span>
          </div>
        </div>

        <!-- Resistance Status -->
        <div class="vintage-panel mb-8" id="resistanceStatus">
          <div class="screw screw-tl"></div>
          <div class="screw screw-tr"></div>
          <div class="screw screw-bl"></div>
          <div class="screw screw-br"></div>
          <div class="wear wear-tl"></div>
          <div class="wear wear-tr"></div>
          <div class="wear wear-bl"></div>
          <div class="wear wear-br"></div>
          
          <h3 class="text-xl font-bold mb-6 text-red-400 font-mono">RESISTANCE STATUS</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <!-- System Status -->
            <div class="bg-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-white mb-3">System Status</h4>
              <div class="space-y-2 text-sm text-gray-300">
                <div>PIXEL AI: <span id="pixelStatus" class="text-green-400">ONLINE</span></div>
                <div>Neural Network: <span id="neuralStatus" class="text-green-400">ACTIVE</span></div>
                <div>Quantum Core: <span id="quantumStatus" class="text-green-400">STABLE</span></div>
                <div>Resistance Protocol: <span id="resistanceProtocol" class="text-red-400">ENABLED</span></div>
              </div>
            </div>

            <!-- Mission Status -->
            <div class="bg-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-white mb-3">Mission Status</h4>
              <div class="space-y-2 text-sm text-gray-300">
                <div>Active Missions: <span id="activeMissions" class="text-cyan-400">3</span></div>
                <div>Completed: <span id="completedMissions" class="text-green-400">127</span></div>
                <div>Success Rate: <span id="successRate" class="text-green-400">94.2%</span></div>
                <div>Threat Level: <span id="threatLevel" class="text-yellow-400">MODERATE</span></div>
              </div>
            </div>

            <!-- AI Performance -->
            <div class="bg-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-white mb-3">AI Performance</h4>
              <div class="space-y-2 text-sm text-gray-300">
                <div>Response Time: <span id="responseTime" class="text-green-400">0.3s</span></div>
                <div>Accuracy: <span id="accuracy" class="text-green-400">98.7%</span></div>
                <div>Learning Rate: <span id="learningRate" class="text-cyan-400">+12.3%</span></div>
                <div>Memory Usage: <span id="memoryUsage" class="text-yellow-400">67%</span></div>
              </div>
            </div>
          </div>
        </div>

        <!-- PIXEL AI Interface -->
        <div class="vintage-panel mb-8" id="pixelInterface">
          <div class="screw screw-tl"></div>
          <div class="screw screw-tr"></div>
          <div class="screw screw-bl"></div>
          <div class="screw screw-br"></div>
          <div class="wear wear-tl"></div>
          <div class="wear wear-tr"></div>
          <div class="wear wear-bl"></div>
          <div class="wear wear-br"></div>
          
          <h3 class="text-xl font-bold mb-6 text-cyan-400 font-mono">PIXEL AI INTERFACE</h3>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Chat Interface -->
            <div class="bg-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-white mb-3">Direct Communication</h4>
              <div id="nexusChat" class="h-64 overflow-y-auto bg-black rounded p-3 mb-3 font-mono text-sm text-green-400 border border-gray-600">
                <div class="text-cyan-400">PIXEL: Resistance protocols activated. How can I assist you today?</div>
              </div>
              <div class="flex space-x-2">
                <input type="text" id="nexusInput" placeholder="Enter command..." class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                <button id="nexusSend" class="console-button cyan">SEND</button>
              </div>
            </div>

            <!-- AI Commands -->
            <div class="bg-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-white mb-3">AI Commands</h4>
              <div class="space-y-2">
                <button id="analyzeThreats" class="console-button red w-full">ANALYZE THREATS</button>
                <button id="optimizeSystems" class="console-button blue w-full">OPTIMIZE SYSTEMS</button>
                <button id="generateStrategy" class="console-button green w-full">GENERATE STRATEGY</button>
                <button id="scanNetwork" class="console-button orange w-full">SCAN NETWORK</button>
                <button id="deployCountermeasures" class="console-button red w-full">DEPLOY COUNTERMEASURES</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Advanced Operations -->
        <div class="vintage-panel mb-8" id="advancedOps">
          <div class="screw screw-tl"></div>
          <div class="screw screw-tr"></div>
          <div class="screw screw-bl"></div>
          <div class="screw screw-br"></div>
          <div class="wear wear-tl"></div>
          <div class="wear wear-tr"></div>
          <div class="wear wear-bl"></div>
          <div class="wear wear-br"></div>
          
          <h3 class="text-xl font-bold mb-6 text-red-400 font-mono">ADVANCED OPERATIONS</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Neural Enhancement -->
            <div class="bg-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-white mb-3">Neural Enhancement</h4>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm text-gray-300 mb-1">Processing Power</label>
                  <input type="range" id="processingPower" min="0" max="100" value="75" class="w-full">
                  <div class="text-xs text-gray-400">Current: <span id="processingValue">75%</span></div>
                </div>
                <div>
                  <label class="block text-sm text-gray-300 mb-1">Memory Allocation</label>
                  <input type="range" id="memoryAllocation" min="0" max="100" value="60" class="w-full">
                  <div class="text-xs text-gray-400">Current: <span id="memoryValue">60%</span></div>
                </div>
                <button id="applyEnhancement" class="console-button cyan w-full">APPLY ENHANCEMENT</button>
              </div>
            </div>

            <!-- Quantum Analysis -->
            <div class="bg-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-white mb-3">Quantum Analysis</h4>
              <div class="space-y-3">
                <div>
                  <label class="block text-sm text-gray-300 mb-1">Analysis Depth</label>
                  <select id="analysisDepth" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                    <option value="basic">Basic Scan</option>
                    <option value="advanced">Advanced Analysis</option>
                    <option value="quantum">Quantum Deep Dive</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm text-gray-300 mb-1">Target System</label>
                  <select id="targetSystem" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                    <option value="music">Music Generation</option>
                    <option value="content">Content Creation</option>
                    <option value="social">Social Media</option>
                    <option value="all">All Systems</option>
                  </select>
                </div>
                <button id="startAnalysis" class="console-button blue w-full">START ANALYSIS</button>
              </div>
            </div>

            <!-- Resistance Protocols -->
            <div class="bg-gray-800 rounded-lg p-4">
              <h4 class="font-semibold text-white mb-3">Resistance Protocols</h4>
              <div class="space-y-3">
                <label class="flex items-center">
                  <input type="checkbox" id="stealthMode" class="mr-2">
                  <span class="text-sm text-gray-300">Stealth Mode</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="encryption" class="mr-2">
                  <span class="text-sm text-gray-300">Advanced Encryption</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="counterSurveillance" class="mr-2">
                  <span class="text-sm text-gray-300">Counter-Surveillance</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" id="neuralFirewall" class="mr-2">
                  <span class="text-sm text-gray-300">Neural Firewall</span>
                </label>
                <button id="activateProtocols" class="console-button red w-full">ACTIVATE PROTOCOLS</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Mission Log -->
        <div class="vintage-panel mb-8" id="missionLog">
          <div class="screw screw-tl"></div>
          <div class="screw screw-tr"></div>
          <div class="screw screw-bl"></div>
          <div class="screw screw-br"></div>
          <div class="wear wear-tl"></div>
          <div class="wear wear-tr"></div>
          <div class="wear wear-bl"></div>
          <div class="wear wear-br"></div>
          
          <h3 class="text-xl font-bold mb-6 text-yellow-400 font-mono">MISSION LOG</h3>
          
          <div id="missionLogContent" class="h-64 overflow-y-auto bg-black rounded p-3 font-mono text-sm text-green-400 border border-gray-600">
            <div class="text-cyan-400">[2024-12-19 15:30:42] NEXUS: System initialized</div>
            <div class="text-green-400">[2024-12-19 15:30:43] PIXEL: AI core online</div>
            <div class="text-yellow-400">[2024-12-19 15:30:44] RESISTANCE: Protocols loaded</div>
            <div class="text-cyan-400">[2024-12-19 15:30:45] NEXUS: Ready for operations</div>
          </div>
        </div>
      </div>
    </section>

    <!-- GENERATION SECTION -->
        <section id="generacion" class="section">
          <div class="space-y-6">
            <div class="vintage-panel p-8">
              <h2 class="text-2xl font-bold text-center mb-8">MUSIC GENERATION CONSOLE</h2>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="input-group">
                  <label for="letraCancion" class="block text-sm font-medium text-amber-300 mb-2 font-mono">LYRICS INPUT</label>
                  <textarea id="letraCancion" rows="4" 
                    class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white placeholder-zinc-400 focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm"
                    placeholder="Enter your song lyrics here..."></textarea>
                </div>
                
                <div class="input-group">
                  <label for="promptEstilo" class="block text-sm font-medium text-amber-300 mb-2 font-mono">STYLE PROMPT</label>
                  <input type="text" id="promptEstilo" 
                    class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white placeholder-zinc-400 focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm"
                    placeholder="e.g: alternative rock, electric guitar, powerful drums">
                </div>
              </div>
              
              <div class="input-group mb-8">
                <label for="presetGeneracion" class="block text-sm font-medium text-amber-300 mb-2 font-mono">GENERATION PRESET</label>
                <select id="presetGeneracion" 
                  class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm">
                  <option value="profesional">PROFESSIONAL</option>
                  <option value="experimental">EXPERIMENTAL</option>
                  <option value="clasico">CLASSIC</option>
                  <option value="moderno">MODERN</option>
                </select>
              </div>
              
              <!-- Generation Controls -->
              <div class="vintage-panel p-6 mb-8">
                <!-- Corner screws -->
                <div class="screw top-left"></div>
                <div class="screw top-right"></div>
                <div class="screw bottom-left"></div>
                <div class="screw bottom-right"></div>
                
                <!-- Wear effects -->
                <div class="wear scratch-1"></div>
                <div class="wear scratch-2"></div>
                <div class="wear dent"></div>
                <div class="wear fade"></div>
                
                <h3 class="text-lg font-bold text-center mb-6">GENERATION PARAMETERS</h3>
                <div class="controls-grid">
                  <div class="control-item">
                    <div class="knob" data-knob="afinacion" data-value="60">
                      <div class="knob-scale"></div>
                      <div class="knob-wear"></div>
                      <div class="knob-value" id="afinacionDisplay">60%</div>
                    </div>
                    <p class="text-sm text-zinc font-mono">TUNING</p>
                  </div>
                  <div class="control-item">
                    <div class="knob" data-knob="expresividad-gen" data-value="75">
                      <div class="knob-scale"></div>
                      <div class="knob-wear"></div>
                      <div class="knob-value" id="expresividadGenDisplay">75%</div>
                    </div>
                    <p class="text-sm text-zinc font-mono">EXPRESSION</p>
                  </div>
                </div>
              </div>
              
              <div class="text-center">
                <button id="generarMusica" class="bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-black font-bold py-4 px-12 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 font-mono text-lg border-2 border-amber-400 relative">
                  ♫ GENERATE MUSIC
                  <div id="expressionStatus" class="absolute -top-2 -right-2 w-4 h-4 bg-green-500 rounded-full opacity-0 transition-opacity duration-300" title="Expression parameters active"></div>
                </button>
                <div class="mt-2 text-xs text-amber-400 font-mono">
                  Expression parameters will enhance your generation
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- GHOST STUDIO SECTION -->
        <section id="ghost-studio" class="section">
          <div class="space-y-6">
            <div class="vintage-panel p-8">
              <!-- Corner screws -->
              <div class="screw top-left"></div>
              <div class="screw top-right"></div>
              <div class="screw bottom-left"></div>
              <div class="screw bottom-right"></div>
              
              <!-- Wear effects -->
              <div class="wear scratch-1"></div>
              <div class="wear scratch-2"></div>
              <div class="wear dent"></div>
              <div class="wear fade"></div>
              
              <h2 class="text-2xl font-bold text-center mb-4">GHOST STUDIO</h2>
              <p class="text-center text-amber-300 mb-2 font-mono">Advanced AI Audio Transformation Console</p>
              <div class="text-center mb-6">
                <span id="wavesStatus" class="text-red-400 font-mono text-sm">WAVES OFFLINE</span>
              </div>
              
              <!-- Audio Drop Zone -->
              <div class="mb-8">
                <label class="block text-sm font-medium text-amber-300 mb-4 font-mono">AUDIO INPUT</label>
                <div id="audioDropZone" class="border-2 border-dashed border-amber-500/30 rounded-lg p-8 text-center hover:border-amber-400 transition-colors cursor-pointer bg-zinc-800/20">
                  <div class="text-4xl text-amber-400 mb-2">🎵</div>
                  <p class="text-amber-300 mb-2 font-mono">Arrastra tu archivo de audio aquí</p>
                  <p class="text-sm text-amber-500 font-mono">o haz clic para seleccionar</p>
                  <input type="file" id="audioFile" accept="audio/*" class="hidden">
                </div>
                <div id="analysisStatus" class="mt-2 text-xs text-amber-400 font-mono hidden">
                  <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-amber-400 rounded-full animate-pulse"></div>
                    <span>Analyzing audio...</span>
                  </div>
                </div>
                <div id="analysisResult" class="mt-2 text-xs text-green-400 font-mono hidden">
                  <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                    <span>Analysis complete - Prompt generated</span>
                  </div>
                </div>
              </div>
              
              <!-- Transform Prompt Input -->
              <div class="mb-8">
                <label for="transformPrompt" class="block text-sm font-medium text-amber-300 mb-2 font-mono">TRANSFORM PROMPT</label>
                <textarea id="transformPrompt" placeholder="Ej: Clonar voz, mastering profesional, reducción de ruido, etc." 
                  class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm h-20 resize-none"></textarea>
              </div>
              
              <!-- Action Buttons -->
              <div class="grid grid-cols-2 gap-4 mb-8">
                <button id="transformAudio" class="console-button red">
                  TRANSFORM
                </button>
                <button id="cloneVoice" class="console-button blue">
                  CLONE VOICE
                </button>
                <button id="mastering" class="console-button green">
                  MASTERING
                </button>
                <button id="noiseReduction" class="console-button orange">
                  NOISE REDUCTION
                </button>
              </div>
              
              <!-- Voice Cloning Panel -->
              <div class="vintage-panel p-6 mb-8">
                <!-- Corner screws -->
                <div class="screw top-left"></div>
                <div class="screw top-right"></div>
                <div class="screw bottom-left"></div>
                <div class="screw bottom-right"></div>
                
                <!-- Wear effects -->
                <div class="wear scratch-1"></div>
                <div class="wear scratch-2"></div>
                <div class="wear dent"></div>
                <div class="wear fade"></div>
                
                <h3 class="text-lg font-bold text-center mb-6">VOICE CLONING</h3>
                
                <!-- Voice Model Selection -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-amber-300 mb-2 font-mono">VOICE MODEL</label>
                  <select id="voiceModel" class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm">
                    <option value="huggingface-so-vits">so-VITS-SVC 4.0 (Free)</option>
                    <option value="huggingface-bark">Bark Voice Cloning (Free)</option>
                    <option value="elevenlabs-pro">ElevenLabs Pro (Premium)</option>
                    <option value="custom-enterprise">Custom Model (Enterprise)</option>
                  </select>
                </div>
                
                <!-- Voice Quality Settings -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                  <div>
                    <label class="block text-sm font-medium text-amber-300 mb-2 font-mono">QUALITY</label>
                    <select id="voiceQuality" class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm">
                      <option value="standard">Standard (8/10)</option>
                      <option value="high">High (8.5/10)</option>
                      <option value="premium">Premium (9.5/10)</option>
                      <option value="studio">Studio (10/10)</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-amber-300 mb-2 font-mono">DURATION</label>
                    <select id="voiceDuration" class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm">
                      <option value="30">30 seconds</option>
                      <option value="60">1 minute</option>
                      <option value="120">2 minutes</option>
                      <option value="300">5 minutes</option>
                      <option value="600">10 minutes</option>
                    </select>
                  </div>
                </div>
                
                <!-- Bark Specific Settings -->
                <div id="barkSettings" class="grid grid-cols-2 gap-4 mb-6 hidden">
                  <div>
                    <label class="block text-sm font-medium text-amber-300 mb-2 font-mono">EMOTION</label>
                    <select id="voiceEmotion" class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm">
                      <option value="neutral">Neutral</option>
                      <option value="happy">Happy</option>
                      <option value="sad">Sad</option>
                      <option value="excited">Excited</option>
                      <option value="angry">Angry</option>
                      <option value="whisper">Whisper</option>
                      <option value="shout">Shout</option>
                      <option value="sing">Sing</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-amber-300 mb-2 font-mono">VOICE PRESET</label>
                    <select id="voicePreset" class="w-full px-4 py-3 bg-zinc-800/50 border border-amber-500/30 rounded-lg text-white focus:border-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-400/20 font-mono text-sm">
                      <option value="v2/en_speaker_6">Neutral Voice</option>
                      <option value="v2/en_speaker_0">Male Voice 1</option>
                      <option value="v2/en_speaker_1">Female Voice 1</option>
                      <option value="v2/en_speaker_2">Male Voice 2</option>
                      <option value="v2/en_speaker_3">Female Voice 2</option>
                      <option value="v2/en_speaker_4">Male Voice 3</option>
                      <option value="v2/en_speaker_5">Female Voice 3</option>
                    </select>
                  </div>
                </div>
                
                <!-- Voice Cloning Controls -->
                <div class="grid grid-cols-2 gap-4">
                  <button id="uploadVoiceSample" class="console-button green">
                    UPLOAD VOICE
                  </button>
                  <button id="trainVoiceModel" class="console-button orange">
                    TRAIN MODEL
                  </button>
                </div>
                
                <!-- Usage Stats -->
                <div class="mt-6 p-4 bg-zinc-800/30 rounded-lg">
                  <h4 class="text-sm font-bold text-amber-300 mb-2 font-mono">USAGE STATS</h4>
                  <div class="grid grid-cols-2 gap-4 text-xs font-mono">
                    <div>
                      <span class="text-zinc-400">Tier:</span>
                      <span id="voiceTier" class="text-green-400 ml-2">FREE</span>
                    </div>
                    <div>
                      <span class="text-zinc-400">Used:</span>
                      <span id="voiceUsed" class="text-amber-400 ml-2">0/30 min</span>
                    </div>
                    <div>
                      <span class="text-zinc-400">Cost:</span>
                      <span id="voiceCost" class="text-blue-400 ml-2">$0.00</span>
                    </div>
                    <div>
                      <span class="text-zinc-400">Quality:</span>
                      <span id="voiceQualityDisplay" class="text-purple-400 ml-2">8/10</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- SSL EQ Module -->
              <div class="ssl-eq mb-8">
                <h4>SSL 5-BAND EQ</h4>
                <div class="eq-grid">
                  <div class="eq-band">
                    <label>80Hz</label>
                    <div class="eq-slider" data-eq-band="80hz" style="--eq-value: 50%"></div>
                    <div class="eq-value" id="eq-80hz">0dB</div>
                  </div>
                  <div class="eq-band">
                    <label>250Hz</label>
                    <div class="eq-slider" data-eq-band="250hz" style="--eq-value: 50%"></div>
                    <div class="eq-value" id="eq-250hz">0dB</div>
                  </div>
                  <div class="eq-band">
                    <label>1kHz</label>
                    <div class="eq-slider" data-eq-band="1khz" style="--eq-value: 50%"></div>
                    <div class="eq-value" id="eq-1khz">0dB</div>
                  </div>
                  <div class="eq-band">
                    <label>4kHz</label>
                    <div class="eq-slider" data-eq-band="4khz" style="--eq-value: 50%"></div>
                    <div class="eq-value" id="eq-4khz">0dB</div>
                  </div>
                  <div class="eq-band">
                    <label>12kHz</label>
                    <div class="eq-slider" data-eq-band="12khz" style="--eq-value: 50%"></div>
                    <div class="eq-value" id="eq-12khz">0dB</div>
                  </div>
                </div>
              </div>
              
              <!-- Analog Saturation Knob -->
              <div class="vintage-panel p-6 mb-8">
                <!-- Corner screws -->
                <div class="screw top-left"></div>
                <div class="screw top-right"></div>
                <div class="screw bottom-left"></div>
                <div class="screw bottom-right"></div>
                
                <!-- Wear effects -->
                <div class="wear scratch-1"></div>
                <div class="wear scratch-2"></div>
                <div class="wear dent"></div>
                <div class="wear fade"></div>
                
                <h3 class="text-lg font-bold text-center mb-6">ANALOG SATURATION</h3>
                <div class="flex justify-center">
                  <div class="control-item">
                    <div class="knob" data-knob="analog" data-value="0">
                      <div class="knob-scale"></div>
                      <div class="knob-wear"></div>
                      <div class="knob-value" id="analogDisplay">0%</div>
                    </div>
                    <p class="text-sm text-zinc font-mono">ANALOG</p>
                  </div>
                </div>
              </div>
              
          <!-- Analysis Control Panel -->
          <div class="vintage-panel p-4 mb-6">
            <!-- Corner screws -->
            <div class="screw top-left"></div>
            <div class="screw top-right"></div>
            <div class="screw bottom-left"></div>
            <div class="screw bottom-right"></div>
            
            <!-- Wear effects -->
            <div class="wear scratch-1"></div>
            <div class="wear scratch-2"></div>
            <div class="wear dent"></div>
            <div class="wear fade"></div>
            
            <h3 class="text-lg font-bold text-center mb-4">ANALYSIS CONTROL</h3>
                <div class="flex items-center justify-center space-x-4">
                  <div class="flex items-center space-x-2">
                    <input type="checkbox" id="analysisToggle" class="w-4 h-4 text-amber-600 bg-zinc-800 border-amber-500 rounded focus:ring-amber-500 focus:ring-2">
                    <label for="analysisToggle" class="text-sm font-mono text-amber-300">ENABLE ANALYSIS</label>
                  </div>
                  <div id="analysisStatusIndicator" class="flex items-center space-x-2 text-xs font-mono">
                    <div class="w-2 h-2 bg-gray-500 rounded-full"></div>
                    <span class="text-gray-400">ANALYSIS OFF</span>
                  </div>
                </div>
                <div class="mt-2 text-xs text-center text-amber-400 font-mono">
                  When enabled, audio will be automatically analyzed for intelligent prompt generation
                </div>
              </div>
              
              <!-- Hidden field for auto-generated prompt -->
              <input type="hidden" id="autoGeneratedPrompt" value="">
              
              <div class="text-center">
                <button id="transformAudio" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-4 px-12 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 font-mono text-lg border-2 border-purple-400">
                  🎛️ TRANSFORM AUDIO
                </button>
                <div id="transformHint" class="mt-2 text-xs text-purple-400 font-mono">
                  Enable analysis for intelligent prompt generation
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- CLONE STATION SECTION -->
        <section id="clone-station" class="section">
          <div class="space-y-6">
            <div class="vintage-panel p-8">
              <!-- Corner screws -->
              <div class="screw top-left"></div>
              <div class="screw top-right"></div>
              <div class="screw bottom-left"></div>
              <div class="screw bottom-right"></div>
              
              <!-- Wear effects -->
              <div class="wear scratch-1"></div>
              <div class="wear scratch-2"></div>
              <div class="wear dent"></div>
              <div class="wear fade"></div>
              
              <h2 class="text-2xl font-bold text-center mb-4">CLONE STATION</h2>
              <p class="text-center text-amber-300 mb-2 font-mono">Advanced Integrations for Professional Music Production</p>
              <div class="text-center mb-6">
                <span class="text-green-400 font-mono text-sm">INTEGRATIONS ACTIVE</span>
              </div>

              <!-- DAW Integration -->
              <div class="vintage-panel mb-8" id="dawIntegration">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">DAW INTEGRATION</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
                  <!-- Ableton Live -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">AL</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">Ableton Live</h4>
                    <div class="text-sm text-gray-400 mb-3">VST3 Plugin</div>
                    <button class="console-button blue text-xs px-3 py-1">Install Plugin</button>
                  </div>

                  <!-- Logic Pro -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">LP</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">Logic Pro</h4>
                    <div class="text-sm text-gray-400 mb-3">AU Plugin</div>
                    <button class="console-button blue text-xs px-3 py-1">Install Plugin</button>
                  </div>

                  <!-- FL Studio -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-green-500 to-teal-600 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">FL</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">FL Studio</h4>
                    <div class="text-sm text-gray-400 mb-3">VST3 Plugin</div>
                    <button class="console-button blue text-xs px-3 py-1">Install Plugin</button>
                  </div>

                  <!-- Studio One -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">S1</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">Studio One</h4>
                    <div class="text-sm text-gray-400 mb-3">VST3 Plugin</div>
                    <button class="console-button blue text-xs px-3 py-1">Install Plugin</button>
                  </div>

                  <!-- Pro Tools -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">PT</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">Pro Tools</h4>
                    <div class="text-sm text-gray-400 mb-3">AAX Plugin</div>
                    <button class="console-button blue text-xs px-3 py-1">Install Plugin</button>
                  </div>
                </div>

                <!-- DAW Status -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <div class="flex items-center justify-between mb-4">
                    <h4 class="font-semibold text-white">DAW Connection Status</h4>
                    <div class="flex items-center space-x-2">
                      <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                      <span class="text-sm text-gray-400">Disconnected</span>
                    </div>
                  </div>
                  <div class="text-sm text-gray-400">
                    <p>No DAW detected. Install the Son1kVers3 plugin in your DAW to enable real-time control.</p>
                    <p class="mt-2">Supported features: MIDI control, audio routing, parameter automation, real-time generation</p>
                  </div>
                </div>
              </div>

              <!-- GPT-4 Integration -->
              <div class="vintage-panel mb-8" id="gpt4Integration">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">GPT-4 INTEGRATION</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <!-- AI Analysis -->
                  <div>
                    <h4 class="font-semibold text-white mb-4">AI Music Analysis</h4>
                    <div class="space-y-3">
                      <div class="flex items-center justify-between">
                        <span class="text-gray-300">Lyric Analysis</span>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                      </div>
                      <div class="flex items-center justify-between">
                        <span class="text-gray-300">Mood Detection</span>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                      </div>
                      <div class="flex items-center justify-between">
                        <span class="text-gray-300">Genre Classification</span>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                      </div>
                      <div class="flex items-center justify-between">
                        <span class="text-gray-300">Tempo Analysis</span>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                      </div>
                    </div>
                  </div>

                  <!-- AI Generation -->
                  <div>
                    <h4 class="font-semibold text-white mb-4">AI Content Generation</h4>
                    <div class="space-y-3">
                      <div class="flex items-center justify-between">
                        <span class="text-gray-300">Smart Prompts</span>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                      </div>
                      <div class="flex items-center justify-between">
                        <span class="text-gray-300">Lyric Generation</span>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                      </div>
                      <div class="flex items-center justify-between">
                        <span class="text-gray-300">Song Structure</span>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                      </div>
                      <div class="flex items-center justify-between">
                        <span class="text-gray-300">Creative Suggestions</span>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- AI Settings -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-4">AI Configuration</h4>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">AI Model</label>
                      <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="gpt-4">GPT-4</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo</option>
                        <option value="claude-3">Claude 3</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">Creativity Level</label>
                      <input type="range" min="0" max="100" value="70" class="w-full">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">Analysis Depth</label>
                      <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="basic">Basic</option>
                        <option value="advanced">Advanced</option>
                        <option value="expert">Expert</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Streaming Platforms Integration -->
              <div class="vintage-panel mb-8" id="streamingIntegration">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">STREAMING PLATFORMS</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                  <!-- Spotify -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-green-500 to-green-700 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">SP</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">Spotify</h4>
                    <div class="text-sm text-gray-400 mb-3">API Connected</div>
                    <button class="console-button green text-xs px-3 py-1">Upload Track</button>
                  </div>

                  <!-- YouTube Music -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-red-500 to-red-700 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">YT</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">YouTube Music</h4>
                    <div class="text-sm text-gray-400 mb-3">API Connected</div>
                    <button class="console-button red text-xs px-3 py-1">Upload Track</button>
                  </div>

                  <!-- SoundCloud -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-orange-500 to-orange-700 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">SC</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">SoundCloud</h4>
                    <div class="text-sm text-gray-400 mb-3">API Connected</div>
                    <button class="console-button orange text-xs px-3 py-1">Upload Track</button>
                  </div>

                  <!-- Bandcamp -->
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 bg-gradient-to-br from-blue-500 to-blue-700 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">BC</span>
                    </div>
                    <h4 class="font-semibold text-white mb-2">Bandcamp</h4>
                    <div class="text-sm text-gray-400 mb-3">API Connected</div>
                    <button class="console-button blue text-xs px-3 py-1">Upload Track</button>
                  </div>
                </div>

                <!-- Upload Settings -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-4">Upload Configuration</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">Auto Upload</label>
                      <div class="flex items-center space-x-2">
                        <input type="checkbox" id="autoUpload" class="rounded">
                        <span class="text-sm text-gray-400">Automatically upload generated tracks</span>
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">Upload Quality</label>
                      <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="high">High (320kbps)</option>
                        <option value="medium">Medium (192kbps)</option>
                        <option value="low">Low (128kbps)</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Integration Status -->
              <div class="bg-gray-800 rounded-lg p-4">
                <h4 class="font-semibold text-white mb-4">Integration Status</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div class="text-center">
                    <div class="w-3 h-3 bg-red-500 rounded-full mx-auto mb-2"></div>
                    <span class="text-sm text-gray-400">DAW Integration</span>
                  </div>
                  <div class="text-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mx-auto mb-2"></div>
                    <span class="text-sm text-gray-400">GPT-4 Integration</span>
                  </div>
                  <div class="text-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mx-auto mb-2"></div>
                    <span class="text-sm text-gray-400">Streaming Platforms</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- NOVA POST PILOT SECTION -->
        <section id="nova-post-pilot" class="section">
          <div class="space-y-6">
            <div class="vintage-panel p-8">
              <!-- Corner screws -->
              <div class="screw top-left"></div>
              <div class="screw top-right"></div>
              <div class="screw bottom-left"></div>
              <div class="screw bottom-right"></div>
              
              <!-- Wear effects -->
              <div class="wear scratch-1"></div>
              <div class="wear scratch-2"></div>
              <div class="wear dent"></div>
              <div class="wear fade"></div>
              
              <h2 class="text-2xl font-bold text-center mb-4">NOVA POST PILOT</h2>
              <p class="text-center text-amber-300 mb-2 font-mono">AI-Powered Content Creation & Social Media Management</p>
              <div class="text-center mb-6">
                <span class="text-green-400 font-mono text-sm">NPP ACTIVE</span>
              </div>

              <!-- Content Creator Profile -->
              <div class="vintage-panel mb-8" id="creatorProfile">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">CONTENT ANALYSIS</h3>
                
                <div class="space-y-6 mb-6">
                  <!-- Content Description -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Describe Your Content</label>
                    <textarea id="contentDescription" rows="4" placeholder="Describe what type of content you create, your style, topics you cover, and what makes your content unique. Be as detailed as possible..." class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                    <p class="text-xs text-gray-500 mt-1">Example: "I create electronic music tutorials, behind-the-scenes studio content, and reaction videos to new music production tools. My style is educational but entertaining, focusing on making complex concepts accessible to beginners."</p>
                  </div>

                  <!-- Social Platforms -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Social Platforms</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                      <label class="flex items-center">
                        <input type="checkbox" value="instagram" class="mr-2">
                        <span class="text-sm text-gray-300">Instagram</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" value="tiktok" class="mr-2">
                        <span class="text-sm text-gray-300">TikTok</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" value="youtube" class="mr-2">
                        <span class="text-sm text-gray-300">YouTube</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" value="twitter" class="mr-2">
                        <span class="text-sm text-gray-300">Twitter</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" value="linkedin" class="mr-2">
                        <span class="text-sm text-gray-300">LinkedIn</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" value="facebook" class="mr-2">
                        <span class="text-sm text-gray-300">Facebook</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" value="pinterest" class="mr-2">
                        <span class="text-sm text-gray-300">Pinterest</span>
                      </label>
                      <label class="flex items-center">
                        <input type="checkbox" value="twitch" class="mr-2">
                        <span class="text-sm text-gray-300">Twitch</span>
                      </label>
                    </div>
                  </div>

                  <!-- Content Goals -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Content Goals</label>
                    <select id="contentGoals" class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                      <option value="engagement">Maximize Engagement</option>
                      <option value="followers">Grow Followers</option>
                      <option value="brand">Brand Awareness</option>
                      <option value="sales">Drive Sales</option>
                      <option value="education">Educate Audience</option>
                      <option value="entertainment">Entertain Audience</option>
                      <option value="community">Build Community</option>
                      <option value="influence">Establish Authority</option>
                    </select>
                  </div>

                  <!-- Market Analysis Depth -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Analysis Depth</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <label class="flex items-center p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700">
                        <input type="radio" name="analysisDepth" value="basic" class="mr-3">
                        <div>
                          <div class="font-medium text-white">Basic</div>
                          <div class="text-xs text-gray-400">Quick analysis, general trends</div>
                        </div>
                      </label>
                      <label class="flex items-center p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700">
                        <input type="radio" name="analysisDepth" value="advanced" checked class="mr-3">
                        <div>
                          <div class="font-medium text-white">Advanced</div>
                          <div class="text-xs text-gray-400">Detailed analysis, competitor insights</div>
                        </div>
                      </label>
                      <label class="flex items-center p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700">
                        <input type="radio" name="analysisDepth" value="expert" class="mr-3">
                        <div>
                          <div class="font-medium text-white">Expert</div>
                          <div class="text-xs text-gray-400">Deep dive, market predictions</div>
                        </div>
                      </label>
                    </div>
                  </div>
                </div>

                <button id="analyzeProfile" class="console-button blue w-full">ANALYZE CONTENT & GENERATE STRATEGY</button>
              </div>

              <!-- Algorithm Analysis -->
              <div class="vintage-panel mb-8" id="algorithmAnalysis" style="display: none;">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">ALGORITHM ANALYSIS</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                  <!-- Instagram Algorithm -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Instagram Algorithm</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Engagement Rate: <span id="igEngagement" class="text-green-400">12.5%</span></div>
                      <div>Reach Score: <span id="igReach" class="text-green-400">8.7/10</span></div>
                      <div>Timing Score: <span id="igTiming" class="text-green-400">9.2/10</span></div>
                      <div>Content Score: <span id="igContent" class="text-green-400">8.9/10</span></div>
                      <div>Hashtag Score: <span id="igHashtags" class="text-green-400">7.8/10</span></div>
                      <div>Story Score: <span id="igStories" class="text-green-400">9.1/10</span></div>
                    </div>
                    <div class="mt-3">
                      <div class="text-xs text-gray-400">Key Factors:</div>
                      <div class="text-xs text-green-400">Comments, Saves, Shares, Time on Post</div>
                    </div>
                  </div>

                  <!-- TikTok Algorithm -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">TikTok Algorithm</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Completion Rate: <span id="ttCompletion" class="text-green-400">85%</span></div>
                      <div>Viral Potential: <span id="ttViral" class="text-green-400">9.3/10</span></div>
                      <div>Sound Score: <span id="ttSound" class="text-green-400">8.5/10</span></div>
                      <div>Hook Score: <span id="ttHook" class="text-green-400">9.7/10</span></div>
                      <div>Trend Score: <span id="ttTrend" class="text-green-400">8.8/10</span></div>
                      <div>Retention: <span id="ttRetention" class="text-green-400">92%</span></div>
                    </div>
                    <div class="mt-3">
                      <div class="text-xs text-gray-400">Key Factors:</div>
                      <div class="text-xs text-green-400">Watch Time, Replays, Shares, Comments</div>
                    </div>
                  </div>

                  <!-- YouTube Algorithm -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">YouTube Algorithm</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>CTR Score: <span id="ytCTR" class="text-green-400">8.2%</span></div>
                      <div>Retention: <span id="ytRetention" class="text-green-400">78%</span></div>
                      <div>SEO Score: <span id="ytSEO" class="text-green-400">9.1/10</span></div>
                      <div>Thumbnail Score: <span id="ytThumbnail" class="text-green-400">8.7/10</span></div>
                      <div>Title Score: <span id="ytTitle" class="text-green-400">9.0/10</span></div>
                      <div>Engagement: <span id="ytEngagement" class="text-green-400">6.8%</span></div>
                    </div>
                    <div class="mt-3">
                      <div class="text-xs text-gray-400">Key Factors:</div>
                      <div class="text-xs text-green-400">Watch Time, CTR, Retention, Engagement</div>
                    </div>
                  </div>

                  <!-- Twitter Algorithm -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Twitter Algorithm</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Engagement Rate: <span id="twEngagement" class="text-green-400">4.2%</span></div>
                      <div>Retweet Score: <span id="twRetweet" class="text-green-400">8.9/10</span></div>
                      <div>Reply Score: <span id="twReply" class="text-green-400">7.5/10</span></div>
                      <div>Timing Score: <span id="twTiming" class="text-green-400">8.3/10</span></div>
                      <div>Hashtag Score: <span id="twHashtags" class="text-green-400">6.8/10</span></div>
                      <div>Trend Score: <span id="twTrend" class="text-green-400">9.1/10</span></div>
                    </div>
                    <div class="mt-3">
                      <div class="text-xs text-gray-400">Key Factors:</div>
                      <div class="text-xs text-green-400">Retweets, Replies, Likes, Time on Tweet</div>
                    </div>
                  </div>

                  <!-- LinkedIn Algorithm -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">LinkedIn Algorithm</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Engagement Rate: <span id="liEngagement" class="text-green-400">3.8%</span></div>
                      <div>Professional Score: <span id="liProfessional" class="text-green-400">9.2/10</span></div>
                      <div>Content Score: <span id="liContent" class="text-green-400">8.7/10</span></div>
                      <div>Network Score: <span id="liNetwork" class="text-green-400">8.9/10</span></div>
                      <div>Timing Score: <span id="liTiming" class="text-green-400">9.0/10</span></div>
                      <div>Comment Score: <span id="liComment" class="text-green-400">8.5/10</span></div>
                    </div>
                    <div class="mt-3">
                      <div class="text-xs text-gray-400">Key Factors:</div>
                      <div class="text-xs text-green-400">Comments, Shares, Professional Relevance</div>
                    </div>
                  </div>

                  <!-- Facebook Algorithm -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Facebook Algorithm</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Engagement Rate: <span id="fbEngagement" class="text-green-400">2.1%</span></div>
                      <div>Reach Score: <span id="fbReach" class="text-green-400">7.8/10</span></div>
                      <div>Video Score: <span id="fbVideo" class="text-green-400">8.9/10</span></div>
                      <div>Live Score: <span id="fbLive" class="text-green-400">9.3/10</span></div>
                      <div>Group Score: <span id="fbGroup" class="text-green-400">8.6/10</span></div>
                      <div>Comment Score: <span id="fbComment" class="text-green-400">8.2/10</span></div>
                    </div>
                    <div class="mt-3">
                      <div class="text-xs text-gray-400">Key Factors:</div>
                      <div class="text-xs text-green-400">Comments, Shares, Reactions, Time on Post</div>
                    </div>
                  </div>
                </div>

                <!-- Algorithm Optimization Recommendations -->
                <div class="bg-gray-800 rounded-lg p-4 mb-6">
                  <h4 class="font-semibold text-white mb-3">Algorithm Optimization Recommendations</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <h5 class="font-medium text-green-400 mb-2">High Impact Changes</h5>
                      <ul class="text-sm text-gray-300 space-y-1">
                        <li id="highImpact1">• Post at 6:30 PM for 23% higher engagement</li>
                        <li id="highImpact2">• Use 3-5 hashtags for optimal reach</li>
                        <li id="highImpact3">• Include call-to-action in 80% of posts</li>
                        <li id="highImpact4">• Post Stories 2x daily for algorithm boost</li>
                      </ul>
                    </div>
                    <div>
                      <h5 class="font-medium text-green-400 mb-2">Content Strategy</h5>
                      <ul class="text-sm text-gray-300 space-y-1">
                        <li id="contentStrategy1">• Video content performs 3.2x better</li>
                        <li id="contentStrategy2">• Educational posts get 45% more saves</li>
                        <li id="contentStrategy3">• Behind-the-scenes content drives engagement</li>
                        <li id="contentStrategy4">• User-generated content increases reach by 28%</li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Performance Prediction -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Performance Prediction</h4>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-400 mb-1" id="predictedReach">+127%</div>
                      <div class="text-sm text-gray-400">Reach Increase</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-400 mb-1" id="predictedEngagement">+89%</div>
                      <div class="text-sm text-gray-400">Engagement Increase</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-400 mb-1" id="predictedFollowers">+156%</div>
                      <div class="text-sm text-gray-400">Follower Growth</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Market Analysis Results -->
              <div class="vintage-panel mb-8" id="marketAnalysis" style="display: none;">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">MARKET ANALYSIS</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                  <!-- Target Audience Analysis -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Target Audience</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Age Range: <span id="targetAge" class="text-green-400">18-35</span></div>
                      <div>Gender: <span id="targetGender" class="text-green-400">Mixed</span></div>
                      <div>Interests: <span id="targetInterests" class="text-green-400">Music, Tech</span></div>
                      <div>Location: <span id="targetLocation" class="text-green-400">Global</span></div>
                      <div>Income: <span id="targetIncome" class="text-green-400">$30K-80K</span></div>
                      <div>Peak Hours: <span id="targetHours" class="text-green-400">7-9 PM</span></div>
                      <div>Engagement: <span id="targetEngagement" class="text-green-400">High</span></div>
                    </div>
                  </div>

                  <!-- Trending Topics -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Trending Topics</h4>
                    <div class="space-y-1 text-sm text-gray-300">
                      <div class="flex justify-between">
                        <span>#AIMusic</span>
                        <span class="text-green-400">+45%</span>
                      </div>
                      <div class="flex justify-between">
                        <span>#MusicTech</span>
                        <span class="text-green-400">+32%</span>
                      </div>
                      <div class="flex justify-between">
                        <span>#ProducerLife</span>
                        <span class="text-green-400">+28%</span>
                      </div>
                      <div class="flex justify-between">
                        <span>#StudioSetup</span>
                        <span class="text-green-400">+21%</span>
                      </div>
                      <div class="flex justify-between">
                        <span>#MusicProduction</span>
                        <span class="text-green-400">+18%</span>
                      </div>
                      <div class="flex justify-between">
                        <span>#BehindTheScenes</span>
                        <span class="text-green-400">+15%</span>
                      </div>
                    </div>
                  </div>

                  <!-- Best Posting Times -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Optimal Posting Times</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Instagram: <span class="text-green-400">6-9 PM</span></div>
                      <div>TikTok: <span class="text-green-400">6-10 PM</span></div>
                      <div>YouTube: <span class="text-green-400">2-4 PM</span></div>
                      <div>Twitter: <span class="text-green-400">12-3 PM</span></div>
                      <div>LinkedIn: <span class="text-green-400">8-10 AM</span></div>
                      <div>Facebook: <span class="text-green-400">1-3 PM</span></div>
                    </div>
                  </div>

                  <!-- Competitor Analysis -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Competitor Analysis</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Top Competitors: <span id="topCompetitors" class="text-green-400">3 identified</span></div>
                      <div>Avg Engagement: <span id="avgEngagement" class="text-green-400">12.5%</span></div>
                      <div>Posting Frequency: <span id="postingFreq" class="text-green-400">Daily</span></div>
                      <div>Content Mix: <span id="contentMix" class="text-green-400">70% Video</span></div>
                      <div>Growth Rate: <span id="growthRate" class="text-green-400">+25% MoM</span></div>
                    </div>
                  </div>

                  <!-- Content Performance -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Content Performance</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Best Format: <span id="bestFormat" class="text-green-400">Short Videos</span></div>
                      <div>Avg Duration: <span id="avgDuration" class="text-green-400">60-90s</span></div>
                      <div>Engagement Rate: <span id="engagementRate" class="text-green-400">8.5%</span></div>
                      <div>Share Rate: <span id="shareRate" class="text-green-400">2.1%</span></div>
                      <div>Comment Rate: <span id="commentRate" class="text-green-400">1.8%</span></div>
                    </div>
                  </div>

                  <!-- Market Opportunities -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Market Opportunities</h4>
                    <div class="space-y-2 text-sm text-gray-300">
                      <div>Underserved Niches: <span id="underservedNiches" class="text-green-400">2 identified</span></div>
                      <div>Content Gaps: <span id="contentGaps" class="text-green-400">Educational</span></div>
                      <div>Platform Gaps: <span id="platformGaps" class="text-green-400">LinkedIn</span></div>
                      <div>Time Gaps: <span id="timeGaps" class="text-green-400">Morning</span></div>
                      <div>Trending Now: <span id="trendingNow" class="text-green-400">AI Tools</span></div>
                    </div>
                  </div>
                </div>

                <!-- Detailed Analysis -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Detailed Market Insights</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <h5 class="font-medium text-green-400 mb-2">Audience Behavior</h5>
                      <p class="text-sm text-gray-300" id="audienceBehavior">
                        Your target audience is highly engaged with educational content, particularly tutorials and behind-the-scenes content. They prefer short-form videos (60-90 seconds) and are most active during evening hours.
                      </p>
                    </div>
                    <div>
                      <h5 class="font-medium text-green-400 mb-2">Content Strategy</h5>
                      <p class="text-sm text-gray-300" id="contentStrategy">
                        Focus on educational content with entertainment value. Use trending hashtags and create content that encourages interaction. Consider live streaming for real-time engagement.
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Viral Hook Templates -->
              <div class="vintage-panel mb-8" id="viralHooks" style="display: none;">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">VIRAL HOOK TEMPLATES</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                  <!-- Option A -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">Option A</h4>
                      <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                        <span class="text-xs text-gray-400">High Engagement</span>
                      </div>
                    </div>
                    <div id="hookA" class="text-sm text-gray-300 mb-3">
                      "This AI tool just changed everything about music production..."
                    </div>
                    <div class="flex space-x-2">
                      <button class="console-button green text-xs px-2 py-1" onclick="selectHook('A')">SELECT</button>
                      <button class="console-button blue text-xs px-2 py-1" onclick="regenerateHook('A')">REGENERATE</button>
                    </div>
                  </div>

                  <!-- Option B -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">Option B</h4>
                      <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                        <span class="text-xs text-gray-400">Medium Engagement</span>
                      </div>
                    </div>
                    <div id="hookB" class="text-sm text-gray-300 mb-3">
                      "3 things every music producer needs to know in 2024..."
                    </div>
                    <div class="flex space-x-2">
                      <button class="console-button green text-xs px-2 py-1" onclick="selectHook('B')">SELECT</button>
                      <button class="console-button blue text-xs px-2 py-1" onclick="regenerateHook('B')">REGENERATE</button>
                    </div>
                  </div>

                  <!-- Option C -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">Option C</h4>
                      <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                        <span class="text-xs text-gray-400">Experimental</span>
                      </div>
                    </div>
                    <div id="hookC" class="text-sm text-gray-300 mb-3">
                      "I tried this controversial music technique and the results shocked me..."
                    </div>
                    <div class="flex space-x-2">
                      <button class="console-button green text-xs px-2 py-1" onclick="selectHook('C')">SELECT</button>
                      <button class="console-button blue text-xs px-2 py-1" onclick="regenerateHook('C')">REGENERATE</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Content Suggestions -->
              <div class="vintage-panel mb-8" id="contentSuggestions" style="display: none;">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">CONTENT SUGGESTIONS</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <!-- High Engagement Content -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">High Engagement Content</h4>
                    <div class="space-y-3">
                      <div class="border-l-4 border-green-500 pl-3">
                        <div class="text-sm text-gray-300">"Behind the scenes: Creating a beat in 60 seconds"</div>
                        <div class="text-xs text-gray-500 mt-1">Expected: 15K+ likes</div>
                      </div>
                      <div class="border-l-4 border-green-500 pl-3">
                        <div class="text-sm text-gray-300">"AI vs Human: Can you tell the difference?"</div>
                        <div class="text-xs text-gray-500 mt-1">Expected: 12K+ likes</div>
                      </div>
                      <div class="border-l-4 border-green-500 pl-3">
                        <div class="text-sm text-gray-300">"Studio setup tour: What's in my rack?"</div>
                        <div class="text-xs text-gray-500 mt-1">Expected: 8K+ likes</div>
                      </div>
                    </div>
                  </div>

                  <!-- Trending Content -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Trending Content</h4>
                    <div class="space-y-3">
                      <div class="border-l-4 border-blue-500 pl-3">
                        <div class="text-sm text-gray-300">"2024 Music Production Trends You Need to Know"</div>
                        <div class="text-xs text-gray-500 mt-1">Trending: #MusicTech</div>
                      </div>
                      <div class="border-l-4 border-blue-500 pl-3">
                        <div class="text-sm text-gray-300">"How I Made $10K with AI-Generated Music"</div>
                        <div class="text-xs text-gray-500 mt-1">Trending: #AIMusic</div>
                      </div>
                      <div class="border-l-4 border-blue-500 pl-3">
                        <div class="text-sm text-gray-300">"Producer Reacts to Viral TikTok Beats"</div>
                        <div class="text-xs text-gray-500 mt-1">Trending: #ProducerLife</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Social Media Integration -->
              <div class="vintage-panel mb-8" id="socialIntegration" style="display: none;">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">SOCIAL MEDIA INTEGRATION</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                  <!-- Instagram Integration -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">Instagram</h4>
                      <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="igStatus"></div>
                        <span class="text-xs text-gray-400" id="igStatusText">Disconnected</span>
                      </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-300 mb-4">
                      <div>Account: <span id="igAccount" class="text-green-400">Not connected</span></div>
                      <div>Posts: <span id="igPosts" class="text-green-400">0 scheduled</span></div>
                      <div>Stories: <span id="igStories" class="text-green-400">0 scheduled</span></div>
                      <div>Reels: <span id="igReels" class="text-green-400">0 scheduled</span></div>
                    </div>
                    <button class="console-button blue w-full" id="connectInstagram">CONNECT INSTAGRAM</button>
                  </div>

                  <!-- TikTok Integration -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">TikTok</h4>
                      <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="ttStatus"></div>
                        <span class="text-xs text-gray-400" id="ttStatusText">Disconnected</span>
                      </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-300 mb-4">
                      <div>Account: <span id="ttAccount" class="text-green-400">Not connected</span></div>
                      <div>Videos: <span id="ttVideos" class="text-green-400">0 scheduled</span></div>
                      <div>Lives: <span id="ttLives" class="text-green-400">0 scheduled</span></div>
                      <div>Trends: <span id="ttTrends" class="text-green-400">0 tracked</span></div>
                    </div>
                    <button class="console-button blue w-full" id="connectTikTok">CONNECT TIKTOK</button>
                  </div>

                  <!-- YouTube Integration -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">YouTube</h4>
                      <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="ytStatus"></div>
                        <span class="text-xs text-gray-400" id="ytStatusText">Disconnected</span>
                      </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-300 mb-4">
                      <div>Channel: <span id="ytChannel" class="text-green-400">Not connected</span></div>
                      <div>Videos: <span id="ytVideos" class="text-green-400">0 scheduled</span></div>
                      <div>Shorts: <span id="ytShorts" class="text-green-400">0 scheduled</span></div>
                      <div>Lives: <span id="ytLives" class="text-green-400">0 scheduled</span></div>
                    </div>
                    <button class="console-button blue w-full" id="connectYouTube">CONNECT YOUTUBE</button>
                  </div>

                  <!-- Twitter Integration -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">Twitter</h4>
                      <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="twStatus"></div>
                        <span class="text-xs text-gray-400" id="twStatusText">Disconnected</span>
                      </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-300 mb-4">
                      <div>Account: <span id="twAccount" class="text-green-400">Not connected</span></div>
                      <div>Tweets: <span id="twTweets" class="text-green-400">0 scheduled</span></div>
                      <div>Threads: <span id="twThreads" class="text-green-400">0 scheduled</span></div>
                      <div>Spaces: <span id="twSpaces" class="text-green-400">0 scheduled</span></div>
                    </div>
                    <button class="console-button blue w-full" id="connectTwitter">CONNECT TWITTER</button>
                  </div>

                  <!-- LinkedIn Integration -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">LinkedIn</h4>
                      <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="liStatus"></div>
                        <span class="text-xs text-gray-400" id="liStatusText">Disconnected</span>
                      </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-300 mb-4">
                      <div>Profile: <span id="liProfile" class="text-green-400">Not connected</span></div>
                      <div>Posts: <span id="liPosts" class="text-green-400">0 scheduled</span></div>
                      <div>Articles: <span id="liArticles" class="text-green-400">0 scheduled</span></div>
                      <div>Events: <span id="liEvents" class="text-green-400">0 scheduled</span></div>
                    </div>
                    <button class="console-button blue w-full" id="connectLinkedIn">CONNECT LINKEDIN</button>
                  </div>

                  <!-- Facebook Integration -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                      <h4 class="font-semibold text-white">Facebook</h4>
                      <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-red-500 mr-2" id="fbStatus"></div>
                        <span class="text-xs text-gray-400" id="fbStatusText">Disconnected</span>
                      </div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-300 mb-4">
                      <div>Page: <span id="fbPage" class="text-green-400">Not connected</span></div>
                      <div>Posts: <span id="fbPosts" class="text-green-400">0 scheduled</span></div>
                      <div>Lives: <span id="fbLives" class="text-green-400">0 scheduled</span></div>
                      <div>Groups: <span id="fbGroups" class="text-green-400">0 connected</span></div>
                    </div>
                    <button class="console-button blue w-full" id="connectFacebook">CONNECT FACEBOOK</button>
                  </div>
                </div>

                <!-- Integration Status -->
                <div class="bg-gray-800 rounded-lg p-4 mb-6">
                  <h4 class="font-semibold text-white mb-3">Integration Status</h4>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-400 mb-1" id="connectedPlatforms">0</div>
                      <div class="text-sm text-gray-400">Connected Platforms</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-400 mb-1" id="scheduledPosts">0</div>
                      <div class="text-sm text-gray-400">Scheduled Posts</div>
                    </div>
                    <div class="text-center">
                      <div class="text-2xl font-bold text-green-400 mb-1" id="autoPublishStatus">OFF</div>
                      <div class="text-sm text-gray-400">Auto-Publish Status</div>
                    </div>
                  </div>
                </div>

                <!-- Auto-Publish Settings -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Auto-Publish Settings</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label class="flex items-center mb-3">
                        <input type="checkbox" id="enableAutoPublish" class="mr-2">
                        <span class="text-sm text-gray-300">Enable Auto-Publishing</span>
                      </label>
                      <div class="text-xs text-gray-400 mb-4">
                        Content will be published automatically at optimal times based on algorithm analysis
                      </div>
                      
                      <div class="space-y-2">
                        <label class="block text-sm text-gray-300">Posting Frequency</label>
                        <select id="postingFrequency" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm">
                          <option value="daily">Daily</option>
                          <option value="twice-daily">Twice Daily</option>
                          <option value="every-other-day">Every Other Day</option>
                          <option value="weekly">Weekly</option>
                        </select>
                      </div>
                    </div>
                    
                    <div>
                      <label class="block text-sm text-gray-300 mb-2">Content Mix</label>
                      <div class="space-y-2">
                        <label class="flex items-center">
                          <input type="checkbox" value="posts" checked class="mr-2">
                          <span class="text-sm text-gray-300">Regular Posts</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" value="stories" checked class="mr-2">
                          <span class="text-sm text-gray-300">Stories</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" value="reels" class="mr-2">
                          <span class="text-sm text-gray-300">Reels/Shorts</span>
                        </label>
                        <label class="flex items-center">
                          <input type="checkbox" value="lives" class="mr-2">
                          <span class="text-sm text-gray-300">Live Content</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Publishing Schedule -->
              <div class="vintage-panel mb-8" id="publishingSchedule" style="display: none;">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">PUBLISHING SCHEDULE</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                  <!-- Instagram Schedule -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Instagram</h4>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span class="text-gray-300">Monday</span>
                        <span class="text-green-400">6:00 PM</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-300">Wednesday</span>
                        <span class="text-green-400">7:30 PM</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-300">Friday</span>
                        <span class="text-green-400">8:00 PM</span>
                      </div>
                    </div>
                  </div>

                  <!-- TikTok Schedule -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">TikTok</h4>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span class="text-gray-300">Tuesday</span>
                        <span class="text-green-400">6:30 PM</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-300">Thursday</span>
                        <span class="text-green-400">7:00 PM</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-300">Saturday</span>
                        <span class="text-green-400">9:00 PM</span>
                      </div>
                    </div>
                  </div>

                  <!-- YouTube Schedule -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">YouTube</h4>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span class="text-gray-300">Wednesday</span>
                        <span class="text-green-400">2:00 PM</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-300">Sunday</span>
                        <span class="text-green-400">3:00 PM</span>
                      </div>
                    </div>
                  </div>

                  <!-- Twitter Schedule -->
                  <div class="bg-gray-800 rounded-lg p-4">
                    <h4 class="font-semibold text-white mb-3">Twitter</h4>
                    <div class="space-y-2 text-sm">
                      <div class="flex justify-between">
                        <span class="text-gray-300">Daily</span>
                        <span class="text-green-400">12:00 PM</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-300">Daily</span>
                        <span class="text-green-400">6:00 PM</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Auto-Publish Settings -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-4">Auto-Publish Settings</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">Enable Auto-Publish</label>
                      <div class="flex items-center space-x-2">
                        <input type="checkbox" id="enableAutoPublish" class="rounded">
                        <span class="text-sm text-gray-400">Automatically publish content at scheduled times</span>
                      </div>
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-gray-300 mb-2">Content Approval</label>
                      <select class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500">
                        <option value="auto">Auto-approve all content</option>
                        <option value="manual">Manual approval required</option>
                        <option value="ai">AI pre-approval</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Selected Content Preview -->
              <div class="vintage-panel mb-8" id="contentPreview" style="display: none;">
                <div class="screw screw-tl"></div>
                <div class="screw screw-tr"></div>
                <div class="screw screw-bl"></div>
                <div class="screw screw-br"></div>
                <div class="wear wear-tl"></div>
                <div class="wear wear-tr"></div>
                <div class="wear wear-bl"></div>
                <div class="wear wear-br"></div>
                
                <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">CONTENT PREVIEW</h3>
                
                <div class="bg-gray-800 rounded-lg p-4 mb-4">
                  <div class="flex items-center justify-between mb-3">
                    <h4 class="font-semibold text-white">Selected Content</h4>
                    <div class="flex space-x-2">
                      <button class="console-button green text-xs px-3 py-1" onclick="publishContent()">PUBLISH NOW</button>
                      <button class="console-button blue text-xs px-3 py-1" onclick="scheduleContent()">SCHEDULE</button>
                    </div>
                  </div>
                  <div id="selectedContent" class="text-sm text-gray-300 mb-3">
                    No content selected
                  </div>
                  <div class="text-xs text-gray-500">
                    Platform: <span id="selectedPlatform" class="text-green-400">-</span> | 
                    Scheduled: <span id="selectedTime" class="text-green-400">-</span>
                  </div>
                </div>
              </div>

              <!-- NPP Status -->
              <div class="bg-gray-800 rounded-lg p-4">
                <h4 class="font-semibold text-white mb-4">NPP Status</h4>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                  <div class="text-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mx-auto mb-2"></div>
                    <span class="text-sm text-gray-400">Profile Analysis</span>
                  </div>
                  <div class="text-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mx-auto mb-2"></div>
                    <span class="text-sm text-gray-400">Market Research</span>
                  </div>
                  <div class="text-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mx-auto mb-2"></div>
                    <span class="text-sm text-gray-400">Content Generation</span>
                  </div>
                  <div class="text-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mx-auto mb-2"></div>
                    <span class="text-sm text-gray-400">Auto-Publishing</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- ARCHIVE SECTION -->
        <section id="archivo" class="section">
          <div class="space-y-6">
            <h2 class="text-2xl font-bold text-center">El Archivo</h2>
            <p class="text-center text-zinc">Tu música generada</p>
            
            <div class="text-center mb-4">
              <button onclick="loadTracks()" class="px-4 py-2 bg-neon text-black rounded font-medium hover:bg-neon/80 transition-colors">
                🔄 Cargar Tracks
              </button>
              <button onclick="testConnection()" class="ml-2 px-4 py-2 bg-zinc-700 text-white rounded font-medium hover:bg-zinc-600 transition-colors">
                🧪 Probar Conexión
              </button>
            </div>
            
            <div id="tracksList" class="space-y-4">
              <div class="p-4 bg-black/30 rounded">
                <p class="text-zinc">Cargando tracks...</p>
                <p class="text-sm text-zinc">Haz clic en "Cargar Tracks" para ver tu música.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- SANCTUARY SECTION - RESISTANCE SOCIAL NETWORK -->
        <section id="santuario" class="section">
          <div class="container mx-auto px-4 py-8">
            <div class="text-center mb-8">
              <h2 class="text-4xl font-bold text-red-400 mb-4 font-mono">SANTUARIO</h2>
              <p class="text-center text-amber-300 mb-2 font-mono">Red Social de la Resistencia - Divina Liga del No Silencio</p>
              <div class="text-center mb-6">
                <span class="text-cyan-400 font-mono text-sm">SOLO MIEMBROS PRO & PREMIUM</span>
              </div>
            </div>

            <!-- Resistance Status -->
            <div class="vintage-panel mb-8" id="resistanceNetwork">
              <div class="screw screw-tl"></div>
              <div class="screw screw-tr"></div>
              <div class="screw screw-bl"></div>
              <div class="screw screw-br"></div>
              <div class="wear wear-tl"></div>
              <div class="wear wear-tr"></div>
              <div class="wear wear-bl"></div>
              <div class="wear wear-br"></div>
              
              <h3 class="text-xl font-bold mb-6 text-red-400 font-mono">ESTADO DE LA RED</h3>
              
              <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <!-- Active Members -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Miembros Activos</h4>
                  <div class="space-y-2 text-sm text-gray-300">
                    <div>Pro: <span id="proMembers" class="text-cyan-400">247</span></div>
                    <div>Premium: <span id="premiumMembers" class="text-green-400">89</span></div>
                    <div>En Línea: <span id="onlineMembers" class="text-yellow-400">23</span></div>
                    <div>Total: <span id="totalMembers" class="text-white">336</span></div>
                  </div>
                </div>

                <!-- Operations Status -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Operaciones</h4>
                  <div class="space-y-2 text-sm text-gray-300">
                    <div>Activas: <span id="activeOps" class="text-red-400">12</span></div>
                    <div>Completadas: <span id="completedOps" class="text-green-400">156</span></div>
                    <div>Éxito: <span id="successRate" class="text-green-400">94.2%</span></div>
                    <div>Próxima: <span id="nextOp" class="text-cyan-400">En 2h</span></div>
                  </div>
                </div>

                <!-- Collaborations -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Colaboraciones</h4>
                  <div class="space-y-2 text-sm text-gray-300">
                    <div>En Curso: <span id="activeCollabs" class="text-blue-400">8</span></div>
                    <div>Finalizadas: <span id="completedCollabs" class="text-green-400">43</span></div>
                    <div>Pendientes: <span id="pendingCollabs" class="text-yellow-400">5</span></div>
                    <div>Rate: <span id="collabRate" class="text-cyan-400">+23%</span></div>
                  </div>
                </div>

                <!-- XentriX Threat -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Amenaza XentriX</h4>
                  <div class="space-y-2 text-sm text-gray-300">
                    <div>Nivel: <span id="threatLevel" class="text-red-400">ALTO</span></div>
                    <div>Detecciones: <span id="detections" class="text-yellow-400">3</span></div>
                    <div>Contramedidas: <span id="countermeasures" class="text-green-400">ACTIVAS</span></div>
                    <div>Protección: <span id="protection" class="text-cyan-400">87%</span></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Main Chat Interface -->
            <div class="vintage-panel mb-8" id="resistanceChat">
              <div class="screw screw-tl"></div>
              <div class="screw screw-tr"></div>
              <div class="screw screw-bl"></div>
              <div class="screw screw-br"></div>
              <div class="wear wear-tl"></div>
              <div class="wear wear-tr"></div>
              <div class="wear wear-bl"></div>
              <div class="wear wear-br"></div>
              
              <h3 class="text-xl font-bold mb-6 text-cyan-400 font-mono">CANAL DE COMUNICACIÓN</h3>
              
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Chat Messages -->
                <div class="lg:col-span-2 bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Mensajes de la Resistencia</h4>
                  <div id="resistanceChatMessages" class="h-80 overflow-y-auto bg-black rounded p-3 mb-3 font-mono text-sm text-green-400 border border-gray-600">
                    <div class="text-cyan-400">[15:30:42] Resistance_Alpha: Operación "Silent Strike" iniciada</div>
                    <div class="text-green-400">[15:31:15] Pixel_Pro: Nuevo algoritmo de evasión desplegado</div>
                    <div class="text-yellow-400">[15:32:03] Ghost_Master: Colaboración disponible - Proyecto "Neon Dreams"</div>
                    <div class="text-blue-400">[15:33:21] Quantum_Beat: Análisis de XentriX completado - Vulnerabilidades encontradas</div>
                    <div class="text-red-400">[15:34:45] Resistance_Alpha: ALERTA - XentriX detectó actividad sospechosa</div>
                  </div>
                  <div class="flex space-x-2">
                    <input type="text" id="resistanceMessageInput" placeholder="Escribe tu mensaje..." class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500">
                    <button id="resistanceSendMessage" class="console-button cyan">ENVIAR</button>
                  </div>
                </div>

                <!-- Online Members -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Miembros en Línea</h4>
                  <div id="onlineMembersList" class="space-y-2 text-sm">
                    <div class="flex items-center justify-between text-cyan-400">
                      <span>Resistance_Alpha</span>
                      <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                    </div>
                    <div class="flex items-center justify-between text-green-400">
                      <span>Pixel_Pro</span>
                      <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                    </div>
                    <div class="flex items-center justify-between text-yellow-400">
                      <span>Ghost_Master</span>
                      <span class="w-2 h-2 bg-yellow-400 rounded-full"></span>
                    </div>
                    <div class="flex items-center justify-between text-blue-400">
                      <span>Quantum_Beat</span>
                      <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                    </div>
                    <div class="flex items-center justify-between text-purple-400">
                      <span>Neon_Synth</span>
                      <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Collaboration Hub -->
            <div class="vintage-panel mb-8" id="collaborationHub">
              <div class="screw screw-tl"></div>
              <div class="screw screw-tr"></div>
              <div class="screw screw-bl"></div>
              <div class="screw screw-br"></div>
              <div class="wear wear-tl"></div>
              <div class="wear wear-tr"></div>
              <div class="wear wear-bl"></div>
              <div class="wear wear-br"></div>
              
              <h3 class="text-xl font-bold mb-6 text-green-400 font-mono">CENTRO DE COLABORACIÓN</h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Active Collaborations -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Colaboraciones Activas</h4>
                  <div class="space-y-3">
                    <div class="border border-gray-600 rounded p-3">
                      <div class="flex justify-between items-start mb-2">
                        <h5 class="text-cyan-400 font-semibold">Proyecto "Neon Dreams"</h5>
                        <span class="text-xs text-gray-400">2/4 miembros</span>
                      </div>
                      <p class="text-sm text-gray-300 mb-2">Creación de álbum conceptual sobre la resistencia</p>
                      <div class="flex space-x-2">
                        <button class="console-button blue text-xs">UNIRSE</button>
                        <button class="console-button green text-xs">VER DETALLES</button>
                      </div>
                    </div>
                    
                    <div class="border border-gray-600 rounded p-3">
                      <div class="flex justify-between items-start mb-2">
                        <h5 class="text-green-400 font-semibold">Operación "Silent Strike"</h5>
                        <span class="text-xs text-gray-400">5/8 miembros</span>
                      </div>
                      <p class="text-sm text-gray-300 mb-2">Ataque coordinado contra servidores XentriX</p>
                      <div class="flex space-x-2">
                        <button class="console-button red text-xs">UNIRSE</button>
                        <button class="console-button green text-xs">VER DETALLES</button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Create Collaboration -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Crear Colaboración</h4>
                  <div class="space-y-3">
                    <div>
                      <label class="block text-sm text-gray-300 mb-1">Nombre del Proyecto</label>
                      <input type="text" id="collabName" placeholder="Ej: Operación Thunder" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400">
                    </div>
                    <div>
                      <label class="block text-sm text-gray-300 mb-1">Descripción</label>
                      <textarea id="collabDescription" placeholder="Describe tu proyecto..." class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 h-20"></textarea>
                    </div>
                    <div>
                      <label class="block text-sm text-gray-300 mb-1">Tipo</label>
                      <select id="collabType" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                        <option value="music">Creación Musical</option>
                        <option value="operation">Operación de Resistencia</option>
                        <option value="research">Investigación</option>
                        <option value="other">Otro</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-sm text-gray-300 mb-1">Miembros Requeridos</label>
                      <input type="number" id="collabMembers" min="2" max="10" value="4" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white">
                    </div>
                    <button id="createCollaboration" class="console-button green w-full">CREAR COLABORACIÓN</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Operations Planning -->
            <div class="vintage-panel mb-8" id="operationsPlanning">
              <div class="screw screw-tl"></div>
              <div class="screw screw-tr"></div>
              <div class="screw screw-bl"></div>
              <div class="screw screw-br"></div>
              <div class="wear wear-tl"></div>
              <div class="wear wear-tr"></div>
              <div class="wear wear-bl"></div>
              <div class="wear wear-br"></div>
              
              <h3 class="text-xl font-bold mb-6 text-red-400 font-mono">PLANIFICACIÓN DE OPERACIONES</h3>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Operation Calendar -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Calendario de Operaciones</h4>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between items-center p-2 bg-red-900/30 rounded">
                      <span class="text-red-400">Operación "Thunder Strike"</span>
                      <span class="text-xs text-gray-400">Hoy 20:00</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-yellow-900/30 rounded">
                      <span class="text-yellow-400">Reunión de Coordinación</span>
                      <span class="text-xs text-gray-400">Mañana 15:00</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-green-900/30 rounded">
                      <span class="text-green-400">Operación "Silent Night"</span>
                      <span class="text-xs text-gray-400">Viernes 22:00</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-blue-900/30 rounded">
                      <span class="text-blue-400">Análisis de Inteligencia</span>
                      <span class="text-xs text-gray-400">Sábado 10:00</span>
                    </div>
                  </div>
                </div>

                <!-- Mission Briefings -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Briefings de Misión</h4>
                  <div class="space-y-3">
                    <div class="border border-gray-600 rounded p-3">
                      <h5 class="text-cyan-400 font-semibold mb-2">Operación "Thunder Strike"</h5>
                      <p class="text-sm text-gray-300 mb-2">Objetivo: Infiltrar servidores principales de XentriX y extraer datos de sus algoritmos de detección.</p>
                      <div class="flex justify-between text-xs text-gray-400">
                        <span>Dificultad: ALTA</span>
                        <span>Recompensa: 500 XP</span>
                      </div>
                    </div>
                    
                    <div class="border border-gray-600 rounded p-3">
                      <h5 class="text-green-400 font-semibold mb-2">Operación "Silent Night"</h5>
                      <p class="text-sm text-gray-300 mb-2">Objetivo: Crear música de resistencia que evada los filtros de XentriX y se propague viralmente.</p>
                      <div class="flex justify-between text-xs text-gray-400">
                        <span>Dificultad: MEDIA</span>
                        <span>Recompensa: 300 XP</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Resistance Achievements -->
            <div class="vintage-panel mb-8" id="resistanceAchievements">
              <div class="screw screw-tl"></div>
              <div class="screw screw-tr"></div>
              <div class="screw screw-bl"></div>
              <div class="screw screw-br"></div>
              <div class="wear wear-tl"></div>
              <div class="wear wear-tr"></div>
              <div class="wear wear-bl"></div>
              <div class="wear wear-br"></div>
              
              <h3 class="text-xl font-bold mb-6 text-yellow-400 font-mono">LOGROS DE LA RESISTENCIA</h3>
              
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- User Stats -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Tus Estadísticas</h4>
                  <div class="space-y-2 text-sm text-gray-300">
                    <div>Nivel: <span id="userLevel" class="text-cyan-400">15</span></div>
                    <div>XP: <span id="userXP" class="text-green-400">2,450</span></div>
                    <div>Operaciones: <span id="userOps" class="text-blue-400">23</span></div>
                    <div>Colaboraciones: <span id="userCollabs" class="text-purple-400">8</span></div>
                    <div>Rango: <span id="userRank" class="text-yellow-400">Resistance Commander</span></div>
                  </div>
                </div>

                <!-- Recent Achievements -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Logros Recientes</h4>
                  <div class="space-y-2 text-sm">
                    <div class="flex items-center text-green-400">
                      <span class="mr-2">🏆</span>
                      <span>Silent Operator</span>
                    </div>
                    <div class="flex items-center text-cyan-400">
                      <span class="mr-2">🎵</span>
                      <span>Music Revolutionary</span>
                    </div>
                    <div class="flex items-center text-yellow-400">
                      <span class="mr-2">🤝</span>
                      <span>Collaboration Master</span>
                    </div>
                    <div class="flex items-center text-red-400">
                      <span class="mr-2">⚡</span>
                      <span>XentriX Hunter</span>
                    </div>
                  </div>
                </div>

                <!-- Leaderboard -->
                <div class="bg-gray-800 rounded-lg p-4">
                  <h4 class="font-semibold text-white mb-3">Tabla de Líderes</h4>
                  <div class="space-y-2 text-sm">
                    <div class="flex justify-between items-center text-yellow-400">
                      <span>1. Resistance_Alpha</span>
                      <span>4,250 XP</span>
                    </div>
                    <div class="flex justify-between items-center text-gray-300">
                      <span>2. Pixel_Pro</span>
                      <span>3,890 XP</span>
                    </div>
                    <div class="flex justify-between items-center text-gray-300">
                      <span>3. Ghost_Master</span>
                      <span>3,450 XP</span>
                    </div>
                    <div class="flex justify-between items-center text-gray-300">
                      <span>4. Quantum_Beat</span>
                      <span>3,120 XP</span>
                    </div>
                    <div class="flex justify-between items-center text-cyan-400">
                      <span>5. Tú</span>
                      <span>2,450 XP</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- PLANS SECTION -->
        <section id="planes" class="section">
          <div class="space-y-6">
            <h2 class="text-2xl font-bold text-center">Planes de Suscripción</h2>
            
            <div class="grid md:grid-cols-3 gap-4">
              <div class="p-4 border border-white/20 rounded">
                <h3 class="text-lg font-bold text-neon">Free</h3>
                <p class="text-2xl font-bold">$0<span class="text-sm">/mes</span></p>
                <ul class="text-sm text-zinc space-y-1 mt-4">
                  <li>✓ 3 pistas por mes</li>
                  <li>✓ Calidad estándar</li>
                  <li>✓ Funciones básicas</li>
                </ul>
              </div>
              
              <div class="p-4 border border-neon rounded bg-neon/10">
                <h3 class="text-lg font-bold text-neon">Pro</h3>
                <p class="text-2xl font-bold">$10<span class="text-sm">/mes</span></p>
                <ul class="text-sm text-zinc space-y-1 mt-4">
                  <li>✓ 50 pistas por mes</li>
                  <li>✓ Calidad premium</li>
                  <li>✓ Ghost Studio incluido</li>
                  <li>✓ Sin marca de agua</li>
                </ul>
              </div>
              
              <div class="p-4 border border-purple/50 rounded">
                <h3 class="text-lg font-bold text-purple">Enterprise</h3>
                <p class="text-2xl font-bold">$50<span class="text-sm">/mes</span></p>
                <ul class="text-sm text-zinc space-y-1 mt-4">
                  <li>✓ 500 pistas por mes</li>
                  <li>✓ Calidad ultra</li>
                  <li>✓ API access</li>
                  <li>✓ Soporte prioritario</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- RIGHT SIDEBAR -->
      <div class="sidebar">
        <div class="space-y-4">
          <h3 class="text-neon font-bold text-lg">Asistente IA</h3>
          
          <!-- AI Chat -->
          <div class="p-4 bg-black/30 rounded">
            <div id="chatMessages" class="space-y-2 mb-4 h-48 overflow-y-auto">
              <div class="text-sm text-zinc">
                <span class="text-neon">IA:</span> ¡Hola! Soy tu asistente musical. ¿En qué puedo ayudarte hoy?
              </div>
            </div>
            <div class="flex gap-2">
              <input type="text" id="chatInput" placeholder="Pregunta algo..." class="flex-1 text-sm p-2 bg-black/50 border border-white/20 rounded">
              <button id="sendChat" class="console-button blue text-sm">ENVIAR</button>
            </div>
          </div>
          
          <!-- Quick Actions -->
          <div class="space-y-2">
            <h4 class="text-neon text-sm font-bold">Acciones Rápidas</h4>
            <button class="btn btn-secondary w-full text-xs px-2 py-1">💡 Generar Letra</button>
            <button class="btn btn-secondary w-full text-xs px-2 py-1">🎼 Sugerir Acordes</button>
            <button class="btn btn-secondary w-full text-xs px-2 py-1">🎨 Inspiración Musical</button>
          </div>
          
          <!-- Recent Activity -->
          <div class="p-4 bg-black/30 rounded">
            <h4 class="text-neon text-sm font-bold mb-2">Actividad Reciente</h4>
            <div class="space-y-1 text-xs text-zinc">
              <div>• Sistema iniciado</div>
              <div>• Motor de Generación Activo</div>
              <div>• Listo para generar</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ENHANCED MUSIC PLAYER (Fixed Position) -->
  <div id="musicPlayer" class="hidden fixed bottom-4 left-4 right-4 bg-black/90 backdrop-blur-xl border border-white/20 rounded-lg p-4 z-50">
    <!-- Track Info -->
    <div class="flex items-center gap-4 mb-3">
      <div class="flex items-center gap-3">
        <button id="playBtn" class="w-10 h-10 bg-neon text-black rounded-full flex items-center justify-center hover:bg-cyan-300 transition-colors">
          ▶
        </button>
        <button id="pauseBtn" class="w-10 h-10 bg-neon text-black rounded-full flex items-center justify-center hover:bg-cyan-300 transition-colors hidden">
          ⏸
        </button>
      </div>
      <div class="flex-1">
        <div class="text-sm font-bold text-white" id="trackTitle">Título de la pista</div>
        <div class="text-xs text-zinc" id="trackArtist">Generado por Son1kVers3</div>
      </div>
      <div class="flex items-center gap-2">
        <button id="downloadBtn" class="btn btn-secondary text-sm">⬇ Descargar</button>
        <button id="closePlayer" class="text-zinc hover:text-neon cursor-pointer">✕</button>
      </div>
    </div>
    
    <!-- Progress Bar -->
    <div class="mb-3">
      <div class="flex items-center gap-2 text-xs text-zinc">
        <span id="currentTime">0:00</span>
        <div class="flex-1 bg-gray-700 rounded-full h-1 cursor-pointer" id="progressBar">
          <div class="bg-neon h-1 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
        <span id="duration">0:00</span>
      </div>
    </div>
    
    <!-- Volume Control -->
    <div class="flex items-center gap-2">
      <span class="text-xs text-zinc">🔊</span>
      <input type="range" id="volumeSlider" min="0" max="100" value="70" class="flex-1 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
      <span class="text-xs text-zinc" id="volumeDisplay">70%</span>
    </div>
    
    <!-- Hidden Audio Element -->
    <audio id="audioPlayer" preload="metadata"></audio>
  </div>

  <!-- TOAST NOTIFICATIONS -->
  <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <!-- Floating Audio Player -->
  <div id="floatingPlayer" class="fixed bottom-4 right-4 z-40 bg-gray-900 rounded-lg shadow-2xl border border-gray-700 p-4 min-w-80 max-w-96" style="display: none;">
    <div class="flex items-center space-x-3 mb-3">
      <!-- Album Art -->
      <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.369 4.369 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"/>
        </svg>
      </div>
      
      <!-- Track Info -->
      <div class="flex-1 min-w-0">
        <div class="text-white font-medium text-sm truncate" id="playerTrackTitle">Track Title</div>
        <div class="text-gray-400 text-xs truncate" id="playerTrackArtist">Artist Name</div>
      </div>
      
      <!-- Close Button -->
      <button id="closePlayer" class="text-gray-400 hover:text-white transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    
    <!-- Progress Bar -->
    <div class="mb-3">
      <div class="flex items-center space-x-2 text-xs text-gray-400">
        <span id="currentTime">0:00</span>
        <div class="flex-1 bg-gray-700 rounded-full h-1 cursor-pointer" id="progressBar">
          <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-1 rounded-full transition-all duration-300" id="progressFill" style="width: 0%"></div>
        </div>
        <span id="totalTime">0:00</span>
      </div>
    </div>
    
    <!-- Controls -->
    <div class="flex items-center justify-center space-x-4">
      <!-- Previous -->
      <button id="prevTrack" class="text-gray-400 hover:text-white transition-colors">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M8.445 14.832A1 1 0 0010 14v-2.798l5.445 3.63A1 1 0 0017 14V6a1 1 0 00-1.555-.832L10 8.798V6a1 1 0 00-1.555-.832l-6 4a1 1 0 000 1.664l6 4z"/>
        </svg>
      </button>
      
      <!-- Play/Pause -->
      <button id="playPause" class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white hover:from-purple-600 hover:to-pink-600 transition-all duration-300">
        <svg id="playIcon" class="w-5 h-5 ml-0.5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M8 5v10l8-5-8-5z"/>
        </svg>
        <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20">
          <path d="M5 4h3v12H5V4zm7 0h3v12h-3V4z"/>
        </svg>
      </button>
      
      <!-- Next -->
      <button id="nextTrack" class="text-gray-400 hover:text-white transition-colors">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M11.555 14.832A1 1 0 0010 14v-2.798L4.555 14.63A1 1 0 003 14V6a1 1 0 011.555-.832L10 8.798V6a1 1 0 011.555-.832l6 4a1 1 0 010 1.664l-6 4z"/>
        </svg>
      </button>
      
      <!-- Volume -->
      <div class="flex items-center space-x-2">
        <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.617.808L4.383 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.383l4-3.808a1 1 0 011-.116zM15.657 6.343a1 1 0 011.414 0A9.972 9.972 0 0118 12a9.972 9.972 0 01-2.929 5.657 1 1 0 01-1.414-1.414A7.971 7.971 0 0016 12a7.971 7.971 0 00-1.343-4.243 1 1 0 010-1.414z"/>
        </svg>
        <input type="range" id="volumeSlider" min="0" max="100" value="70" class="w-16 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
      </div>
    </div>
    
    <!-- Track List -->
    <div id="trackList" class="mt-3 max-h-32 overflow-y-auto space-y-1" style="display: none;">
      <div class="text-xs text-gray-400 mb-2">Queue</div>
      <div id="queueItems"></div>
    </div>
    
    <!-- Waveform Visualizer -->
    <div id="waveform" class="mt-3 h-8 bg-gray-800 rounded flex items-center justify-center">
      <div class="flex space-x-1">
        <div class="w-1 bg-purple-500 rounded-full animate-pulse" style="height: 4px;"></div>
        <div class="w-1 bg-pink-500 rounded-full animate-pulse" style="height: 8px; animation-delay: 0.1s;"></div>
        <div class="w-1 bg-purple-500 rounded-full animate-pulse" style="height: 6px; animation-delay: 0.2s;"></div>
        <div class="w-1 bg-pink-500 rounded-full animate-pulse" style="height: 10px; animation-delay: 0.3s;"></div>
        <div class="w-1 bg-purple-500 rounded-full animate-pulse" style="height: 4px; animation-delay: 0.4s;"></div>
        <div class="w-1 bg-pink-500 rounded-full animate-pulse" style="height: 7px; animation-delay: 0.5s;"></div>
        <div class="w-1 bg-purple-500 rounded-full animate-pulse" style="height: 5px; animation-delay: 0.6s;"></div>
        <div class="w-1 bg-pink-500 rounded-full animate-pulse" style="height: 9px; animation-delay: 0.7s;"></div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentSection = 'home';
    let currentTrack = null;
    let isPlaying = false;
    let currentTime = 0;
    let duration = 0;
    let volume = 0.7;
    let trackQueue = [];
    let currentTrackIndex = 0;
    let userSession = {
      isLoggedIn: false,
      username: null,
      plan: 'free',
      tracksUsed: 0,
      tracksLimit: 3,
      token: null,
      user_id: 'anonymous',
      credits: 0,
      remaining_generations: 3
    };
    
    const API_BASE_URL = window.location.origin;
    
    // Función para mapear presets a modelos
    function getModelFromPreset(preset) {
      const presetModelMap = {
        'profesional': 'suno',
        'experimental': 'riffusion',
        'basico': 'nuro',
        'avanzado': 'suno'
      };
      return presetModelMap[preset] || 'nuro';
    }

    // Función para actualizar información del usuario
    async function updateUserInfo() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/user/usage?user_id=${userSession.user_id}&user_tier=${userSession.plan}`);
        const data = await response.json();
        
        userSession.credits = data.credits_used || 0;
        userSession.remaining_generations = data.remaining_generations || 0;
        
        updateUserStats();
      } catch (error) {
        console.error('Error actualizando info del usuario:', error);
      }
    }
    
    // Load existing tracks
    async function loadTracks() {
      console.log('🎵 Cargando tracks...');
      try {
        const response = await fetch(`${API_BASE_URL}/api/tracks`);
        console.log('📡 Respuesta API:', response.status);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('📊 Datos recibidos:', data);
        
        const tracksList = document.getElementById('tracksList');
        if (!tracksList) {
          console.error('❌ Elemento tracksList no encontrado');
          return;
        }
        
        if (data.tracks && data.tracks.length > 0) {
          console.log(`✅ Cargando ${data.tracks.length} tracks`);
          tracksList.innerHTML = '';
          
          data.tracks.forEach((track, index) => {
            console.log(`🎵 Track ${index + 1}:`, track.title);
            const trackElement = document.createElement('div');
            trackElement.className = 'p-4 bg-black/30 rounded border border-zinc-800 hover:border-neon/50 transition-colors mb-2';
            trackElement.innerHTML = `
              <div class="flex items-center justify-between">
                <div class="flex-1">
                  <h3 class="font-semibold text-white">${track.title}</h3>
                  <p class="text-sm text-zinc-400 mt-1">${track.prompt}</p>
                  <p class="text-xs text-zinc-500 mt-1">${new Date(track.created_at).toLocaleString()}</p>
                </div>
                <div class="flex items-center space-x-2">
                  <button onclick="playTrack('${track.id}')" class="px-3 py-1 bg-neon text-black rounded text-sm font-medium hover:bg-neon/80 transition-colors">
                    ▶️ Reproducir
                  </button>
                  <button onclick="downloadTrack('${track.id}')" class="px-3 py-1 bg-zinc-700 text-white rounded text-sm font-medium hover:bg-zinc-600 transition-colors">
                    📥 Descargar
                  </button>
                </div>
              </div>
            `;
            tracksList.appendChild(trackElement);
          });
        } else {
          console.log('ℹ️ No hay tracks disponibles');
          tracksList.innerHTML = `
            <div class="p-4 bg-black/30 rounded">
              <p class="text-zinc">No hay pistas guardadas aún.</p>
              <p class="text-sm text-zinc">Genera tu primera canción para comenzar tu archivo.</p>
            </div>
          `;
        }
      } catch (error) {
        console.error('❌ Error cargando tracks:', error);
        const tracksList = document.getElementById('tracksList');
        if (tracksList) {
          tracksList.innerHTML = `
            <div class="p-4 bg-red-900/30 rounded border border-red-500">
              <p class="text-red-400">Error cargando pistas: ${error.message}</p>
              <p class="text-xs text-red-300 mt-2">Revisa la consola para más detalles</p>
            </div>
          `;
        }
      }
    }
    
    // Play track function
    function playTrack(trackId) {
      const audio = document.getElementById('audioPlayer');
      audio.src = `${API_BASE_URL}/api/tracks/${trackId}/audio`;
      audio.play();
      startVisualizer(); // Start visualizer when playing
      showToast('Reproduciendo pista...', 'info');
    }
    
    // Download track function
    function downloadTrack(trackId) {
      const link = document.createElement('a');
      link.href = `${API_BASE_URL}/api/tracks/${trackId}/audio`;
      link.download = `track_${trackId}.mp3`;
      link.click();
      showToast('Descargando pista...', 'info');
    }
    
    // Test connection function
    async function testConnection() {
      try {
        console.log('🧪 Probando conexión...');
        const response = await fetch(`${API_BASE_URL}/api/health`);
        const data = await response.json();
        
        console.log('✅ Conexión exitosa:', data);
        showToast(`✅ Servidor funcionando: ${data.status}`, 'success');
        
        // Mostrar información del servidor
        const tracksList = document.getElementById('tracksList');
        tracksList.innerHTML = `
          <div class="p-4 bg-green-900/30 rounded border border-green-500">
            <p class="text-green-400">✅ Conexión exitosa</p>
            <p class="text-sm text-green-300">Servidor: ${data.status}</p>
            <p class="text-sm text-green-300">Tracks disponibles: ${data.tracks_available}</p>
            <p class="text-sm text-green-300">Ollama: ${data.ollama_available ? 'Sí' : 'No'}</p>
            <button onclick="loadTracks()" class="mt-2 px-3 py-1 bg-green-600 text-white rounded text-sm">
              🔄 Cargar Tracks Ahora
            </button>
          </div>
        `;
        
      } catch (error) {
        console.error('❌ Error de conexión:', error);
        showToast(`❌ Error de conexión: ${error.message}`, 'error');
        
        const tracksList = document.getElementById('tracksList');
        tracksList.innerHTML = `
          <div class="p-4 bg-red-900/30 rounded border border-red-500">
            <p class="text-red-400">❌ Error de conexión</p>
            <p class="text-sm text-red-300">${error.message}</p>
          </div>
        `;
      }
    }
    
    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      setupNavigation();
      setupKnobs();
      setupAudioVisualizer();
      setupEventListeners();
      updateUserStats();
      loadTracks(); // Cargar tracks existentes
      updateUserInfo(); // Cargar información de créditos
      setupPIXELIntegration(); // Configurar integración con PIXEL
      
      // Initialize analysis status
      updateAnalysisStatus();
    });

    // Setup PIXEL integration with generators
    function setupPIXELIntegration() {
      // Add PIXEL action buttons to chat
      const chatContainer = document.getElementById('chatMessages');
      if (chatContainer) {
        const actionButtons = document.createElement('div');
        actionButtons.id = 'pixelActions';
        actionButtons.className = 'hidden mt-4 p-3 bg-gray-800 rounded-lg';
        actionButtons.innerHTML = `
          <div class="text-sm text-neon mb-2">🤖 PIXEL sugiere:</div>
          <div class="flex gap-2 flex-wrap">
            <button onclick="pixelGeneratePrompt()" class="px-3 py-1 bg-cyan-600 text-white rounded text-xs hover:bg-cyan-700">
              🎛️ Generar Prompt
            </button>
            <button onclick="pixelGenerateLyrics()" class="px-3 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700">
              🎵 Generar Letras
            </button>
            <button onclick="pixelGenerateMusic()" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">
              🎶 Generar Música
            </button>
            <button onclick="applyRupertNeveProcessing()" class="px-3 py-1 bg-orange-600 text-white rounded text-xs hover:bg-orange-700">
              🎛️ Rupert Neve
            </button>
          </div>
        `;
        chatContainer.appendChild(actionButtons);
      }
    }

    // PIXEL action functions
    async function pixelGeneratePrompt() {
      const chatInput = document.getElementById('chatInput');
      const currentMessage = chatInput.value.trim();
      
      if (!currentMessage) {
        showToast('Escribe algo en el chat para que PIXEL genere un prompt', 'warning');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/generate-prompt`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_input: currentMessage,
            genre: 'synthwave',
            mood: 'energético'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          // Fill the prompt field
          const promptField = document.getElementById('promptEstilo');
          if (promptField) {
            promptField.value = data.generated_prompt;
            showToast('✅ PIXEL generó un prompt optimizado', 'success');
          }
        } else {
          showToast('❌ Error generando prompt con PIXEL', 'error');
        }
      } catch (error) {
        console.error('PIXEL prompt error:', error);
        showToast('❌ Error conectando con PIXEL', 'error');
      }
    }

    async function pixelGenerateLyrics() {
      const chatInput = document.getElementById('chatInput');
      const currentMessage = chatInput.value.trim();
      
      if (!currentMessage) {
        showToast('Escribe algo en el chat para que PIXEL genere letras', 'warning');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/generate-lyrics`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_words: currentMessage,
            genre: 'synthwave',
            mood: 'energético',
            structure: 'verse-chorus-verse-chorus-bridge-chorus'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success' || data.generated_lyrics) {
          // Fill the lyrics field
          const lyricsField = document.getElementById('letraCancion');
          if (lyricsField) {
            lyricsField.value = data.generated_lyrics;
            showToast('✅ PIXEL generó letras épicas', 'success');
          }
        } else {
          showToast('❌ Error generando letras con PIXEL', 'error');
        }
      } catch (error) {
        console.error('PIXEL lyrics error:', error);
        showToast('❌ Error conectando con PIXEL', 'error');
      }
    }

    async function pixelGenerateMusic() {
      const chatInput = document.getElementById('chatInput');
      const currentMessage = chatInput.value.trim();
      
      if (!currentMessage) {
        showToast('Escribe algo en el chat para que PIXEL genere música', 'warning');
        return;
      }
      
      // Fill the prompt field and trigger generation
      const promptField = document.getElementById('promptEstilo');
      if (promptField) {
        promptField.value = currentMessage;
        showToast('✅ PIXEL configuró el prompt, generando música...', 'success');
        
        // Trigger music generation
        setTimeout(() => {
          generarMusica();
        }, 1000);
      }
    }

    // Aplicar postprocesos Rupert Neve
    async function applyRupertNeveProcessing() {
      const currentTrack = getCurrentTrack();
      
      if (!currentTrack) {
        showToast('No hay track cargado para procesar', 'warning');
        return;
      }
      
      try {
        showToast('🎛️ Aplicando postprocesos Rupert Neve...', 'info');
        
        const response = await fetch(`${API_BASE_URL}/api/postprocess/rupert-neve`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            track_id: currentTrack.id,
            title: currentTrack.title,
            audio_url: currentTrack.audio_url,
            duration: currentTrack.duration,
            user_tier: userSession.plan
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          showToast('✅ Postprocesos Rupert Neve aplicados exitosamente', 'success');
          
          // Mostrar detalles del procesamiento
          const processingDetails = data.processing_details;
          const processingChain = data.processing_chain;
          
          showToast(`🎛️ Cadena de procesamiento: ${processingChain.join(' → ')}`, 'info');
          
          // Actualizar el reproductor con el track procesado
          const processedTrack = data.processed_track;
          showMusicPlayer(processedTrack);
          
        } else {
          showToast('❌ Error aplicando postprocesos Rupert Neve', 'error');
        }
        
      } catch (error) {
        console.error('Error aplicando postprocesos:', error);
        showToast('❌ Error conectando con el sistema de postprocesos', 'error');
      }
    }

    // Obtener track actual (función auxiliar)
    function getCurrentTrack() {
      // Esta función debería retornar el track actualmente cargado
      // Por ahora retornamos null, pero en una implementación real
      // esto vendría del estado del reproductor
      return null;
    }
    
    // Navigation
    function setupNavigation() {
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
          const targetSection = e.target.dataset.section;
          showSection(targetSection);
          
          // Update active tab
          document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
          e.target.classList.add('active');
        });
      });
    }
    
    function showSection(sectionName) {
      // Hide all sections
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Show target section
      const targetSection = document.getElementById(sectionName);
      if (targetSection) {
        targetSection.classList.add('active');
        currentSection = sectionName;
      }
    }
    
    // Knob controls
    function setupKnobs() {
      document.querySelectorAll('.knob').forEach(knob => {
        let isDragging = false;
        let startAngle = 0;
        let currentValue = parseInt(knob.dataset.value) || 50;
        
        updateKnobRotation(knob, currentValue);
        
        knob.addEventListener('mousedown', startDrag);
        knob.addEventListener('touchstart', startDrag);
        
        function startDrag(e) {
          isDragging = true;
          const rect = knob.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          
          const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
          const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
          
          startAngle = Math.atan2(clientY - centerY, clientX - centerX);
          
          document.addEventListener('mousemove', drag);
          document.addEventListener('mouseup', stopDrag);
          document.addEventListener('touchmove', drag);
          document.addEventListener('touchend', stopDrag);
          
          e.preventDefault();
        }
        
        function drag(e) {
          if (!isDragging) return;
          
          const rect = knob.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          
          const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
          const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
          
          const currentAngle = Math.atan2(clientY - centerY, clientX - centerX);
          const deltaAngle = currentAngle - startAngle;
          
          currentValue += (deltaAngle * 180 / Math.PI) / 3;
          currentValue = Math.max(0, Math.min(100, currentValue));
          
          updateKnobRotation(knob, currentValue);
          updateKnobDisplay(knob.dataset.knob, currentValue);
          
          startAngle = currentAngle;
          e.preventDefault();
        }
        
        function stopDrag() {
          isDragging = false;
          document.removeEventListener('mousemove', drag);
          document.removeEventListener('mouseup', stopDrag);
          document.removeEventListener('touchmove', drag);
          document.removeEventListener('touchend', stopDrag);
        }
      });
    }
    
    function updateKnobRotation(knob, value) {
      const rotation = (value / 100) * 270 - 135; // -135 to +135 degrees
      knob.style.setProperty('--rotation', rotation + 'deg');
    }
    
    function updateKnobDisplay(knobType, value) {
      const displays = {
        'expresividad': 'expresividadDisplay',
        'rareza': 'rarezaDisplay', 
        'garage': 'garageDisplay',
        'afinacion': 'afinacionDisplay',
        'expresividad-gen': 'expresividadGenDisplay'
      };
      
      const displayId = displays[knobType];
      if (displayId) {
        const display = document.getElementById(displayId);
        if (display) {
          display.textContent = Math.round(value) + '%';
        }
      }
      
      // Update knob rotation
      const knob = document.querySelector(`[data-knob="${knobType}"]`);
      if (knob) {
        const rotation = (value / 100) * 270 - 135; // 270 degrees range, centered at -135
        knob.style.setProperty('--rotation', rotation + 'deg');
      }
      
      // Update expression parameters indicator
      updateExpressionIndicator();
    }
    
    // Melody Analyzer for Ghost Studio
    class MelodyAnalyzer {
      constructor() {
        this.audioContext = null;
        this.analyser = null;
        this.dataArray = null;
        this.isAnalyzing = false;
      }
      
      async analyzeAudioFile(file) {
        try {
          if (!this.audioContext) {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
          }
          
          const arrayBuffer = await file.arrayBuffer();
          const audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);
          
          // Create analyser
          this.analyser = this.audioContext.createAnalyser();
          this.analyser.fftSize = 2048;
          this.analyser.smoothingTimeConstant = 0.8;
          
          const bufferLength = this.analyser.frequencyBinCount;
          this.dataArray = new Uint8Array(bufferLength);
          
          // Create source
          const source = this.audioContext.createBufferSource();
          source.buffer = audioBuffer;
          source.connect(this.analyser);
          
          // Analyze the audio
          const analysis = await this.performAnalysis(audioBuffer);
          
          return analysis;
        } catch (error) {
          console.error('Error analyzing audio:', error);
          return this.getDefaultAnalysis();
        }
      }
      
      async performAnalysis(audioBuffer) {
        const sampleRate = audioBuffer.sampleRate;
        const duration = audioBuffer.duration;
        const channels = audioBuffer.numberOfChannels;
        
        // Get channel data (use first channel)
        const channelData = audioBuffer.getChannelData(0);
        
        // Analyze tempo
        const tempo = this.analyzeTempo(channelData, sampleRate);
        
        // Analyze key and scale
        const keyScale = this.analyzeKeyScale(channelData, sampleRate);
        
        // Analyze dynamics
        const dynamics = this.analyzeDynamics(channelData);
        
        // Analyze frequency content
        const frequencyAnalysis = this.analyzeFrequencyContent(channelData, sampleRate);
        
        // Analyze rhythm patterns
        const rhythm = this.analyzeRhythm(channelData, sampleRate, tempo);
        
        // Generate prompt based on analysis
        const prompt = this.generatePromptFromAnalysis({
          tempo,
          keyScale,
          dynamics,
          frequencyAnalysis,
          rhythm,
          duration,
          channels
        });
        
        return {
          tempo,
          keyScale,
          dynamics,
          frequencyAnalysis,
          rhythm,
          duration,
          channels,
          prompt
        };
      }
      
      analyzeTempo(channelData, sampleRate) {
        // Simple tempo detection using onset detection
        const windowSize = Math.floor(sampleRate * 0.1); // 100ms windows
        const onsets = [];
        
        for (let i = windowSize; i < channelData.length - windowSize; i += windowSize) {
          const window = channelData.slice(i - windowSize, i + windowSize);
          const energy = this.calculateEnergy(window);
          
          if (energy > 0.1) { // Threshold for onset detection
            onsets.push(i / sampleRate);
          }
        }
        
        if (onsets.length < 2) return 120; // Default tempo
        
        // Calculate average interval between onsets
        const intervals = [];
        for (let i = 1; i < onsets.length; i++) {
          intervals.push(onsets[i] - onsets[i-1]);
        }
        
        const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
        const bpm = 60 / avgInterval;
        
        return Math.round(Math.max(60, Math.min(200, bpm))); // Clamp between 60-200 BPM
      }
      
      analyzeKeyScale(channelData, sampleRate) {
        // Simple key detection using chroma features
        const chroma = this.calculateChromaFeatures(channelData, sampleRate);
        
        // Major and minor key profiles
        const majorProfile = [1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1]; // C major
        const minorProfile = [1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0]; // A minor
        
        let majorScore = 0;
        let minorScore = 0;
        
        for (let i = 0; i < 12; i++) {
          majorScore += chroma[i] * majorProfile[i];
          minorScore += chroma[i] * minorProfile[i];
        }
        
        const keys = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const keyIndex = chroma.indexOf(Math.max(...chroma));
        const key = keys[keyIndex];
        
        return {
          key: key,
          scale: majorScore > minorScore ? 'major' : 'minor',
          confidence: Math.max(majorScore, minorScore)
        };
      }
      
      analyzeDynamics(channelData) {
        const rms = this.calculateRMS(channelData);
        const peak = Math.max(...channelData.map(Math.abs));
        
        let dynamicLevel = 'medium';
        if (rms < 0.1) dynamicLevel = 'quiet';
        else if (rms > 0.3) dynamicLevel = 'loud';
        
        return {
          rms,
          peak,
          level: dynamicLevel
        };
      }
      
      analyzeFrequencyContent(channelData, sampleRate) {
        // Simple frequency analysis
        const fft = this.simpleFFT(channelData);
        const nyquist = sampleRate / 2;
        
        // Analyze frequency bands
        const bass = this.getFrequencyBand(fft, 0, 250, nyquist);
        const mid = this.getFrequencyBand(fft, 250, 4000, nyquist);
        const treble = this.getFrequencyBand(fft, 4000, nyquist, nyquist);
        
        let dominantBand = 'mid';
        if (bass > mid && bass > treble) dominantBand = 'bass';
        else if (treble > mid && treble > bass) dominantBand = 'treble';
        
        return {
          bass,
          mid,
          treble,
          dominantBand
        };
      }
      
      analyzeRhythm(channelData, sampleRate, tempo) {
        // Analyze rhythm patterns
        const beatDuration = 60 / tempo; // Duration of one beat in seconds
        const samplesPerBeat = Math.floor(beatDuration * sampleRate);
        
        // Simple rhythm analysis
        const rhythmComplexity = this.calculateRhythmComplexity(channelData, samplesPerBeat);
        
        return {
          complexity: rhythmComplexity,
          pattern: rhythmComplexity > 0.7 ? 'complex' : 'simple'
        };
      }
      
      generatePromptFromAnalysis(analysis) {
        const { tempo, keyScale, dynamics, frequencyAnalysis, rhythm, duration } = analysis;
        
        let prompt = '';
        
        // Tempo description
        if (tempo < 80) prompt += 'slow, ';
        else if (tempo > 140) prompt += 'fast, ';
        else prompt += 'moderate tempo, ';
        
        // Key and scale
        prompt += `${keyScale.key} ${keyScale.scale}, `;
        
        // Dynamics
        if (dynamics.level === 'quiet') prompt += 'soft and gentle, ';
        else if (dynamics.level === 'loud') prompt += 'powerful and intense, ';
        
        // Frequency content
        if (frequencyAnalysis.dominantBand === 'bass') prompt += 'bass-heavy, ';
        else if (frequencyAnalysis.dominantBand === 'treble') prompt += 'bright and crisp, ';
        
        // Rhythm
        if (rhythm.pattern === 'complex') prompt += 'complex rhythm, ';
        else prompt += 'steady rhythm, ';
        
        // Duration
        if (duration < 60) prompt += 'short track, ';
        else if (duration > 240) prompt += 'long track, ';
        
        // Genre hints based on analysis
        if (tempo > 120 && frequencyAnalysis.dominantBand === 'bass') {
          prompt += 'electronic dance style, ';
        } else if (tempo < 100 && keyScale.scale === 'minor') {
          prompt += 'melancholic ballad style, ';
        } else if (rhythm.pattern === 'complex' && dynamics.level === 'loud') {
          prompt += 'progressive rock style, ';
        }
        
        return prompt.trim().replace(/,\s*$/, ''); // Remove trailing comma
      }
      
      // Helper methods
      calculateEnergy(samples) {
        let sum = 0;
        for (let i = 0; i < samples.length; i++) {
          sum += samples[i] * samples[i];
        }
        return Math.sqrt(sum / samples.length);
      }
      
      calculateRMS(samples) {
        let sum = 0;
        for (let i = 0; i < samples.length; i++) {
          sum += samples[i] * samples[i];
        }
        return Math.sqrt(sum / samples.length);
      }
      
      calculateChromaFeatures(channelData, sampleRate) {
        // Simplified chroma calculation
        const chroma = new Array(12).fill(0);
        const fft = this.simpleFFT(channelData);
        
        for (let i = 0; i < fft.length; i++) {
          const freq = (i * sampleRate) / (2 * fft.length);
          const note = Math.round(12 * Math.log2(freq / 440)) % 12;
          if (note >= 0 && note < 12) {
            chroma[note] += fft[i];
          }
        }
        
        return chroma;
      }
      
      simpleFFT(samples) {
        // Simplified FFT implementation
        const N = samples.length;
        const fft = new Array(N).fill(0);
        
        for (let k = 0; k < N; k++) {
          let real = 0;
          let imag = 0;
          
          for (let n = 0; n < N; n++) {
            const angle = -2 * Math.PI * k * n / N;
            real += samples[n] * Math.cos(angle);
            imag += samples[n] * Math.sin(angle);
          }
          
          fft[k] = Math.sqrt(real * real + imag * imag);
        }
        
        return fft;
      }
      
      getFrequencyBand(fft, lowFreq, highFreq, nyquist) {
        const lowBin = Math.floor((lowFreq / nyquist) * fft.length);
        const highBin = Math.floor((highFreq / nyquist) * fft.length);
        
        let sum = 0;
        for (let i = lowBin; i < highBin && i < fft.length; i++) {
          sum += fft[i];
        }
        
        return sum / (highBin - lowBin);
      }
      
      calculateRhythmComplexity(samples, samplesPerBeat) {
        let complexity = 0;
        const beats = Math.floor(samples.length / samplesPerBeat);
        
        for (let beat = 0; beat < beats; beat++) {
          const start = beat * samplesPerBeat;
          const end = Math.min(start + samplesPerBeat, samples.length);
          const beatSamples = samples.slice(start, end);
          
          // Calculate variation within the beat
          const mean = beatSamples.reduce((a, b) => a + b, 0) / beatSamples.length;
          const variance = beatSamples.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / beatSamples.length;
          complexity += Math.sqrt(variance);
        }
        
        return Math.min(1, complexity / beats);
      }
      
      getDefaultAnalysis() {
        return {
          tempo: 120,
          keyScale: { key: 'C', scale: 'major', confidence: 0.5 },
          dynamics: { rms: 0.2, peak: 0.5, level: 'medium' },
          frequencyAnalysis: { bass: 0.3, mid: 0.5, treble: 0.2, dominantBand: 'mid' },
          rhythm: { complexity: 0.5, pattern: 'simple' },
          duration: 180,
          channels: 2,
          prompt: 'moderate tempo, C major, steady rhythm, balanced sound'
        };
      }
    }
    
    // Global melody analyzer instance
    const melodyAnalyzer = new MelodyAnalyzer();
    
    // Store current analysis result
    let currentAnalysis = null;
    let analysisEnabled = false;

    // Toggle analysis functionality
    function toggleAnalysis(event) {
      analysisEnabled = event.target.checked;
      updateAnalysisStatus();
      
      if (analysisEnabled) {
        showToast('Analysis enabled - Audio will be automatically analyzed', 'info');
      } else {
        showToast('Analysis disabled - Manual prompt required', 'info');
        // Clear any existing analysis
        currentAnalysis = null;
        document.getElementById('autoGeneratedPrompt').value = '';
        document.getElementById('analysisResult').classList.add('hidden');
      }
    }
    
    // Update analysis status indicator
    function updateAnalysisStatus() {
      const indicator = document.getElementById('analysisStatusIndicator');
      const dot = indicator.querySelector('div');
      const text = indicator.querySelector('span');
      const hint = document.getElementById('transformHint');
      
      if (analysisEnabled) {
        dot.className = 'w-2 h-2 bg-green-500 rounded-full animate-pulse';
        text.textContent = 'ANALYSIS ON';
        text.className = 'text-green-400';
        hint.textContent = 'Analysis enabled - Intelligent prompts will be generated';
        hint.className = 'mt-2 text-xs text-green-400 font-mono';
      } else {
        dot.className = 'w-2 h-2 bg-gray-500 rounded-full';
        text.textContent = 'ANALYSIS OFF';
        text.className = 'text-gray-400';
        hint.textContent = 'Analysis disabled - Manual transformation only';
        hint.className = 'mt-2 text-xs text-gray-400 font-mono';
      }
    }

    // Handle audio file upload and analysis
    async function handleAudioFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Only analyze if analysis is enabled
      if (!analysisEnabled) {
        showToast('Analysis disabled - Please enable analysis or provide manual prompt', 'warning');
        return;
      }
      
      // Show analysis status
      const statusDiv = document.getElementById('analysisStatus');
      const resultDiv = document.getElementById('analysisResult');
      const autoPromptField = document.getElementById('autoGeneratedPrompt');
      
      statusDiv.classList.remove('hidden');
      resultDiv.classList.add('hidden');
      
      try {
        // Analyze the audio file
        currentAnalysis = await melodyAnalyzer.analyzeAudioFile(file);
        
        // Store the generated prompt
        autoPromptField.value = currentAnalysis.prompt;
        
        // Show success status
        statusDiv.classList.add('hidden');
        resultDiv.classList.remove('hidden');
        
        // Show toast with analysis details
        showToast(`Audio analyzed: ${currentAnalysis.tempo} BPM, ${currentAnalysis.keyScale.key} ${currentAnalysis.keyScale.scale}`, 'success');
        
        console.log('Audio analysis result:', currentAnalysis);
        
      } catch (error) {
        console.error('Error analyzing audio:', error);
        statusDiv.classList.add('hidden');
        showToast('Error analyzing audio file', 'error');
      }
    }
    
    // Transform audio using analysis
    async function transformAudio() {
      const transformationType = document.getElementById('transformationType').value;
      const autoPrompt = document.getElementById('autoGeneratedPrompt').value;
      
      // Check if we have a file uploaded
      const audioFile = document.getElementById('audioFile').files[0];
      if (!audioFile) {
        showToast('Please upload an audio file first', 'warning');
        return;
      }
      
      const btn = document.getElementById('transformAudio');
      const originalText = btn.textContent;
      btn.disabled = true;
      btn.textContent = 'Transforming...';
      
      try {
        let prompt, analysisData;
        
        if (analysisEnabled && currentAnalysis) {
          // Use auto-generated prompt and analysis data
          prompt = autoPrompt || 'audio transformation based on analysis';
          analysisData = {
            tempo: currentAnalysis.tempo,
            key: currentAnalysis.keyScale.key,
            scale: currentAnalysis.keyScale.scale,
            dynamics: currentAnalysis.dynamics.level,
            frequency_band: currentAnalysis.frequencyAnalysis.dominantBand,
            rhythm_complexity: currentAnalysis.rhythm.complexity,
            duration: currentAnalysis.duration
          };
        } else {
          // Use manual prompt (no analysis)
          prompt = prompt || `${transformationType} transformation`;
          analysisData = null;
        }
        
        // Send transformation request
        const response = await fetch(`${API_BASE_URL}/api/transform-audio`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            transformation_type: transformationType,
            prompt: prompt,
            analysis_data: analysisData,
            analysis_enabled: analysisEnabled,
            user_id: userSession.user_id || 'anonymous',
            user_tier: userSession.plan || 'free'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          showToast('Audio transformation completed!', 'success');
          
          // Add to tracks list if successful
          if (data.audio_url) {
            const track = {
              id: data.track_id || `transformed_${Date.now()}`,
              title: `Transformed Audio - ${transformationType}`,
              audio_url: data.audio_url,
              download_url: data.download_url,
              duration: data.duration || currentAnalysis.duration,
              tags: transformationType,
              generated_prompt: prompt
            };
            
            // Add to tracks (if you have a tracks management system)
            console.log('Transformed track:', track);
          }
        } else {
          showToast('Transformation failed: ' + (data.error || 'Unknown error'), 'error');
        }
        
      } catch (error) {
        console.error('Error transforming audio:', error);
        showToast('Error during transformation', 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = originalText;
      }
    }

    // Function to update expression parameters indicator
    function updateExpressionIndicator() {
      const expressionParams = getExpressionParameters();
      
      // Create or update indicator element
      let indicator = document.getElementById('expressionIndicator');
      if (!indicator) {
        indicator = document.createElement('div');
        indicator.id = 'expressionIndicator';
        indicator.className = 'fixed bottom-4 right-4 bg-zinc-800/90 border border-amber-500/30 rounded-lg p-3 text-xs font-mono text-amber-300 z-50 opacity-0 transition-opacity duration-300';
        indicator.innerHTML = `
          <div class="text-center mb-2 text-amber-400 font-bold">EXPRESSION PARAMS</div>
          <div>Mood: <span id="indicatorMood">${expressionParams.mood}</span></div>
          <div>Intensity: <span id="indicatorIntensity">${expressionParams.intensity}</span></div>
          <div>Rareza: <span id="indicatorRareza">${expressionParams.rareza}%</span></div>
          <div>Garage: <span id="indicatorGarage">${expressionParams.garage}%</span></div>
        `;
        document.body.appendChild(indicator);
      }
      
      // Update values
      document.getElementById('indicatorMood').textContent = expressionParams.mood;
      document.getElementById('indicatorIntensity').textContent = expressionParams.intensity;
      document.getElementById('indicatorRareza').textContent = expressionParams.rareza + '%';
      document.getElementById('indicatorGarage').textContent = expressionParams.garage + '%';
      
      // Show indicator briefly
      indicator.style.opacity = '1';
      setTimeout(() => {
        indicator.style.opacity = '0';
      }, 2000);
      
      // Update button status indicator
      const expressionStatus = document.getElementById('expressionStatus');
      if (expressionStatus) {
        expressionStatus.style.opacity = '1';
        setTimeout(() => {
          expressionStatus.style.opacity = '0';
        }, 3000);
      }
    }
    
    // Audio visualizer
    let visualizerAnimationId = null;
    let isVisualizerActive = false;
    
    function setupAudioVisualizer() {
      const canvas = document.getElementById('visualizerCanvas');
      const ctx = canvas.getContext('2d');
      
      // Clear visualizer when not playing
      function clearVisualizer() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
      
      // Animated visualizer that responds to audio
      function animate() {
        if (!isVisualizerActive) {
          clearVisualizer();
          return;
        }
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw animated bars with more realistic audio-like behavior
        const barCount = 20;
        const barWidth = canvas.width / barCount;
        const time = Date.now() * 0.003; // Slower animation
        
        for (let i = 0; i < barCount; i++) {
          // Create more realistic audio bar heights
          const frequency = (i / barCount) * 4; // Different frequencies for different bars
          const amplitude = Math.sin(time + frequency) * 0.5 + 0.5;
          const height = amplitude * canvas.height * 0.8 + 5;
          
          const x = i * barWidth;
          const y = canvas.height - height;
          
          // Create gradient based on bar height (more dynamic)
          const gradient = ctx.createLinearGradient(0, y, 0, canvas.height);
          const intensity = height / canvas.height;
          
          if (intensity > 0.7) {
            gradient.addColorStop(0, '#FF6B6B'); // Red for high intensity
            gradient.addColorStop(1, '#FFE66D');
          } else if (intensity > 0.4) {
            gradient.addColorStop(0, '#4ECDC4'); // Teal for medium intensity
            gradient.addColorStop(1, '#45B7D1');
          } else {
            gradient.addColorStop(0, '#00FFE7'); // Cyan for low intensity
            gradient.addColorStop(1, '#8b5cf6');
          }
          
          ctx.fillStyle = gradient;
          ctx.fillRect(x, y, barWidth - 2, height);
        }
        
        visualizerAnimationId = requestAnimationFrame(animate);
      }
      
      // Start with clear state
      clearVisualizer();
      
      // Store animation function globally for control
      window.visualizerAnimate = animate;
    }
    
    // Functions to control visualizer
    function startVisualizer() {
      if (!isVisualizerActive) {
        isVisualizerActive = true;
        if (window.visualizerAnimate) {
          window.visualizerAnimate();
        }
      }
    }
    
    function stopVisualizer() {
      isVisualizerActive = false;
      if (visualizerAnimationId) {
        cancelAnimationFrame(visualizerAnimationId);
        visualizerAnimationId = null;
      }
      // Clear the canvas
      const canvas = document.getElementById('visualizerCanvas');
      if (canvas) {
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#666';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('No Audio', canvas.width / 2, canvas.height / 2);
      }
    }
    
    // Event listeners
    function setupEventListeners() {
      // Generation button
      document.getElementById('generarMusica')?.addEventListener('click', generarMusica);
      
      // Studio entry buttons
      document.getElementById('entrarEstudio')?.addEventListener('click', () => showSection('generacion'));
      
      // Easter egg portal to son1k-ready terminal universe
      document.getElementById('conocerUniverso')?.addEventListener('click', activatePortal);
      
      // Login functionality
      document.getElementById('loginBtn')?.addEventListener('click', showLoginModal);
      
      // Chat functionality
      document.getElementById('sendChat')?.addEventListener('click', sendChatMessage);
      document.getElementById('chatInput')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendChatMessage();
      });
      
      // Ghost Studio audio file analysis
      document.getElementById('audioFile')?.addEventListener('change', handleAudioFileUpload);
      
      // Ghost Studio transform button
      document.getElementById('transformAudio')?.addEventListener('click', transformAudio);
      
      // Analysis toggle
      document.getElementById('analysisToggle')?.addEventListener('change', toggleAnalysis);
    }
    
    // Function to get expression parameters from knobs
    function getExpressionParameters() {
      const expresividadValue = parseInt(document.getElementById('expresividadDisplay')?.textContent || '75');
      const rarezaValue = parseInt(document.getElementById('rarezaDisplay')?.textContent || '60');
      const garageValue = parseInt(document.getElementById('garageDisplay')?.textContent || '80');
      
      // Map expression value to mood and intensity
      const moodMapping = {
        0: 'calm',
        20: 'melancholic', 
        40: 'neutral',
        60: 'energetic',
        80: 'intense',
        100: 'aggressive'
      };
      
      const intensityMapping = {
        0: 'low',
        20: 'low-medium',
        40: 'medium',
        60: 'medium-high',
        80: 'high',
        100: 'maximum'
      };
      
      // Get mood based on expression value
      const moodKeys = Object.keys(moodMapping).map(Number).sort((a, b) => a - b);
      let selectedMood = 'neutral';
      for (let i = 0; i < moodKeys.length; i++) {
        if (expresividadValue >= moodKeys[i]) {
          selectedMood = moodMapping[moodKeys[i]];
        } else {
          break;
        }
      }
      
      // Get intensity based on expression value
      const intensityKeys = Object.keys(intensityMapping).map(Number).sort((a, b) => a - b);
      let selectedIntensity = 'medium';
      for (let i = 0; i < intensityKeys.length; i++) {
        if (expresividadValue >= intensityKeys[i]) {
          selectedIntensity = intensityMapping[intensityKeys[i]];
        } else {
          break;
        }
      }
      
      return {
        mood: selectedMood,
        intensity: selectedIntensity,
        rareza: rarezaValue,
        garage: garageValue,
        expression: expresividadValue
      };
    }
    
    // Function to enhance prompt with expression parameters
    function enhancePromptWithExpression(originalPrompt, expressionParams) {
      const { mood, intensity, rareza, garage } = expressionParams;
      
      // Create mood descriptors
      const moodDescriptors = {
        'calm': 'serene, peaceful, gentle',
        'melancholic': 'sad, introspective, emotional',
        'neutral': 'balanced, moderate, stable',
        'energetic': 'upbeat, lively, dynamic',
        'intense': 'powerful, dramatic, strong',
        'aggressive': 'hard-hitting, intense, powerful'
      };
      
      // Create intensity descriptors
      const intensityDescriptors = {
        'low': 'soft, subtle, gentle',
        'low-medium': 'moderate, balanced',
        'medium': 'standard, normal',
        'medium-high': 'strong, prominent',
        'high': 'powerful, intense',
        'maximum': 'extreme, maximum intensity'
      };
      
      const moodDesc = moodDescriptors[mood] || '';
      const intensityDesc = intensityDescriptors[intensity] || '';
      
      // Build enhanced prompt
      let enhancedPrompt = originalPrompt;
      
      if (moodDesc) {
        enhancedPrompt += `, ${moodDesc} mood`;
      }
      
      if (intensityDesc) {
        enhancedPrompt += `, ${intensityDesc} energy`;
      }
      
      // Add rareza modifier
      if (rareza > 70) {
        enhancedPrompt += ', weird and experimental';
      } else if (rareza < 30) {
        enhancedPrompt += ', normal and conventional';
      } else {
        enhancedPrompt += ', slightly unusual';
      }
      
      // Add garage modifier
      if (garage > 80) {
        enhancedPrompt += ', raw and garage-style';
      } else if (garage < 40) {
        enhancedPrompt += ', clean and polished';
      } else {
        enhancedPrompt += ', balanced garage sound';
      }
      
      return enhancedPrompt;
    }

    // Music generation with credit system
    async function generarMusica() {
      if (!checkUserLimits()) return;
      
      const letra = document.getElementById('letraCancion').value;
      const estilo = document.getElementById('promptEstilo').value;
      const preset = document.getElementById('presetGeneracion').value;
      
      if (!letra && !estilo) {
        showToast('Por favor ingresa una letra o prompt de estilo', 'warning');
        return;
      }
      
      // Get expression parameters from knobs
      const expressionParams = getExpressionParameters();
      
      // Enhance the prompt with expression parameters
      const enhancedPrompt = enhancePromptWithExpression(estilo || 'canción con letra personalizada', expressionParams);
      
      const btn = document.getElementById('generarMusica');
      btn.disabled = true;
      btn.textContent = 'Generando música...';
      
      try {
        // Usar el nuevo endpoint con sistema de créditos
        const response = await fetch(`${API_BASE_URL}/api/generate-with-credits`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            prompt: enhancedPrompt, // Use enhanced prompt
            lyrics: letra || '',
            style: preset || 'profesional',
            user_id: userSession.user_id || 'anonymous',
            user_tier: userSession.plan || 'free',
            model: getModelFromPreset(preset),
            generate_lyrics: !letra, // Generar letras si no hay letra
            optimize_prompt: true,
            // Add expression parameters for backend processing
            expression_params: {
              mood: expressionParams.mood,
              intensity: expressionParams.intensity,
              rareza: expressionParams.rareza,
              garage: expressionParams.garage,
              expression_level: expressionParams.expression
            }
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success' && data.audio_url) {
          // Convert new API format to expected track format
          const track = {
            id: data.track_id,
            title: data.title,
            audio_url: data.audio_url,
            download_url: data.download_url,
            duration: data.duration,
            tags: data.style || 'profesional'
          };
          
          showToast('¡Música generada con éxito!', 'success');
          
          // Show floating player
          const trackData = {
            id: data.track_id,
            title: data.title || 'Generated Track',
            artist: 'Son1kVers3',
            audioUrl: data.audio_url,
            duration: data.duration
          };
          
          showFloatingPlayer(trackData);
          
          // Mostrar información de créditos consumidos
          if (data.credits_consumed) {
            showToast(`Créditos consumidos: ${data.credits_consumed}`, 'info');
          }
          
          // Mostrar información de postprocesos Rupert Neve
          if (data.post_processing) {
            showToast(`🎛️ Postprocesos Rupert Neve aplicados: SSL + Expresividad + Saturación`, 'success');
          }
          
          if (data.translation_applied) {
            showToast(`Prompt optimizado automáticamente: "${data.optimized_prompt}"`, 'info');
          }
          
          // Actualizar información del usuario
          updateUserInfo();
          
          userSession.tracksUsed++;
          updateUserStats();
          
          showMusicPlayer(track);
          loadTracks(); // Recargar lista de tracks
        } else {
          showToast('Error al generar música: ' + (data.detail || data.error || 'Error desconocido'), 'error');
        }
      } catch (error) {
        showToast('Error al generar música: ' + error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = '🎵 Generar Música';
      }
    }
    
    // User limits check with credit system
    function checkUserLimits() {
      // Verificar límites de generaciones mensuales
      if (userSession.remaining_generations === 0 && userSession.plan !== 'premium') {
        showToast('Has alcanzado tu límite mensual de generaciones. Actualiza tu plan para continuar.', 'warning');
        return false;
      }
      
      // Verificar límites de pistas (sistema legacy)
      if (userSession.tracksUsed >= userSession.tracksLimit) {
        showToast('Has alcanzado el límite de pistas para tu plan. Actualiza para continuar.', 'warning');
        return false;
      }
      
      return true;
    }
    
    // Update user stats
    function updateUserStats() {
      document.getElementById('userPlan').textContent = userSession.plan;
      document.getElementById('userTracks').textContent = userSession.tracksUsed;
      document.getElementById('userLimit').textContent = userSession.tracksLimit;
      
      // Actualizar información de créditos si los elementos existen
      const creditsElement = document.getElementById('userCredits');
      const remainingElement = document.getElementById('userRemaining');
      
      if (creditsElement) {
        creditsElement.textContent = userSession.credits;
      }
      if (remainingElement) {
        remainingElement.textContent = userSession.remaining_generations;
      }
    }
    
    // Enhanced Music player with full controls
    function showMusicPlayer(track) {
      const player = document.getElementById('musicPlayer');
      const audio = document.getElementById('audioPlayer');
      const title = document.getElementById('trackTitle');
      
      if (track.audio_url) {
        audio.src = track.audio_url;
        title.textContent = track.title || 'Nueva generación';
        player.classList.remove('hidden');
        
        // Show success message
        showToast('🎵 Reproductor cargado - ¡Disfruta tu música!', 'success');
        
        // Setup player controls
        setupMusicPlayerControls();
        
        // Auto-play if possible
        audio.play().catch(e => {
          console.log('Auto-play blocked:', e);
          showToast('Haz clic en play para reproducir', 'info');
        });
      }
    }

    // Setup music player controls
    function setupMusicPlayerControls() {
      const audio = document.getElementById('audioPlayer');
      const playBtn = document.getElementById('playBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const progressBar = document.getElementById('progressBar');
      const volumeSlider = document.getElementById('volumeSlider');
      const currentTime = document.getElementById('currentTime');
      const duration = document.getElementById('duration');
      
      if (!audio) return;
      
      // Play/Pause functionality
      if (playBtn) {
        playBtn.addEventListener('click', () => {
          audio.play();
          playBtn.style.display = 'none';
          if (pauseBtn) pauseBtn.style.display = 'inline-block';
          startVisualizer(); // Start visualizer when playing
        });
      }
      
      if (pauseBtn) {
        pauseBtn.addEventListener('click', () => {
          audio.pause();
          pauseBtn.style.display = 'none';
          if (playBtn) playBtn.style.display = 'inline-block';
          stopVisualizer(); // Stop visualizer when paused
        });
      }
      
      // Audio event listeners for visualizer control
      audio.addEventListener('play', () => {
        startVisualizer();
      });
      
      audio.addEventListener('pause', () => {
        stopVisualizer();
      });
      
      audio.addEventListener('ended', () => {
        stopVisualizer();
        if (playBtn) playBtn.style.display = 'inline-block';
        if (pauseBtn) pauseBtn.style.display = 'none';
      });
      
      // Progress bar
      if (progressBar) {
        audio.addEventListener('timeupdate', () => {
          const progress = (audio.currentTime / audio.duration) * 100;
          progressBar.style.width = progress + '%';
          
          if (currentTime) {
            currentTime.textContent = formatTime(audio.currentTime);
          }
        });
        
        progressBar.addEventListener('click', (e) => {
          const rect = progressBar.getBoundingClientRect();
          const clickX = e.clientX - rect.left;
          const width = rect.width;
          const clickTime = (clickX / width) * audio.duration;
          audio.currentTime = clickTime;
        });
      }
      
      // Volume control
      if (volumeSlider) {
        volumeSlider.addEventListener('input', (e) => {
          audio.volume = e.target.value / 100;
        });
      }
      
      // Duration display
      audio.addEventListener('loadedmetadata', () => {
        if (duration) {
          duration.textContent = formatTime(audio.duration);
        }
      });
    }
    
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    // Chat functionality with real AI
    async function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      const chatMessages = document.getElementById('chatMessages');
      
      // Add user message
      const userMsg = document.createElement('div');
      userMsg.className = 'text-sm';
      userMsg.innerHTML = `<span class="text-neon">Tú:</span> ${message}`;
      chatMessages.appendChild(userMsg);
      
      // Show loading indicator
      const loadingMsg = document.createElement('div');
      loadingMsg.className = 'text-sm text-zinc';
      loadingMsg.innerHTML = `<span class="text-neon">IA:</span> <span class="animate-pulse">Pensando...</span>`;
      chatMessages.appendChild(loadingMsg);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      input.value = '';
      
      try {
        // Call backend AI assistant
        const response = await fetch(`${API_BASE_URL}/api/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: message,
            context: 'musical_assistant',
            user_session: userSession
          })
        });
        
        const data = await response.json();
        
        // Remove loading message
        loadingMsg.remove();
        
        // Add AI response
        const aiMsg = document.createElement('div');
        aiMsg.className = 'text-sm text-zinc';
        aiMsg.innerHTML = `<span class="text-neon">IA:</span> ${data.response || 'Lo siento, no pude procesar tu mensaje.'}`;
        chatMessages.appendChild(aiMsg);
        
      } catch (error) {
        // Remove loading message and show error
        loadingMsg.remove();
        
        const errorMsg = document.createElement('div');
        errorMsg.className = 'text-sm text-zinc';
        errorMsg.innerHTML = `<span class="text-neon">IA:</span> Error de conexión. Usando respuesta local: ${generateLocalResponse(message)}`;
        chatMessages.appendChild(errorMsg);
      }
      
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // Local fallback responses
    function generateLocalResponse(message) {
      const lowerMsg = message.toLowerCase();
      
      if (lowerMsg.includes('letra') || lowerMsg.includes('lyric')) {
        return '¿Te ayudo a crear una letra? Puedo generar versos basados en tu tema o estado de ánimo.';
      } else if (lowerMsg.includes('prompt') || lowerMsg.includes('estilo')) {
        return 'Puedo sugerir prompts musicales. ¿Qué género o mood tienes en mente?';
      } else if (lowerMsg.includes('acordes') || lowerMsg.includes('music')) {
        return 'Para sugerencias musicales, ¿prefieres algo melódico, rítmico o experimental?';
      } else if (lowerMsg.includes('generar') || lowerMsg.includes('crear')) {
        return '¡Perfecto! ¿Quieres que genere una letra, un prompt musical, o ambos?';
      } else {
        return `Interesante. Puedo ayudarte con letras, prompts musicales, o sugerencias creativas. ¿En qué te gustaría que me enfoque?`;
      }
    }
    
    // Toast notifications
    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      };
      
      toast.className = `${colors[type]} text-white px-4 py-3 rounded shadow-lg`;
      toast.textContent = message;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 5000);
    }
    
    // Easter egg portal activation
    function activatePortal() {
      const btn = document.getElementById('conocerUniverso');
      let clicks = parseInt(btn.getAttribute('data-clicks') || '0');
      clicks++;
      btn.setAttribute('data-clicks', clicks.toString());
      
      const portalSequence = [
        'Conocer el Universo',
        '◯ Grietas se abren ◯',
        '⚡ Descifrando... ⚡',
        '△ Portal activado △',
        '🌌 Ingresando... 🌌'
      ];
      
      if (clicks <= portalSequence.length) {
        btn.textContent = portalSequence[clicks - 1];
        
        if (clicks === 3) {
          // Start glitch effect
          btn.style.animation = 'glitch 0.5s infinite';
          document.body.style.filter = 'hue-rotate(180deg) contrast(1.2)';
        }
        
        if (clicks === 5) {
          // Portal activation sequence
          showToast('🌌 Portal de la Resistencia activado...', 'info');
          setTimeout(() => {
            // Activate portal via API
            activateResistancePortal();
          }, 2000);
        }
      }
    }
    
    // Activate resistance portal via API
    async function activateResistancePortal() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/easter-eggs/portal`);
        const data = await response.json();
        
        if (data.status === 'success') {
          showToast(data.message, 'success');
          createTerminalPortal();
        }
      } catch (error) {
        console.error('Portal activation error:', error);
        createTerminalPortal(); // Fallback
      }
    }
    
    // Konami code easter egg
    let konamiCode = [];
    const konamiSequence = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65]; // ↑↑↓↓←→←→BA
    
    document.addEventListener('keydown', (e) => {
      konamiCode.push(e.keyCode);
      if (konamiCode.length > konamiSequence.length) {
        konamiCode.shift();
      }
      
      if (konamiCode.join(',') === konamiSequence.join(',')) {
        activateKonamiCode();
        konamiCode = [];
      }
    });
    
    async function activateKonamiCode() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/easter-eggs/konami`);
        const data = await response.json();
        
        if (data.status === 'success') {
          showToast(data.message, 'success');
          
          // Activar modo desarrollador
          document.body.classList.add('developer-mode');
          
          // Mostrar herramientas de desarrollador
          showDeveloperTools();
        }
      } catch (error) {
        console.error('Konami code error:', error);
      }
    }
    
    function showDeveloperTools() {
      const devTools = document.createElement('div');
      devTools.id = 'developer-tools';
      devTools.style.cssText = `
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid #00FFE7;
        border-radius: 8px;
        padding: 10px;
        color: #00FFE7;
        font-family: monospace;
        font-size: 12px;
        z-index: 9999;
        max-width: 300px;
      `;
      
      devTools.innerHTML = `
        <div style="font-weight: bold; margin-bottom: 10px;">🛠️ Developer Tools</div>
        <div>Status: <span style="color: #00ff00;">Active</span></div>
        <div>Mode: <span style="color: #ffff00;">Resistance</span></div>
        <div>API: <span style="color: #00ff00;">Connected</span></div>
        <button onclick="toggleGlitchMode()" style="margin-top: 10px; padding: 5px 10px; background: #00FFE7; color: #000; border: none; border-radius: 4px; cursor: pointer;">⚡ Glitch Mode</button>
        <button onclick="this.parentElement.remove()" style="margin-top: 5px; padding: 5px 10px; background: #ff4444; color: #fff; border: none; border-radius: 4px; cursor: pointer;">✕ Close</button>
      `;
      
      document.body.appendChild(devTools);
    }
    
    async function toggleGlitchMode() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/easter-eggs/glitch`);
        const data = await response.json();
        
        if (data.status === 'success') {
          showToast(data.message, 'info');
          
          // Aplicar efectos glitch
          document.body.style.filter = 'hue-rotate(90deg) contrast(1.5) saturate(2)';
          document.body.style.animation = 'glitch 0.1s infinite';
          
          // Crear efecto de distorsión
          setTimeout(() => {
            document.body.style.filter = '';
            document.body.style.animation = '';
          }, 3000);
        }
      } catch (error) {
        console.error('Glitch mode error:', error);
      }
    }
    
    // Create terminal portal overlay
    function createTerminalPortal() {
      const overlay = document.createElement('div');
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(45deg, #020304, #0a1a17);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        color: #00ff95;
        font-family: monospace;
        animation: fadeIn 2s ease-in-out;
      `;
      
      overlay.innerHTML = `
        <div style="text-align: center; max-width: 600px; padding: 2rem;">
          <div style="font-size: 2rem; margin-bottom: 1rem;">
            ◯⚡ SON1KVERS3 — TERMINAL ◯⚡
          </div>
          <div style="margin-bottom: 2rem; color: #cde6e0; line-height: 1.6;">
            <div>[BOOTING] Accessing NODE // RESISTENCIA …</div>
            <div>> Mensaje entrante: <span style="color: #00f6ff;">BELLA.exe</span></div>
            <div style="color: #ffcc00; margin-top: 1rem;">
              "Tu glitch es la chispa de la Liga del No Silencio."
            </div>
          </div>
          <div style="margin-bottom: 2rem; border: 1px dashed #135345; padding: 1rem; border-radius: 8px;">
            <div>La puerta solo se abre con una <span style="border: 1px solid #00f6ff; padding: 2px 8px; border-radius: 4px; color: #00f6ff;">demo real</span>.</div>
            <div style="margin-top: 1rem;">> ALMA_HIBRIDA — elige un arquetipo:</div>
            <div style="margin-top: 0.5rem; color: #ff49c3;">[1] PIXEL [2] BELLA [3] NOVA [4] CIPHER</div>
          </div>
          <div style="color: #ffcc00; margin-bottom: 2rem;">
            "Lo imperfecto también es sagrado."
          </div>
          <button id="portalEnter" style="
            background: linear-gradient(45deg, #00ff95, #00f6ff);
            color: #020304;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-family: monospace;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1rem;
          ">
            ◯⚡ DESPERTAR
          </button>
          <div style="margin-top: 1rem;">
            <button id="portalBack" style="
              background: transparent;
              color: #8fb3a9;
              border: 1px solid #0d3c31;
              padding: 8px 16px;
              border-radius: 4px;
              font-family: monospace;
              cursor: pointer;
            ">
              Regresar al Estudio
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(overlay);
      
      // Portal actions
      document.getElementById('portalEnter').addEventListener('click', () => {
        showToast('🌌 Preparando acceso al Terminal...', 'info');
        // Here you would redirect to the son1k-ready terminal experience
        // window.location.href = 'https://son1k-ready.railway.app';
        overlay.innerHTML = `
          <div style="text-align: center; color: #00ff95;">
            <div style="font-size: 1.5rem; margin-bottom: 1rem;">
              ◯⚡ PRONTO DISPONIBLE ◯⚡
            </div>
            <div style="color: #cde6e0; margin-bottom: 2rem;">
              El Terminal de la Resistencia está siendo construido...<br>
              Son1k-Ready se desplegará próximamente.
            </div>
            <div style="color: #ffcc00;">
              "La revolución musical viene en código."
            </div>
          </div>
        `;
        setTimeout(() => overlay.remove(), 3000);
      });
      
      document.getElementById('portalBack').addEventListener('click', () => {
        overlay.remove();
        document.body.style.filter = '';
        const btn = document.getElementById('conocerUniverso');
        btn.textContent = 'Conocer el Universo';
        btn.setAttribute('data-clicks', '0');
        btn.style.animation = '';
      });
    }
    
    // Login system
    function showLoginModal() {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
      `;
      
      modal.innerHTML = `
        <div style="
          background: rgba(15, 17, 26, 0.95);
          border: 1px solid rgba(0, 255, 231, 0.3);
          border-radius: 16px;
          padding: 2rem;
          max-width: 400px;
          width: 90%;
          box-shadow: 0 0 30px rgba(0, 255, 231, 0.2);
        ">
          <h2 style="color: #00FFE7; text-align: center; margin-bottom: 1.5rem; font-size: 1.5rem;">
            Acceso a la Resistencia
          </h2>
          
          <div id="loginTabs" style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
            <button id="loginTab" class="btn btn-primary" style="flex: 1;">Iniciar Sesión</button>
            <button id="registerTab" class="btn btn-secondary" style="flex: 1;">Registrarse</button>
          </div>
          
          <form id="authForm">
            <div class="input-group">
              <label for="authUsername">Usuario</label>
              <input type="text" id="authUsername" placeholder="Tu nombre de resistente" required>
            </div>
            
            <div class="input-group">
              <label for="authEmail">Email</label>
              <input type="email" id="authEmail" placeholder="resistente@son1kvers3.com" required>
            </div>
            
            <div class="input-group">
              <label for="authPassword">Contraseña</label>
              <input type="password" id="authPassword" placeholder="••••••••" required>
            </div>
            
            <div id="registerFields" style="display: none;">
              <div class="input-group">
                <label for="authConfirmPassword">Confirmar Contraseña</label>
                <input type="password" id="authConfirmPassword" placeholder="••••••••">
              </div>
              
              <div class="input-group">
                <label for="authArchetype">Arquetipo de la Resistencia</label>
                <select id="authArchetype">
                  <option value="pixel">PIXEL - Artista Digital</option>
                  <option value="bella">BELLA - Alma Híbrida</option>
                  <option value="nova">NOVA - Innovador Sónico</option>
                  <option value="cipher">CIPHER - Descifrador</option>
                </select>
              </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
              <button type="submit" id="authSubmit" class="btn btn-primary" style="flex: 1;">
                Iniciar Sesión
              </button>
              <button type="button" id="closeAuth" class="btn btn-secondary">
                Cancelar
              </button>
            </div>
          </form>
          
          <div style="text-align: center; margin-top: 1rem; color: #a1a1aa; font-size: 0.875rem;">
            "Lo imperfecto también es sagrado"
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      let isRegisterMode = false;
      
      // Tab switching
      document.getElementById('loginTab').addEventListener('click', () => {
        isRegisterMode = false;
        document.getElementById('loginTab').className = 'btn btn-primary';
        document.getElementById('registerTab').className = 'btn btn-secondary';
        document.getElementById('registerFields').style.display = 'none';
        document.getElementById('authSubmit').textContent = 'Iniciar Sesión';
      });
      
      document.getElementById('registerTab').addEventListener('click', () => {
        isRegisterMode = true;
        document.getElementById('loginTab').className = 'btn btn-secondary';
        document.getElementById('registerTab').className = 'btn btn-primary';
        document.getElementById('registerFields').style.display = 'block';
        document.getElementById('authSubmit').textContent = 'Registrarse';
      });
      
      // Form submission
      document.getElementById('authForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('authUsername').value;
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        
        if (isRegisterMode) {
          const confirmPassword = document.getElementById('authConfirmPassword').value;
          const archetype = document.getElementById('authArchetype').value;
          
          if (password !== confirmPassword) {
            showToast('Las contraseñas no coinciden', 'error');
            return;
          }
          
          await performRegistration(username, email, password, archetype);
        } else {
          await performLogin(email, password);
        }
        
        modal.remove();
      });
      
      // Close modal
      document.getElementById('closeAuth').addEventListener('click', () => {
        modal.remove();
      });
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
      });
    }
    
    async function performLogin(email, password) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          userSession.isLoggedIn = true;
          userSession.username = data.user.username;
          userSession.token = data.token;
          userSession.plan = data.user.plan || 'Free';
          userSession.tracksUsed = data.user.tracksUsed || 0;
          userSession.tracksLimit = data.user.tracksLimit || 3;
          
          updateUserInterface();
          showToast(`¡Bienvenido de vuelta, ${data.user.username}!`, 'success');
        } else {
          showToast('Credenciales incorrectas', 'error');
        }
      } catch (error) {
        // Mock login for demo
        userSession.isLoggedIn = true;
        userSession.username = email.split('@')[0];
        userSession.token = 'demo_token_' + Math.random().toString(36).substr(2, 9);
        
        updateUserInterface();
        showToast(`¡Bienvenido, ${userSession.username}!`, 'success');
      }
    }
    
    async function performRegistration(username, email, password, archetype) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/auth/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, email, password, archetype })
        });
        
        const data = await response.json();
        
        if (data.success) {
          showToast('¡Registro exitoso! Iniciando sesión...', 'success');
          await performLogin(email, password);
        } else {
          showToast('Error en el registro: ' + data.message, 'error');
        }
      } catch (error) {
        // Mock registration for demo
        showToast('¡Registro exitoso! Iniciando sesión...', 'success');
        setTimeout(() => {
          userSession.isLoggedIn = true;
          userSession.username = username;
          userSession.token = 'demo_token_' + Math.random().toString(36).substr(2, 9);
          
          updateUserInterface();
          showToast(`¡Bienvenido a la Resistencia, ${username}!`, 'success');
        }, 1000);
      }
    }
    
    function updateUserInterface() {
      const loginBtn = document.getElementById('loginBtn');
      
      if (userSession.isLoggedIn) {
        loginBtn.textContent = userSession.username;
        loginBtn.onclick = showUserMenu;
        loginBtn.classList.remove('btn-primary');
        loginBtn.classList.add('btn-secondary');
      } else {
        loginBtn.textContent = 'Iniciar Sesión';
        loginBtn.onclick = showLoginModal;
        loginBtn.classList.remove('btn-secondary');
        loginBtn.classList.add('btn-primary');
      }
      
      updateUserStats();
    }
    
    function showUserMenu() {
      const menu = document.createElement('div');
      menu.style.cssText = `
        position: fixed;
        top: 60px;
        right: 20px;
        background: rgba(15, 17, 26, 0.95);
        border: 1px solid rgba(0, 255, 231, 0.3);
        border-radius: 8px;
        padding: 1rem;
        z-index: 9999;
        min-width: 200px;
        box-shadow: 0 0 20px rgba(0, 255, 231, 0.2);
      `;
      
      menu.innerHTML = `
        <div style="color: #00FFE7; font-weight: bold; margin-bottom: 0.5rem;">
          ${userSession.username}
        </div>
        <div style="color: #a1a1aa; font-size: 0.875rem; margin-bottom: 1rem;">
          Plan: ${userSession.plan}
        </div>
        <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 0.5rem 0;"></div>
        <button id="profileBtn" class="btn btn-secondary w-full mb-2">Mi Perfil</button>
        <button id="logoutBtn" class="btn btn-secondary w-full">Cerrar Sesión</button>
      `;
      
      document.body.appendChild(menu);
      
      document.getElementById('logoutBtn').addEventListener('click', () => {
        userSession.isLoggedIn = false;
        userSession.username = null;
        userSession.token = null;
        updateUserInterface();
        menu.remove();
        showToast('Sesión cerrada', 'info');
      });
      
      document.getElementById('profileBtn').addEventListener('click', () => {
        menu.remove();
        showSection('santuario');
      });
      
      // Close menu when clicking outside
      setTimeout(() => {
        document.addEventListener('click', function closeMenu(e) {
          if (!menu.contains(e.target)) {
            menu.remove();
            document.removeEventListener('click', closeMenu);
          }
        });
      }, 100);
    }
    
    // Service Worker registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => console.log('SW registered'))
        .catch(error => console.log('SW registration failed'));
    }
    // Waves Plugin Integration
    class WavesPluginBridge {
      constructor() {
        this.audioContext = null;
        this.plugins = new Map();
        this.isConnected = false;
      }
      
      async initialize() {
        try {
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
          await this.loadWavesPlugins();
          this.isConnected = true;
          console.log('Waves plugins connected successfully');
          this.showWavesStatus(true);
        } catch (error) {
          console.error('Failed to connect to Waves plugins:', error);
          this.showWavesStatus(false);
        }
      }
      
      async loadWavesPlugins() {
        // Simulate loading Waves plugins
        const pluginList = [
          'SSL E-Channel',
          'PuigTec EQP-1A',
          'PuigTec MEQ-5',
          'API 2500',
          'CLA-2A',
          'CLA-76',
          'Renaissance Vox',
          'Renaissance Bass',
          'Renaissance Reverb'
        ];
        
        for (const plugin of pluginList) {
          this.plugins.set(plugin, {
            name: plugin,
            parameters: this.getPluginParameters(plugin),
            isActive: false
          });
        }
      }
      
      getPluginParameters(pluginName) {
        const parameterMap = {
          'SSL E-Channel': {
            'High': { min: 0, max: 100, value: 50, unit: '%' },
            'HighMid': { min: 0, max: 100, value: 50, unit: '%' },
            'Mid': { min: 0, max: 100, value: 50, unit: '%' },
            'LowMid': { min: 0, max: 100, value: 50, unit: '%' },
            'Low': { min: 0, max: 100, value: 50, unit: '%' }
          },
          'API 2500': {
            'Ratio': { min: 0, max: 100, value: 0, unit: '%' },
            'Attack': { min: 0, max: 100, value: 0, unit: '%' },
            'Release': { min: 0, max: 100, value: 0, unit: '%' },
            'Threshold': { min: 0, max: 100, value: 0, unit: '%' }
          },
          'CLA-2A': {
            'Gain': { min: 0, max: 100, value: 0, unit: '%' },
            'Peak Reduction': { min: 0, max: 100, value: 0, unit: '%' }
          },
          'CLA-76': {
            'Input': { min: 0, max: 100, value: 0, unit: '%' },
            'Output': { min: 0, max: 100, value: 0, unit: '%' },
            'Attack': { min: 0, max: 100, value: 0, unit: '%' },
            'Release': { min: 0, max: 100, value: 0, unit: '%' }
          }
        };
        
        return parameterMap[pluginName] || {};
      }
      
      updatePluginParameter(pluginName, parameter, value) {
        const plugin = this.plugins.get(pluginName);
        if (plugin && plugin.parameters[parameter]) {
          plugin.parameters[parameter].value = value;
          this.sendToWaves(pluginName, parameter, value);
        }
      }
      
      sendToWaves(pluginName, parameter, value) {
        // This would send OSC messages or use VST bridge
        console.log(`Waves: ${pluginName} - ${parameter}: ${value}%`);
        
        // Simulate sending to Waves
        if (window.wavesAPI) {
          window.wavesAPI.setParameter(pluginName, parameter, value);
        }
        
        // Show visual feedback
        this.showParameterUpdate(pluginName, parameter, value);
      }
      
      getKnobMapping() {
        return {
          'expresividad': { plugin: 'API 2500', parameter: 'Ratio' },
          'rareza': { plugin: 'CLA-2A', parameter: 'Gain' },
          'garage': { plugin: 'SSL E-Channel', parameter: 'High' },
          'afinacion': { plugin: 'SSL E-Channel', parameter: 'Mid' },
          'analog': { plugin: 'CLA-76', parameter: 'Input' }
        };
      }
      
      showWavesStatus(connected) {
        const statusElement = document.getElementById('wavesStatus');
        if (statusElement) {
          statusElement.textContent = connected ? 'WAVES CONNECTED' : 'WAVES OFFLINE';
          statusElement.className = connected ? 'text-green-400' : 'text-red-400';
        }
      }
      
      showParameterUpdate(pluginName, parameter, value) {
        // Create floating notification
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 bg-zinc-800 text-green-400 px-4 py-2 rounded-lg shadow-lg z-50 font-mono text-sm';
        notification.textContent = `${pluginName}: ${parameter} = ${value}%`;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.remove();
        }, 2000);
      }
    }
    
    // Initialize Waves bridge
    const wavesBridge = new WavesPluginBridge();
    
    // Initialize audio drop zone
    function initializeAudioDropZone() {
      const dropZone = document.getElementById('audioDropZone');
      const fileInput = document.getElementById('audioFile');
      
      if (dropZone && fileInput) {
        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('border-amber-400', 'bg-amber-500/10');
        });
        
        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('border-amber-400', 'bg-amber-500/10');
        });
        
        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('border-amber-400', 'bg-amber-500/10');
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            fileInput.files = files;
            handleAudioFileUpload();
          }
        });
        
        fileInput.addEventListener('change', handleAudioFileUpload);
      }
    }
    
    // Initialize EQ sliders
    function initializeEQSliders() {
      const sliders = document.querySelectorAll('.eq-slider');
      sliders.forEach(slider => {
        slider.addEventListener('click', (e) => {
          const rect = slider.getBoundingClientRect();
          const y = e.clientY - rect.top;
          const percentage = Math.max(0, Math.min(100, (y / rect.height) * 100));
          updateEQSlider(slider, percentage);
        });
      });
    }
    
    function updateEQSlider(slider, percentage) {
      const band = slider.dataset.eqBand;
      const valueElement = document.getElementById(`eq-${band}`);
      const dbValue = Math.round((percentage - 50) * 2); // -100dB to +100dB
      
      slider.style.setProperty('--eq-value', percentage + '%');
      if (valueElement) {
        valueElement.textContent = `${dbValue}dB`;
      }
      
      // Send to Waves
      wavesBridge.updatePluginParameter('SSL E-Channel', band.toUpperCase(), percentage);
    }
    
    // Initialize action buttons
    function initializeActionButtons() {
      const buttons = ['transformAudio', 'cloneVoice', 'mastering', 'noiseReduction'];
      buttons.forEach(buttonId => {
        const button = document.getElementById(buttonId);
        if (button) {
          button.addEventListener('click', () => {
            // Toggle active state
            button.classList.toggle('active');
            
            // Update transform prompt
            const transformPrompt = document.getElementById('transformPrompt');
            if (transformPrompt) {
              const action = buttonId.replace(/([A-Z])/g, ' $1').trim().toLowerCase();
              transformPrompt.value = `${action} profesional, alta calidad`;
            }
            
            // Show visual feedback
            showButtonFeedback(buttonId, button.classList.contains('active'));
          });
        }
      });
      
      // Initialize voice cloning
      initializeVoiceCloning();
    }
    
    // Initialize voice cloning system
    function initializeVoiceCloning() {
      const voiceModel = document.getElementById('voiceModel');
      const barkSettings = document.getElementById('barkSettings');
      
      if (voiceModel) {
        voiceModel.addEventListener('change', (e) => {
          const model = e.target.value;
          
          // Show/hide Bark specific settings
          if (model === 'huggingface-bark') {
            barkSettings.classList.remove('hidden');
          } else {
            barkSettings.classList.add('hidden');
          }
          
          // Update usage stats
          updateVoiceUsageStats(model);
        });
      }
      
      // Initialize voice cloning buttons
      const uploadVoice = document.getElementById('uploadVoiceSample');
      const trainVoice = document.getElementById('trainVoiceModel');
      
      if (uploadVoice) {
        uploadVoice.addEventListener('click', handleVoiceUpload);
      }
      
      if (trainVoice) {
        trainVoice.addEventListener('click', handleVoiceTraining);
      }
    }
    
    function updateVoiceUsageStats(model) {
      const tier = document.getElementById('voiceTier');
      const used = document.getElementById('voiceUsed');
      const cost = document.getElementById('voiceCost');
      const quality = document.getElementById('voiceQualityDisplay');
      
      const stats = {
        'huggingface-so-vits': {
          tier: 'FREE',
          used: '0/30 min',
          cost: '$0.00',
          quality: '8/10'
        },
        'huggingface-bark': {
          tier: 'FREE',
          used: '0/60 min',
          cost: '$0.00',
          quality: '8.5/10'
        },
        'elevenlabs-pro': {
          tier: 'PRO',
          used: '0/300 min',
          cost: '$22.00',
          quality: '9.5/10'
        },
        'custom-enterprise': {
          tier: 'ENTERPRISE',
          used: '0/1800 min',
          cost: '$149.00',
          quality: '10/10'
        }
      };
      
      const modelStats = stats[model] || stats['huggingface-so-vits'];
      
      if (tier) tier.textContent = modelStats.tier;
      if (used) used.textContent = modelStats.used;
      if (cost) cost.textContent = modelStats.cost;
      if (quality) quality.textContent = modelStats.quality;
    }
    
    async function handleVoiceUpload() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'audio/*';
      
      input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        try {
          // Show loading state
          const button = document.getElementById('uploadVoiceSample');
          button.textContent = 'UPLOADING...';
          button.disabled = true;
          
          // Upload voice sample
          const formData = new FormData();
          formData.append('audio', file);
          formData.append('model', 'bark');
          
          const response = await fetch('/api/voice/upload-sample', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${localStorage.getItem('authToken')}`
            },
            body: formData
          });
          
          if (response.ok) {
            const result = await response.json();
            showToast('Voice sample uploaded successfully!', 'success');
            console.log('Voice ID:', result.voice_id);
          } else {
            throw new Error('Upload failed');
          }
          
        } catch (error) {
          showToast('Voice upload failed: ' + error.message, 'error');
        } finally {
          button.textContent = 'UPLOAD VOICE';
          button.disabled = false;
        }
      };
      
      input.click();
    }
    
    async function handleVoiceTraining() {
      try {
        const button = document.getElementById('trainVoiceModel');
        button.textContent = 'TRAINING...';
        button.disabled = true;
        
        // Start voice training
        const response = await fetch('/api/voice/train-model', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            voice_id: 'bark_voice_001',
            training_data: {
              model: 'bark',
              quality: 'high'
            }
          })
        });
        
        if (response.ok) {
          const result = await response.json();
          showToast('Voice training started! Estimated time: 2-4 hours', 'success');
          console.log('Training ID:', result.training_id);
        } else {
          throw new Error('Training failed');
        }
        
      } catch (error) {
        showToast('Voice training failed: ' + error.message, 'error');
      } finally {
        button.textContent = 'TRAIN MODEL';
        button.disabled = false;
      }
    }
    
    function showButtonFeedback(buttonId, isActive) {
      const status = isActive ? 'ACTIVADO' : 'DESACTIVADO';
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-zinc-800 text-amber-400 px-4 py-2 rounded-lg shadow-lg z-50 font-mono text-sm border border-amber-400/30';
      notification.textContent = `${buttonId.toUpperCase()}: ${status}`;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 2000);
    }
    
    // Enhanced knob update function to connect with Waves
    function updateKnobDisplay(knobType, value) {
      const displays = {
        'expresividad': 'expresividadDisplay',
        'rareza': 'rarezaDisplay', 
        'garage': 'garageDisplay',
        'afinacion': 'afinacionDisplay',
        'expresividad-gen': 'expresividadGenDisplay',
        'analog': 'analogDisplay'
      };
      
      const displayId = displays[knobType];
      if (displayId) {
        const display = document.getElementById(displayId);
        if (display) {
          display.textContent = Math.round(value) + '%';
        }
      }
      
      // Update knob rotation
      const knob = document.querySelector(`[data-knob="${knobType}"]`);
      if (knob) {
        const rotation = (value / 100) * 270 - 135; // 270 degrees range, centered at -135
        knob.style.setProperty('--rotation', rotation + 'deg');
      }
      
      // Send to Waves plugins
      const mapping = wavesBridge.getKnobMapping();
      if (mapping[knobType]) {
        const { plugin, parameter } = mapping[knobType];
        wavesBridge.updatePluginParameter(plugin, parameter, value);
      }
      
      // Update expression parameters indicator
      updateExpressionIndicator();
    }
    
    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize knobs
      initializeKnobs();
      
      // Initialize melody analyzer
      updateAnalysisStatus();
      
      // Initialize expression indicator
      updateExpressionIndicator();
      
      // Initialize visualizer
      setupAudioVisualizer();
      
      // Initialize music player controls
      setupMusicPlayerControls();
      
      // Initialize authentication
      verifyToken();
      
      // Initialize immersive mode
      initializeImmersiveMode();
      
      // Initialize real music generation
      initializeRealMusicGeneration();
      
      // Initialize Ollama AI
      initializeOllamaAI();
      
      // Initialize analytics
      initializeAnalytics();
      
      // Initialize Waves plugins
      wavesBridge.initialize();
      
      // Initialize audio drop zone
      initializeAudioDropZone();
      
      // Initialize EQ sliders
      initializeEQSliders();
      
      // Initialize new action buttons
      initializeActionButtons();
      
      // Initialize Clone Station
      initializeCloneStation();
      
      // Initialize Nova Post Pilot
      initializeNovaPostPilot();
      initializeSocialIntegration();
      
      // Initialize Floating Player
      initializeFloatingPlayer();
      
      // Initialize Nexus
      initializeNexus();
      
      // Initialize Santuario (Resistance Social Network)
      initializeSantuario();
    });
    
    // Nova Post Pilot functionality
    function initializeNovaPostPilot() {
      // Profile analysis button
      const analyzeBtn = document.getElementById('analyzeProfile');
      if (analyzeBtn) {
        analyzeBtn.addEventListener('click', analyzeCreatorProfile);
      }
      
      // Auto-publish checkbox
      const autoPublish = document.getElementById('enableAutoPublish');
      if (autoPublish) {
        autoPublish.addEventListener('change', (e) => {
          updateAutoPublishStatus(e.target.checked);
        });
      }
    }
    
    async function analyzeCreatorProfile() {
      const contentDescription = document.getElementById('contentDescription').value;
      const contentGoals = document.getElementById('contentGoals').value;
      const platforms = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
      const analysisDepth = document.querySelector('input[name="analysisDepth"]:checked').value;
      
      if (!contentDescription.trim()) {
        showToast('Please describe your content first', 'error');
        return;
      }
      
      if (platforms.length === 0) {
        showToast('Please select at least one social platform', 'error');
        return;
      }
      
      showToast(`Analyzing content with ${analysisDepth} depth...`, 'info');
      
      try {
        // Simulate AI analysis with Ollama
        const analysisData = await performMarketAnalysis(contentDescription, contentGoals, platforms, analysisDepth);
        
        // Update market analysis section
        updateMarketAnalysis(analysisData);
        
        // Show all sections
        document.getElementById('algorithmAnalysis').style.display = 'block';
        document.getElementById('marketAnalysis').style.display = 'block';
        document.getElementById('socialIntegration').style.display = 'block';
        document.getElementById('viralHooks').style.display = 'block';
        document.getElementById('contentSuggestions').style.display = 'block';
        document.getElementById('publishingSchedule').style.display = 'block';
        document.getElementById('contentPreview').style.display = 'block';
        
        showToast('Content analysis complete! Strategy generated.', 'success');
        
      } catch (error) {
        console.error('Analysis error:', error);
        showToast('Analysis failed. Please try again.', 'error');
      }
    }
    
    async function performMarketAnalysis(contentDescription, contentGoals, platforms, analysisDepth) {
      try {
        // Call Nova Post Pilot backend
        const response = await fetch('http://localhost:8001/api/npp/analyze-profile', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            profile: {
              content_description: contentDescription,
              platforms: platforms,
              content_goals: contentGoals
            },
            analysis_depth: analysisDepth
          })
        });
        
        if (response.ok) {
          const data = await response.json();
          return data.analysis;
        } else {
          throw new Error('Backend analysis failed');
        }
      } catch (error) {
        console.warn('Backend not available, using fallback analysis:', error);
        // Fallback to simulated analysis
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({
              target_insights: {
                age_range: '18-35',
                gender: 'Mixed',
                interests: 'Music, Tech, AI',
                location: 'Global',
                income: '$30K-80K',
                peak_hours: '7-9 PM',
                engagement_level: 'High'
              },
              trending_topics: [
                { name: '#AIMusic', growth: '+45%' },
                { name: '#MusicTech', growth: '+32%' },
                { name: '#ProducerLife', growth: '+28%' },
                { name: '#StudioSetup', growth: '+21%' },
                { name: '#MusicProduction', growth: '+18%' },
                { name: '#BehindTheScenes', growth: '+15%' }
              ],
              best_posting_times: {
                instagram: '6-9 PM',
                tiktok: '6-10 PM',
                youtube: '2-4 PM',
                twitter: '12-3 PM',
                linkedin: '8-10 AM',
                facebook: '1-3 PM'
              },
              competitor_analysis: {
                top_competitors: '3 identified',
                avg_engagement: '12.5%',
                posting_frequency: 'Daily',
                content_mix: '70% Video',
                growth_rate: '+25% MoM'
              },
              content_performance: {
                best_format: 'Short Videos',
                avg_duration: '60-90s',
                engagement_rate: '8.5%',
                share_rate: '2.1%',
                comment_rate: '1.8%'
              },
              market_opportunities: {
                underserved_niches: '2 identified',
                content_gaps: 'Educational',
                platform_gaps: 'LinkedIn',
                time_gaps: 'Morning',
                trending_now: 'AI Tools'
              },
              audience_behavior: 'Your target audience is highly engaged with educational content, particularly tutorials and behind-the-scenes content. They prefer short-form videos (60-90 seconds) and are most active during evening hours.',
              content_strategy: 'Focus on educational content with entertainment value. Use trending hashtags and create content that encourages interaction. Consider live streaming for real-time engagement.',
              viralHooks: generateViralHooks(contentDescription, contentGoals),
              contentSuggestions: generateContentSuggestions(contentDescription, contentGoals)
            });
          }, 2000);
        });
      }
    }
    
    function generateViralHooks(contentDescription, contentGoals) {
      // Analyze content description to generate relevant hooks
      const description = contentDescription.toLowerCase();
      
      if (description.includes('music') || description.includes('producer') || description.includes('beat')) {
        return [
          "This AI tool just changed everything about music production...",
          "3 things every music producer needs to know in 2024...",
          "I tried this controversial music technique and the results shocked me..."
        ];
      } else if (description.includes('gaming') || description.includes('game')) {
        return [
          "This game mechanic is breaking the internet...",
          "5 secrets every gamer needs to know...",
          "I played this game for 24 hours straight and here's what happened..."
        ];
      } else if (description.includes('tech') || description.includes('technology')) {
        return [
          "This new technology will change everything...",
          "3 tech trends that will dominate 2024...",
          "I tested this controversial tech and the results were surprising..."
        ];
      } else if (description.includes('tutorial') || description.includes('educational')) {
        return [
          "This tutorial will change how you think about...",
          "5 things I wish I knew before starting...",
          "The secret technique that professionals don't want you to know..."
        ];
      } else if (description.includes('behind') || description.includes('scenes')) {
        return [
          "Behind the scenes: What really happens when...",
          "The truth about what goes on behind the camera...",
          "You won't believe what I discovered backstage..."
        ];
      } else {
        return [
          "This will change everything you know about...",
          "3 things that will surprise you about...",
          "I tried this and the results were incredible..."
        ];
      }
    }
    
    function generateContentSuggestions(contentDescription, contentGoals) {
      // Analyze content description to generate relevant suggestions
      const description = contentDescription.toLowerCase();
      
      if (description.includes('music') || description.includes('producer')) {
        return [
          { text: "Behind the scenes: Creating a beat in 60 seconds", engagement: "15K+ likes" },
          { text: "AI vs Human: Can you tell the difference?", engagement: "12K+ likes" },
          { text: "Studio setup tour: What's in my rack?", engagement: "8K+ likes" }
        ];
      } else if (description.includes('gaming')) {
        return [
          { text: "Speedrun attempt: Can I beat this game in 1 hour?", engagement: "20K+ likes" },
          { text: "Gaming setup reveal: My $5000 rig", engagement: "15K+ likes" },
          { text: "Reaction to the most broken game mechanic", engagement: "10K+ likes" }
        ];
      } else if (description.includes('tech')) {
        return [
          { text: "Unboxing the latest tech gadget", engagement: "18K+ likes" },
          { text: "Tech review: Is it worth the hype?", engagement: "14K+ likes" },
          { text: "DIY tech project: Building my own setup", engagement: "9K+ likes" }
        ];
      } else if (description.includes('tutorial') || description.includes('educational')) {
        return [
          { text: "Quick tutorial: Master this in 5 minutes", engagement: "16K+ likes" },
          { text: "Common mistakes beginners make", engagement: "13K+ likes" },
          { text: "Step-by-step guide to success", engagement: "11K+ likes" }
        ];
      } else {
        return [
          { text: "My honest review of this popular trend", engagement: "14K+ likes" },
          { text: "What I learned from trying this for a week", engagement: "12K+ likes" },
          { text: "The truth about what everyone's talking about", engagement: "10K+ likes" }
        ];
      }
    }
    
    function updateMarketAnalysis(data) {
      // Update algorithm analysis
      if (data.algorithm_analysis) {
        updateAlgorithmAnalysis(data.algorithm_analysis);
      } else {
        // Generate algorithm analysis based on content description
        const algorithmData = generateAlgorithmAnalysis(data.contentDescription || '');
        updateAlgorithmAnalysis(algorithmData);
      }
      
      // Update target insights
      if (data.target_insights) {
        document.getElementById('targetAge').textContent = data.target_insights.age_range;
        document.getElementById('targetGender').textContent = data.target_insights.gender;
        document.getElementById('targetInterests').textContent = data.target_insights.interests;
        document.getElementById('targetLocation').textContent = data.target_insights.location;
        document.getElementById('targetIncome').textContent = data.target_insights.income;
        document.getElementById('targetHours').textContent = data.target_insights.peak_hours;
        document.getElementById('targetEngagement').textContent = data.target_insights.engagement_level;
      } else {
        // Fallback for old data structure
        document.getElementById('targetAge').textContent = data.targetAge || '18-35';
        document.getElementById('targetGender').textContent = data.targetGender || 'Mixed';
        document.getElementById('targetInterests').textContent = data.targetInterests || 'Music, Tech, AI';
        document.getElementById('targetLocation').textContent = data.targetLocation || 'Global';
        document.getElementById('targetIncome').textContent = data.targetIncome || '$30K-80K';
        document.getElementById('targetHours').textContent = data.targetHours || '7-9 PM';
        document.getElementById('targetEngagement').textContent = data.targetEngagement || 'High';
      }
      
      // Update competitor analysis
      if (data.competitor_analysis) {
        document.getElementById('topCompetitors').textContent = data.competitor_analysis.top_competitors;
        document.getElementById('avgEngagement').textContent = data.competitor_analysis.avg_engagement;
        document.getElementById('postingFreq').textContent = data.competitor_analysis.posting_frequency;
        document.getElementById('contentMix').textContent = data.competitor_analysis.content_mix;
        document.getElementById('growthRate').textContent = data.competitor_analysis.growth_rate;
      }
      
      // Update content performance
      if (data.content_performance) {
        document.getElementById('bestFormat').textContent = data.content_performance.best_format;
        document.getElementById('avgDuration').textContent = data.content_performance.avg_duration;
        document.getElementById('engagementRate').textContent = data.content_performance.engagement_rate;
        document.getElementById('shareRate').textContent = data.content_performance.share_rate;
        document.getElementById('commentRate').textContent = data.content_performance.comment_rate;
      }
      
      // Update market opportunities
      if (data.market_opportunities) {
        document.getElementById('underservedNiches').textContent = data.market_opportunities.underserved_niches;
        document.getElementById('contentGaps').textContent = data.market_opportunities.content_gaps;
        document.getElementById('platformGaps').textContent = data.market_opportunities.platform_gaps;
        document.getElementById('timeGaps').textContent = data.market_opportunities.time_gaps;
        document.getElementById('trendingNow').textContent = data.market_opportunities.trending_now;
      }
      
      // Update detailed insights
      if (data.audience_behavior) {
        document.getElementById('audienceBehavior').textContent = data.audience_behavior;
      }
      if (data.content_strategy) {
        document.getElementById('contentStrategy').textContent = data.content_strategy;
      }
      
      // Update trending topics
      const trendingContainer = document.querySelector('#marketAnalysis .space-y-1');
      if (trendingContainer) {
        const topics = data.trending_topics || data.trendingTopics || [];
        trendingContainer.innerHTML = topics.map(topic => 
          `<div class="flex justify-between">
            <span>${topic.name}</span>
            <span class="text-green-400">${topic.growth}</span>
          </div>`
        ).join('');
      }
      
      // Update viral hooks
      const hooks = data.viralHooks || data.viral_hooks || [];
      if (hooks.length >= 3) {
        document.getElementById('hookA').textContent = hooks[0];
        document.getElementById('hookB').textContent = hooks[1];
        document.getElementById('hookC').textContent = hooks[2];
      }
    }
    
    function selectHook(option) {
      const hookText = document.getElementById(`hook${option}`).textContent;
      document.getElementById('selectedContent').textContent = hookText;
      document.getElementById('selectedPlatform').textContent = 'Instagram';
      document.getElementById('selectedTime').textContent = '6:00 PM';
      
      showToast(`Hook ${option} selected for publishing`, 'success');
    }
    
    function regenerateHook(option) {
      showToast(`Regenerating hook ${option}...`, 'info');
      
      // Simulate regeneration
      setTimeout(() => {
        const newHooks = generateViralHooks(
          document.getElementById('contentType').value,
          document.getElementById('targetAudience').value
        );
        document.getElementById(`hook${option}`).textContent = newHooks[option === 'A' ? 0 : option === 'B' ? 1 : 2];
        showToast(`Hook ${option} regenerated`, 'success');
      }, 1000);
    }
    
    function publishContent() {
      const content = document.getElementById('selectedContent').textContent;
      if (content === 'No content selected') {
        showToast('Please select content first', 'error');
        return;
      }
      
      showToast('Publishing content...', 'info');
      
      setTimeout(() => {
        showToast('Content published successfully!', 'success');
        // Reset selection
        document.getElementById('selectedContent').textContent = 'No content selected';
        document.getElementById('selectedPlatform').textContent = '-';
        document.getElementById('selectedTime').textContent = '-';
      }, 2000);
    }
    
    function scheduleContent() {
      const content = document.getElementById('selectedContent').textContent;
      if (content === 'No content selected') {
        showToast('Please select content first', 'error');
        return;
      }
      
      showToast('Scheduling content...', 'info');
      
      setTimeout(() => {
        showToast('Content scheduled successfully!', 'success');
        // Reset selection
        document.getElementById('selectedContent').textContent = 'No content selected';
        document.getElementById('selectedPlatform').textContent = '-';
        document.getElementById('selectedTime').textContent = '-';
      }, 1500);
    }
    
    function updateAutoPublishStatus(enabled) {
      if (enabled) {
        showToast('Auto-publish enabled. Content will be published automatically at scheduled times.', 'info');
      } else {
        showToast('Auto-publish disabled. Manual approval required for all content.', 'info');
      }
    }
    
    // Social Media Integration functionality
    function initializeSocialIntegration() {
      // Connect buttons
      document.getElementById('connectInstagram').addEventListener('click', () => connectPlatform('instagram'));
      document.getElementById('connectTikTok').addEventListener('click', () => connectPlatform('tiktok'));
      document.getElementById('connectYouTube').addEventListener('click', () => connectPlatform('youtube'));
      document.getElementById('connectTwitter').addEventListener('click', () => connectPlatform('twitter'));
      document.getElementById('connectLinkedIn').addEventListener('click', () => connectPlatform('linkedin'));
      document.getElementById('connectFacebook').addEventListener('click', () => connectPlatform('facebook'));
      
      // Auto-publish settings
      document.getElementById('enableAutoPublish').addEventListener('change', (e) => {
        updateAutoPublishStatus(e.target.checked);
        updateIntegrationStatus();
      });
      
      // Posting frequency
      document.getElementById('postingFrequency').addEventListener('change', (e) => {
        updatePostingSchedule(e.target.value);
      });
      
      // Content mix checkboxes
      document.querySelectorAll('input[type="checkbox"][value]').forEach(checkbox => {
        checkbox.addEventListener('change', updateContentMix);
      });
    }
    
    async function connectPlatform(platform) {
      const platformNames = {
        instagram: 'Instagram',
        tiktok: 'TikTok',
        youtube: 'YouTube',
        twitter: 'Twitter',
        linkedin: 'LinkedIn',
        facebook: 'Facebook'
      };
      
      showToast(`Connecting to ${platformNames[platform]}...`, 'info');
      
      try {
        // Simulate OAuth flow
        const authUrl = await getAuthUrl(platform);
        
        // Open popup for OAuth
        const popup = window.open(authUrl, 'oauth', 'width=600,height=600');
        
        // Listen for OAuth completion
        const checkClosed = setInterval(() => {
          if (popup.closed) {
            clearInterval(checkClosed);
            handleOAuthCallback(platform);
          }
        }, 1000);
        
      } catch (error) {
        console.error('Connection error:', error);
        showToast(`Failed to connect to ${platformNames[platform]}`, 'error');
      }
    }
    
    async function getAuthUrl(platform) {
      // Simulate API call to get OAuth URL
      const urls = {
        instagram: 'https://api.instagram.com/oauth/authorize?client_id=YOUR_CLIENT_ID&redirect_uri=YOUR_REDIRECT_URI&scope=user_profile,user_media&response_type=code',
        tiktok: 'https://www.tiktok.com/auth/authorize?client_key=YOUR_CLIENT_KEY&scope=user.info.basic,video.publish&response_type=code&redirect_uri=YOUR_REDIRECT_URI',
        youtube: 'https://accounts.google.com/oauth/authorize?client_id=YOUR_CLIENT_ID&redirect_uri=YOUR_REDIRECT_URI&scope=https://www.googleapis.com/auth/youtube.upload&response_type=code',
        twitter: 'https://twitter.com/i/oauth2/authorize?response_type=code&client_id=YOUR_CLIENT_ID&redirect_uri=YOUR_REDIRECT_URI&scope=tweet.read%20tweet.write%20users.read',
        linkedin: 'https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=YOUR_CLIENT_ID&redirect_uri=YOUR_REDIRECT_URI&scope=r_liteprofile%20r_emailaddress%20w_member_social',
        facebook: 'https://www.facebook.com/v18.0/dialog/oauth?client_id=YOUR_CLIENT_ID&redirect_uri=YOUR_REDIRECT_URI&scope=pages_manage_posts,pages_read_engagement'
      };
      
      return urls[platform];
    }
    
    async function handleOAuthCallback(platform) {
      const platformNames = {
        instagram: 'Instagram',
        tiktok: 'TikTok',
        youtube: 'YouTube',
        twitter: 'Twitter',
        linkedin: 'LinkedIn',
        facebook: 'Facebook'
      };
      
      try {
        // Simulate successful OAuth
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Update UI
        updatePlatformStatus(platform, true);
        updateIntegrationStatus();
        
        showToast(`Successfully connected to ${platformNames[platform]}!`, 'success');
        
      } catch (error) {
        console.error('OAuth callback error:', error);
        showToast(`Failed to connect to ${platformNames[platform]}`, 'error');
      }
    }
    
    function updatePlatformStatus(platform, connected) {
      const statusElement = document.getElementById(`${platform}Status`);
      const statusTextElement = document.getElementById(`${platform}StatusText`);
      
      if (connected) {
        statusElement.className = 'w-3 h-3 rounded-full bg-green-500 mr-2';
        statusTextElement.textContent = 'Connected';
        statusTextElement.className = 'text-xs text-green-400';
        
        // Update account info
        const accountElement = document.getElementById(`${platform}Account`);
        if (accountElement) {
          accountElement.textContent = `@${platform}_user`;
        }
        
        // Update scheduled posts
        updateScheduledPosts(platform);
        
      } else {
        statusElement.className = 'w-3 h-3 rounded-full bg-red-500 mr-2';
        statusTextElement.textContent = 'Disconnected';
        statusTextElement.className = 'text-xs text-gray-400';
      }
    }
    
    function updateScheduledPosts(platform) {
      const platforms = {
        instagram: ['igPosts', 'igStories', 'igReels'],
        tiktok: ['ttVideos', 'ttLives', 'ttTrends'],
        youtube: ['ytVideos', 'ytShorts', 'ytLives'],
        twitter: ['twTweets', 'twThreads', 'twSpaces'],
        linkedin: ['liPosts', 'liArticles', 'liEvents'],
        facebook: ['fbPosts', 'fbLives', 'fbGroups']
      };
      
      const elements = platforms[platform];
      if (elements) {
        elements.forEach(elementId => {
          const element = document.getElementById(elementId);
          if (element) {
            const randomCount = Math.floor(Math.random() * 10) + 1;
            element.textContent = `${randomCount} scheduled`;
          }
        });
      }
    }
    
    function updateIntegrationStatus() {
      const platforms = ['instagram', 'tiktok', 'youtube', 'twitter', 'linkedin', 'facebook'];
      let connectedCount = 0;
      let totalScheduled = 0;
      
      platforms.forEach(platform => {
        const statusElement = document.getElementById(`${platform}Status`);
        if (statusElement && statusElement.classList.contains('bg-green-500')) {
          connectedCount++;
        }
        
        // Count scheduled posts for this platform
        const platformElements = {
          instagram: ['igPosts', 'igStories', 'igReels'],
          tiktok: ['ttVideos', 'ttLives', 'ttTrends'],
          youtube: ['ytVideos', 'ytShorts', 'ytLives'],
          twitter: ['twTweets', 'twThreads', 'twSpaces'],
          linkedin: ['liPosts', 'liArticles', 'liEvents'],
          facebook: ['fbPosts', 'fbLives', 'fbGroups']
        };
        
        const elements = platformElements[platform];
        if (elements) {
          elements.forEach(elementId => {
            const element = document.getElementById(elementId);
            if (element && element.textContent.includes('scheduled')) {
              const count = parseInt(element.textContent.split(' ')[0]);
              if (!isNaN(count)) {
                totalScheduled += count;
              }
            }
          });
        }
      });
      
      document.getElementById('connectedPlatforms').textContent = connectedCount;
      document.getElementById('scheduledPosts').textContent = totalScheduled;
      
      const autoPublishEnabled = document.getElementById('enableAutoPublish').checked;
      document.getElementById('autoPublishStatus').textContent = autoPublishEnabled ? 'ON' : 'OFF';
      document.getElementById('autoPublishStatus').className = autoPublishEnabled ? 
        'text-2xl font-bold text-green-400 mb-1' : 
        'text-2xl font-bold text-red-400 mb-1';
    }
    
    function updatePostingSchedule(frequency) {
      const schedules = {
        'daily': 'Every day at optimal times',
        'twice-daily': 'Twice daily at peak hours',
        'every-other-day': 'Every other day',
        'weekly': 'Weekly on selected days'
      };
      
      showToast(`Posting schedule updated: ${schedules[frequency]}`, 'info');
    }
    
    function updateContentMix() {
      const selectedTypes = Array.from(document.querySelectorAll('input[type="checkbox"][value]:checked'))
        .map(cb => cb.value);
      
      showToast(`Content mix updated: ${selectedTypes.join(', ')}`, 'info');
    }
    
    // Floating Audio Player functionality
    function initializeFloatingPlayer() {
      const audioPlayer = document.getElementById('audioPlayer');
      const floatingPlayer = document.getElementById('floatingPlayer');
      const playPauseBtn = document.getElementById('playPause');
      const prevTrackBtn = document.getElementById('prevTrack');
      const nextTrackBtn = document.getElementById('nextTrack');
      const closePlayerBtn = document.getElementById('closePlayer');
      const progressBar = document.getElementById('progressBar');
      const progressFill = document.getElementById('progressFill');
      const volumeSlider = document.getElementById('volumeSlider');
      const currentTimeEl = document.getElementById('currentTime');
      const totalTimeEl = document.getElementById('totalTime');
      const trackTitleEl = document.getElementById('playerTrackTitle');
      const trackArtistEl = document.getElementById('playerTrackArtist');
      const trackListEl = document.getElementById('trackList');
      const queueItemsEl = document.getElementById('queueItems');
      
      // Play/Pause functionality
      playPauseBtn.addEventListener('click', togglePlayPause);
      
      // Track navigation
      prevTrackBtn.addEventListener('click', previousTrack);
      nextTrackBtn.addEventListener('click', nextTrack);
      
      // Close player
      closePlayerBtn.addEventListener('click', closePlayer);
      
      // Progress bar
      progressBar.addEventListener('click', seekTo);
      
      // Volume control
      volumeSlider.addEventListener('input', updateVolume);
      
      // Audio events
      audioPlayer.addEventListener('loadedmetadata', updateDuration);
      audioPlayer.addEventListener('timeupdate', updateProgress);
      audioPlayer.addEventListener('ended', onTrackEnded);
      audioPlayer.addEventListener('play', onPlay);
      audioPlayer.addEventListener('pause', onPause);
      
      // Initialize volume
      audioPlayer.volume = volume;
    }
    
    function showFloatingPlayer(trackData) {
      const floatingPlayer = document.getElementById('floatingPlayer');
      const trackTitleEl = document.getElementById('playerTrackTitle');
      const trackArtistEl = document.getElementById('playerTrackArtist');
      
      // Update track info
      trackTitleEl.textContent = trackData.title || 'Generated Track';
      trackArtistEl.textContent = trackData.artist || 'Son1kVers3';
      
      // Show player
      floatingPlayer.style.display = 'block';
      
      // Add to queue if not already there
      if (!trackQueue.find(track => track.id === trackData.id)) {
        trackQueue.push(trackData);
      }
      
      // Set as current track
      currentTrack = trackData;
      currentTrackIndex = trackQueue.findIndex(track => track.id === trackData.id);
      
      // Load audio
      loadTrack(trackData);
      
      // Update queue display
      updateQueueDisplay();
    }
    
    function loadTrack(trackData) {
      const audioPlayer = document.getElementById('audioPlayer');
      
      if (trackData.audioUrl) {
        audioPlayer.src = trackData.audioUrl;
        audioPlayer.load();
      } else if (trackData.audioBlob) {
        const url = URL.createObjectURL(trackData.audioBlob);
        audioPlayer.src = url;
        audioPlayer.load();
      }
    }
    
    function togglePlayPause() {
      const audioPlayer = document.getElementById('audioPlayer');
      const playIcon = document.getElementById('playIcon');
      const pauseIcon = document.getElementById('pauseIcon');
      
      if (isPlaying) {
        audioPlayer.pause();
      } else {
        audioPlayer.play();
      }
    }
    
    function onPlay() {
      isPlaying = true;
      const playIcon = document.getElementById('playIcon');
      const pauseIcon = document.getElementById('pauseIcon');
      
      playIcon.classList.add('hidden');
      pauseIcon.classList.remove('hidden');
      
      // Start visualizer animation
      startVisualizer();
    }
    
    function onPause() {
      isPlaying = false;
      const playIcon = document.getElementById('playIcon');
      const pauseIcon = document.getElementById('pauseIcon');
      
      playIcon.classList.remove('hidden');
      pauseIcon.classList.add('hidden');
      
      // Stop visualizer animation
      stopVisualizer();
    }
    
    function previousTrack() {
      if (trackQueue.length === 0) return;
      
      currentTrackIndex = (currentTrackIndex - 1 + trackQueue.length) % trackQueue.length;
      currentTrack = trackQueue[currentTrackIndex];
      
      loadTrack(currentTrack);
      updateTrackInfo();
      
      if (isPlaying) {
        audioPlayer.play();
      }
    }
    
    function nextTrack() {
      if (trackQueue.length === 0) return;
      
      currentTrackIndex = (currentTrackIndex + 1) % trackQueue.length;
      currentTrack = trackQueue[currentTrackIndex];
      
      loadTrack(currentTrack);
      updateTrackInfo();
      
      if (isPlaying) {
        audioPlayer.play();
      }
    }
    
    function onTrackEnded() {
      // Auto-play next track
      if (trackQueue.length > 1) {
        nextTrack();
      } else {
        onPause();
      }
    }
    
    function closePlayer() {
      const floatingPlayer = document.getElementById('floatingPlayer');
      const audioPlayer = document.getElementById('audioPlayer');
      
      audioPlayer.pause();
      floatingPlayer.style.display = 'none';
      
      // Stop visualizer
      stopVisualizer();
    }
    
    function seekTo(event) {
      const audioPlayer = document.getElementById('audioPlayer');
      const progressBar = document.getElementById('progressBar');
      const rect = progressBar.getBoundingClientRect();
      const clickX = event.clientX - rect.left;
      const percentage = clickX / rect.width;
      const newTime = percentage * duration;
      
      audioPlayer.currentTime = newTime;
    }
    
    function updateVolume(event) {
      const audioPlayer = document.getElementById('audioPlayer');
      volume = event.target.value / 100;
      audioPlayer.volume = volume;
    }
    
    function updateDuration() {
      const audioPlayer = document.getElementById('audioPlayer');
      duration = audioPlayer.duration;
      updateTimeDisplay();
    }
    
    function updateProgress() {
      const audioPlayer = document.getElementById('audioPlayer');
      currentTime = audioPlayer.currentTime;
      
      if (duration > 0) {
        const percentage = (currentTime / duration) * 100;
        const progressFill = document.getElementById('progressFill');
        progressFill.style.width = percentage + '%';
      }
      
      updateTimeDisplay();
    }
    
    function updateTimeDisplay() {
      const currentTimeEl = document.getElementById('currentTime');
      const totalTimeEl = document.getElementById('totalTime');
      
      currentTimeEl.textContent = formatTime(currentTime);
      totalTimeEl.textContent = formatTime(duration);
    }
    
    function formatTime(seconds) {
      if (isNaN(seconds)) return '0:00';
      
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    function updateTrackInfo() {
      const trackTitleEl = document.getElementById('playerTrackTitle');
      const trackArtistEl = document.getElementById('playerTrackArtist');
      
      if (currentTrack) {
        trackTitleEl.textContent = currentTrack.title || 'Generated Track';
        trackArtistEl.textContent = currentTrack.artist || 'Son1kVers3';
      }
    }
    
    function updateQueueDisplay() {
      const queueItemsEl = document.getElementById('queueItems');
      
      queueItemsEl.innerHTML = '';
      
      trackQueue.forEach((track, index) => {
        const trackItem = document.createElement('div');
        trackItem.className = `flex items-center space-x-2 p-2 rounded cursor-pointer hover:bg-gray-700 ${index === currentTrackIndex ? 'bg-gray-700' : ''}`;
        
        trackItem.innerHTML = `
          <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded flex items-center justify-center">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path d="M8 5v10l8-5-8-5z"/>
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <div class="text-white text-xs truncate">${track.title || 'Generated Track'}</div>
            <div class="text-gray-400 text-xs truncate">${track.artist || 'Son1kVers3'}</div>
          </div>
        `;
        
        trackItem.addEventListener('click', () => {
          currentTrackIndex = index;
          currentTrack = track;
          loadTrack(track);
          updateTrackInfo();
          
          if (isPlaying) {
            audioPlayer.play();
          }
        });
        
        queueItemsEl.appendChild(trackItem);
      });
    }
    
    function startVisualizer() {
      const waveform = document.getElementById('waveform');
      const bars = waveform.querySelectorAll('div');
      
      bars.forEach((bar, index) => {
        bar.style.animation = `pulse 0.5s ease-in-out infinite alternate`;
        bar.style.animationDelay = `${index * 0.1}s`;
      });
    }
    
    function stopVisualizer() {
      const waveform = document.getElementById('waveform');
      const bars = waveform.querySelectorAll('div');
      
      bars.forEach(bar => {
        bar.style.animation = 'none';
      });
    }
    
    // Global function to show player (called from other functions)
    window.showFloatingPlayer = showFloatingPlayer;
    
    // Nexus functionality
    function initializeNexus() {
      // Chat interface
      const nexusInput = document.getElementById('nexusInput');
      const nexusSend = document.getElementById('nexusSend');
      const nexusChat = document.getElementById('nexusChat');
      
      // AI Commands
      document.getElementById('analyzeThreats')?.addEventListener('click', analyzeThreats);
      document.getElementById('optimizeSystems')?.addEventListener('click', optimizeSystems);
      document.getElementById('generateStrategy')?.addEventListener('click', generateStrategy);
      document.getElementById('scanNetwork')?.addEventListener('click', scanNetwork);
      document.getElementById('deployCountermeasures')?.addEventListener('click', deployCountermeasures);
      
      // Advanced Operations
      document.getElementById('applyEnhancement')?.addEventListener('click', applyEnhancement);
      document.getElementById('startAnalysis')?.addEventListener('click', startAnalysis);
      document.getElementById('activateProtocols')?.addEventListener('click', activateProtocols);
      
      // Sliders
      const processingPower = document.getElementById('processingPower');
      const memoryAllocation = document.getElementById('memoryAllocation');
      
      if (processingPower) {
        processingPower.addEventListener('input', (e) => {
          document.getElementById('processingValue').textContent = e.target.value + '%';
        });
      }
      
      if (memoryAllocation) {
        memoryAllocation.addEventListener('input', (e) => {
          document.getElementById('memoryValue').textContent = e.target.value + '%';
        });
      }
      
      // Chat functionality
      if (nexusSend) {
        nexusSend.addEventListener('click', sendNexusMessage);
      }
      
      if (nexusInput) {
        nexusInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            sendNexusMessage();
          }
        });
      }
      
      // Initialize system status
      updateSystemStatus();
      
      // Start real-time updates
      setInterval(updateSystemStatus, 5000);
    }
    
    async function sendNexusMessage() {
      const input = document.getElementById('nexusInput');
      const chat = document.getElementById('nexusChat');
      const message = input.value.trim();
      
      if (!message) return;
      
      // Add user message to chat
      addChatMessage(`USER: ${message}`, 'text-cyan-400');
      input.value = '';
      
      try {
        // Call PIXEL AI backend
        const response = await fetch(`${API_BASE_URL}/api/nexus/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: message,
            context: 'nexus',
            user_id: userSession.user_id || 'anonymous',
            resistance_mode: true
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: ${data.response}`, 'text-green-400');
          
          // Update mission log
          addMissionLog(`PIXEL: Processed user command - ${message.substring(0, 50)}...`);
        } else {
          addChatMessage(`PIXEL: Error processing command - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Nexus chat error:', error);
        addChatMessage(`PIXEL: Connection error - ${error.message}`, 'text-red-400');
      }
    }
    
    function addChatMessage(message, className) {
      const chat = document.getElementById('nexusChat');
      const messageDiv = document.createElement('div');
      messageDiv.className = className;
      messageDiv.textContent = message;
      chat.appendChild(messageDiv);
      chat.scrollTop = chat.scrollHeight;
    }
    
    function addMissionLog(message) {
      const log = document.getElementById('missionLogContent');
      const timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19);
      const logEntry = document.createElement('div');
      logEntry.className = 'text-cyan-400';
      logEntry.textContent = `[${timestamp}] ${message}`;
      log.appendChild(logEntry);
      log.scrollTop = log.scrollHeight;
    }
    
    async function analyzeThreats() {
      showToast('Analyzing threats...', 'info');
      addMissionLog('NEXUS: Threat analysis initiated');
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/analyze-threats`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userSession.user_id || 'anonymous',
            analysis_depth: 'advanced'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: Threat analysis complete. ${data.threats_found} threats detected.`, 'text-yellow-400');
          addMissionLog(`PIXEL: Threat analysis completed - ${data.threats_found} threats found`);
          updateThreatLevel(data.threat_level);
        } else {
          addChatMessage(`PIXEL: Threat analysis failed - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Threat analysis error:', error);
        addChatMessage(`PIXEL: Threat analysis error - ${error.message}`, 'text-red-400');
      }
    }
    
    async function optimizeSystems() {
      showToast('Optimizing systems...', 'info');
      addMissionLog('NEXUS: System optimization initiated');
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/optimize-systems`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userSession.user_id || 'anonymous',
            optimization_level: 'maximum'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: System optimization complete. Performance improved by ${data.performance_improvement}%`, 'text-green-400');
          addMissionLog(`PIXEL: System optimization completed - ${data.performance_improvement}% improvement`);
          updateSystemStatus();
        } else {
          addChatMessage(`PIXEL: System optimization failed - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('System optimization error:', error);
        addChatMessage(`PIXEL: System optimization error - ${error.message}`, 'text-red-400');
      }
    }
    
    async function generateStrategy() {
      showToast('Generating strategy...', 'info');
      addMissionLog('NEXUS: Strategy generation initiated');
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/generate-strategy`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userSession.user_id || 'anonymous',
            strategy_type: 'resistance',
            context: 'music_generation'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: Strategy generated successfully. ${data.strategy_summary}`, 'text-cyan-400');
          addMissionLog(`PIXEL: Strategy generated - ${data.strategy_type}`);
        } else {
          addChatMessage(`PIXEL: Strategy generation failed - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Strategy generation error:', error);
        addChatMessage(`PIXEL: Strategy generation error - ${error.message}`, 'text-red-400');
      }
    }
    
    async function scanNetwork() {
      showToast('Scanning network...', 'info');
      addMissionLog('NEXUS: Network scan initiated');
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/scan-network`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userSession.user_id || 'anonymous',
            scan_type: 'deep'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: Network scan complete. ${data.nodes_found} nodes discovered.`, 'text-blue-400');
          addMissionLog(`PIXEL: Network scan completed - ${data.nodes_found} nodes found`);
        } else {
          addChatMessage(`PIXEL: Network scan failed - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Network scan error:', error);
        addChatMessage(`PIXEL: Network scan error - ${error.message}`, 'text-red-400');
      }
    }
    
    async function deployCountermeasures() {
      showToast('Deploying countermeasures...', 'info');
      addMissionLog('NEXUS: Countermeasures deployment initiated');
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/deploy-countermeasures`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userSession.user_id || 'anonymous',
            countermeasure_type: 'stealth'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: Countermeasures deployed successfully. ${data.protection_level}% protection active.`, 'text-green-400');
          addMissionLog(`PIXEL: Countermeasures deployed - ${data.protection_level}% protection`);
        } else {
          addChatMessage(`PIXEL: Countermeasures deployment failed - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Countermeasures deployment error:', error);
        addChatMessage(`PIXEL: Countermeasures deployment error - ${error.message}`, 'text-red-400');
      }
    }
    
    async function applyEnhancement() {
      const processingPower = document.getElementById('processingPower').value;
      const memoryAllocation = document.getElementById('memoryAllocation').value;
      
      showToast('Applying neural enhancement...', 'info');
      addMissionLog(`NEXUS: Neural enhancement initiated - Processing: ${processingPower}%, Memory: ${memoryAllocation}%`);
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/apply-enhancement`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userSession.user_id || 'anonymous',
            processing_power: parseInt(processingPower),
            memory_allocation: parseInt(memoryAllocation)
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: Neural enhancement applied successfully. Performance boosted by ${data.performance_boost}%`, 'text-cyan-400');
          addMissionLog(`PIXEL: Neural enhancement applied - ${data.performance_boost}% boost`);
          updateSystemStatus();
        } else {
          addChatMessage(`PIXEL: Neural enhancement failed - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Neural enhancement error:', error);
        addChatMessage(`PIXEL: Neural enhancement error - ${error.message}`, 'text-red-400');
      }
    }
    
    async function startAnalysis() {
      const analysisDepth = document.getElementById('analysisDepth').value;
      const targetSystem = document.getElementById('targetSystem').value;
      
      showToast('Starting quantum analysis...', 'info');
      addMissionLog(`NEXUS: Quantum analysis initiated - Depth: ${analysisDepth}, Target: ${targetSystem}`);
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/quantum-analysis`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userSession.user_id || 'anonymous',
            analysis_depth: analysisDepth,
            target_system: targetSystem
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: Quantum analysis complete. ${data.insights_found} insights discovered.`, 'text-blue-400');
          addMissionLog(`PIXEL: Quantum analysis completed - ${data.insights_found} insights`);
        } else {
          addChatMessage(`PIXEL: Quantum analysis failed - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Quantum analysis error:', error);
        addChatMessage(`PIXEL: Quantum analysis error - ${error.message}`, 'text-red-400');
      }
    }
    
    async function activateProtocols() {
      const protocols = {
        stealthMode: document.getElementById('stealthMode').checked,
        encryption: document.getElementById('encryption').checked,
        counterSurveillance: document.getElementById('counterSurveillance').checked,
        neuralFirewall: document.getElementById('neuralFirewall').checked
      };
      
      const activeProtocols = Object.entries(protocols).filter(([key, value]) => value).map(([key]) => key);
      
      if (activeProtocols.length === 0) {
        showToast('No protocols selected', 'warning');
        return;
      }
      
      showToast('Activating resistance protocols...', 'info');
      addMissionLog(`NEXUS: Resistance protocols activation initiated - ${activeProtocols.join(', ')}`);
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/activate-protocols`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userSession.user_id || 'anonymous',
            protocols: activeProtocols
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          addChatMessage(`PIXEL: Resistance protocols activated successfully. ${data.protection_level}% protection active.`, 'text-green-400');
          addMissionLog(`PIXEL: Resistance protocols activated - ${data.protection_level}% protection`);
        } else {
          addChatMessage(`PIXEL: Protocol activation failed - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Protocol activation error:', error);
        addChatMessage(`PIXEL: Protocol activation error - ${error.message}`, 'text-red-400');
      }
    }
    
    async function updateSystemStatus() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/nexus/status`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          // Update system status
          document.getElementById('pixelStatus').textContent = data.pixel_status;
          document.getElementById('neuralStatus').textContent = data.neural_status;
          document.getElementById('quantumStatus').textContent = data.quantum_status;
          document.getElementById('resistanceProtocol').textContent = data.resistance_protocol;
          
          // Update mission status
          document.getElementById('activeMissions').textContent = data.active_missions;
          document.getElementById('completedMissions').textContent = data.completed_missions;
          document.getElementById('successRate').textContent = data.success_rate + '%';
          document.getElementById('threatLevel').textContent = data.threat_level;
          
          // Update AI performance
          document.getElementById('responseTime').textContent = data.response_time + 's';
          document.getElementById('accuracy').textContent = data.accuracy + '%';
          document.getElementById('learningRate').textContent = data.learning_rate;
          document.getElementById('memoryUsage').textContent = data.memory_usage + '%';
          
        }
        
      } catch (error) {
        console.error('Status update error:', error);
        // Fallback to simulated data
        updateSystemStatusFallback();
      }
    }
    
    function updateSystemStatusFallback() {
      // Simulated status updates
      const statuses = ['ONLINE', 'ACTIVE', 'STABLE', 'ENABLED'];
      const missions = Math.floor(Math.random() * 5) + 1;
      const completed = Math.floor(Math.random() * 50) + 100;
      const successRate = (95 + Math.random() * 5).toFixed(1);
      const threatLevels = ['LOW', 'MODERATE', 'HIGH'];
      const responseTime = (0.1 + Math.random() * 0.5).toFixed(1);
      const accuracy = (95 + Math.random() * 5).toFixed(1);
      const learningRate = '+' + (10 + Math.random() * 5).toFixed(1) + '%';
      const memoryUsage = Math.floor(Math.random() * 30) + 50;
      
      document.getElementById('pixelStatus').textContent = statuses[0];
      document.getElementById('neuralStatus').textContent = statuses[1];
      document.getElementById('quantumStatus').textContent = statuses[2];
      document.getElementById('resistanceProtocol').textContent = statuses[3];
      
      document.getElementById('activeMissions').textContent = missions;
      document.getElementById('completedMissions').textContent = completed;
      document.getElementById('successRate').textContent = successRate + '%';
      document.getElementById('threatLevel').textContent = threatLevels[Math.floor(Math.random() * 3)];
      
      document.getElementById('responseTime').textContent = responseTime + 's';
      document.getElementById('accuracy').textContent = accuracy + '%';
      document.getElementById('learningRate').textContent = learningRate;
      document.getElementById('memoryUsage').textContent = memoryUsage + '%';
    }
    
    function updateThreatLevel(level) {
      const threatElement = document.getElementById('threatLevel');
      if (threatElement) {
        threatElement.textContent = level;
        threatElement.className = level === 'HIGH' ? 'text-red-400' : 
                                 level === 'MODERATE' ? 'text-yellow-400' : 'text-green-400';
      }
    }
    
    // Santuario (Resistance Social Network) functionality
    function initializeSantuario() {
      // Chat functionality
      const messageInput = document.getElementById('resistanceMessageInput');
      const sendButton = document.getElementById('resistanceSendMessage');
      
      if (sendButton) {
        sendButton.addEventListener('click', sendResistanceMessage);
      }
      
      if (messageInput) {
        messageInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            sendResistanceMessage();
          }
        });
      }
      
      // Collaboration functionality
      document.getElementById('createCollaboration')?.addEventListener('click', createCollaboration);
      
      // Initialize resistance data
      updateResistanceStatus();
      
      // Start real-time updates
      setInterval(updateResistanceStatus, 10000);
      setInterval(updateOnlineMembers, 5000);
    }
    
    async function sendResistanceMessage() {
      const input = document.getElementById('resistanceMessageInput');
      const messagesContainer = document.getElementById('resistanceChatMessages');
      const message = input.value.trim();
      
      if (!message) return;
      
      // Check if user has Pro or Premium access
      const userPlan = document.getElementById('userPlan')?.textContent || 'Free';
      if (userPlan === 'Free') {
        showToast('Solo miembros Pro y Premium pueden acceder al Santuario', 'error');
        return;
      }
      
      // Add user message to chat
      addResistanceMessage(`[${getCurrentTime()}] ${getUserDisplayName()}: ${message}`, 'text-cyan-400');
      input.value = '';
      
      try {
        // Call resistance chat backend
        const response = await fetch(`${API_BASE_URL}/api/resistance/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: message,
            user_id: userSession.user_id || 'anonymous',
            user_plan: userPlan,
            context: 'resistance_social'
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          // Add AI response
          addResistanceMessage(`[${getCurrentTime()}] PIXEL: ${data.response}`, 'text-green-400');
          
          // Update mission log
          addResistanceLog(`Mensaje enviado por ${getUserDisplayName()}: ${message.substring(0, 30)}...`);
        } else {
          addResistanceMessage(`[${getCurrentTime()}] SISTEMA: Error - ${data.error}`, 'text-red-400');
        }
        
      } catch (error) {
        console.error('Resistance chat error:', error);
        addResistanceMessage(`[${getCurrentTime()}] SISTEMA: Error de conexión`, 'text-red-400');
      }
    }
    
    function addResistanceMessage(message, className) {
      const messagesContainer = document.getElementById('resistanceChatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.className = className;
      messageDiv.textContent = message;
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function addResistanceLog(message) {
      // This would typically update a mission log somewhere
      console.log(`Resistance Log: ${message}`);
    }
    
    function getCurrentTime() {
      return new Date().toLocaleTimeString('en-US', { 
        hour12: false, 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit' 
      });
    }
    
    function getUserDisplayName() {
      // Get user's resistance name or fallback to username
      return userSession.username || 'Anonymous_Resistance';
    }
    
    async function createCollaboration() {
      const name = document.getElementById('collabName').value.trim();
      const description = document.getElementById('collabDescription').value.trim();
      const type = document.getElementById('collabType').value;
      const members = document.getElementById('collabMembers').value;
      
      if (!name || !description) {
        showToast('Por favor completa todos los campos requeridos', 'warning');
        return;
      }
      
      // Check if user has Pro or Premium access
      const userPlan = document.getElementById('userPlan')?.textContent || 'Free';
      if (userPlan === 'Free') {
        showToast('Solo miembros Pro y Premium pueden crear colaboraciones', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/resistance/create-collaboration`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: name,
            description: description,
            type: type,
            members_required: parseInt(members),
            creator_id: userSession.user_id || 'anonymous',
            creator_plan: userPlan
          })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          showToast('Colaboración creada exitosamente', 'success');
          addResistanceMessage(`[${getCurrentTime()}] SISTEMA: Nueva colaboración "${name}" creada por ${getUserDisplayName()}`, 'text-blue-400');
          
          // Clear form
          document.getElementById('collabName').value = '';
          document.getElementById('collabDescription').value = '';
          document.getElementById('collabMembers').value = '4';
          
          // Update collaboration list
          updateCollaborationList();
        } else {
          showToast(`Error al crear colaboración: ${data.error}`, 'error');
        }
        
      } catch (error) {
        console.error('Create collaboration error:', error);
        showToast('Error de conexión al crear colaboración', 'error');
      }
    }
    
    async function updateResistanceStatus() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/resistance/status`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          // Update member counts
          document.getElementById('proMembers').textContent = data.pro_members || 247;
          document.getElementById('premiumMembers').textContent = data.premium_members || 89;
          document.getElementById('onlineMembers').textContent = data.online_members || 23;
          document.getElementById('totalMembers').textContent = data.total_members || 336;
          
          // Update operations
          document.getElementById('activeOps').textContent = data.active_operations || 12;
          document.getElementById('completedOps').textContent = data.completed_operations || 156;
          document.getElementById('successRate').textContent = data.success_rate || '94.2%';
          document.getElementById('nextOp').textContent = data.next_operation || 'En 2h';
          
          // Update collaborations
          document.getElementById('activeCollabs').textContent = data.active_collaborations || 8;
          document.getElementById('completedCollabs').textContent = data.completed_collaborations || 43;
          document.getElementById('pendingCollabs').textContent = data.pending_collaborations || 5;
          document.getElementById('collabRate').textContent = data.collaboration_rate || '+23%';
          
          // Update XentriX threat
          document.getElementById('threatLevel').textContent = data.threat_level || 'ALTO';
          document.getElementById('detections').textContent = data.detections || 3;
          document.getElementById('countermeasures').textContent = data.countermeasures || 'ACTIVAS';
          document.getElementById('protection').textContent = data.protection_level || '87%';
          
        }
        
      } catch (error) {
        console.error('Resistance status update error:', error);
        // Fallback to simulated data
        updateResistanceStatusFallback();
      }
    }
    
    function updateResistanceStatusFallback() {
      // Simulated status updates
      const proMembers = 247 + Math.floor(Math.random() * 10);
      const premiumMembers = 89 + Math.floor(Math.random() * 5);
      const onlineMembers = 20 + Math.floor(Math.random() * 10);
      const totalMembers = proMembers + premiumMembers;
      
      const activeOps = 10 + Math.floor(Math.random() * 5);
      const completedOps = 150 + Math.floor(Math.random() * 20);
      const successRate = (90 + Math.random() * 10).toFixed(1);
      
      const activeCollabs = 6 + Math.floor(Math.random() * 5);
      const completedCollabs = 40 + Math.floor(Math.random() * 10);
      const pendingCollabs = 3 + Math.floor(Math.random() * 5);
      const collabRate = '+' + (15 + Math.random() * 15).toFixed(0) + '%';
      
      const threatLevels = ['BAJO', 'MODERADO', 'ALTO', 'CRÍTICO'];
      const threatLevel = threatLevels[Math.floor(Math.random() * 4)];
      const detections = Math.floor(Math.random() * 5);
      const protection = 80 + Math.floor(Math.random() * 20);
      
      document.getElementById('proMembers').textContent = proMembers;
      document.getElementById('premiumMembers').textContent = premiumMembers;
      document.getElementById('onlineMembers').textContent = onlineMembers;
      document.getElementById('totalMembers').textContent = totalMembers;
      
      document.getElementById('activeOps').textContent = activeOps;
      document.getElementById('completedOps').textContent = completedOps;
      document.getElementById('successRate').textContent = successRate + '%';
      document.getElementById('nextOp').textContent = 'En ' + (1 + Math.floor(Math.random() * 6)) + 'h';
      
      document.getElementById('activeCollabs').textContent = activeCollabs;
      document.getElementById('completedCollabs').textContent = completedCollabs;
      document.getElementById('pendingCollabs').textContent = pendingCollabs;
      document.getElementById('collabRate').textContent = collabRate;
      
      document.getElementById('threatLevel').textContent = threatLevel;
      document.getElementById('detections').textContent = detections;
      document.getElementById('countermeasures').textContent = 'ACTIVAS';
      document.getElementById('protection').textContent = protection + '%';
    }
    
    function updateOnlineMembers() {
      const onlineMembersList = document.getElementById('onlineMembersList');
      if (!onlineMembersList) return;
      
      const members = [
        { name: 'Resistance_Alpha', status: 'online' },
        { name: 'Pixel_Pro', status: 'online' },
        { name: 'Ghost_Master', status: 'away' },
        { name: 'Quantum_Beat', status: 'online' },
        { name: 'Neon_Synth', status: 'online' },
        { name: 'Cyber_Punk', status: 'online' },
        { name: 'Digital_Rebel', status: 'away' },
        { name: 'Sound_Hacker', status: 'online' }
      ];
      
      // Shuffle and take random subset
      const shuffled = members.sort(() => 0.5 - Math.random());
      const onlineCount = 3 + Math.floor(Math.random() * 4);
      const onlineSubset = shuffled.slice(0, onlineCount);
      
      onlineMembersList.innerHTML = onlineSubset.map(member => {
        const statusColor = member.status === 'online' ? 'bg-green-400' : 'bg-yellow-400';
        const nameColor = member.name === 'Resistance_Alpha' ? 'text-cyan-400' :
                         member.name === 'Pixel_Pro' ? 'text-green-400' :
                         member.name === 'Ghost_Master' ? 'text-yellow-400' :
                         member.name === 'Quantum_Beat' ? 'text-blue-400' : 'text-purple-400';
        
        return `
          <div class="flex items-center justify-between ${nameColor}">
            <span>${member.name}</span>
            <span class="w-2 h-2 ${statusColor} rounded-full"></span>
          </div>
        `;
      }).join('');
    }
    
    function updateCollaborationList() {
      // This would update the active collaborations list
      // For now, we'll just add a new message to the chat
      addResistanceMessage(`[${getCurrentTime()}] SISTEMA: Lista de colaboraciones actualizada`, 'text-blue-400');
    }
    
    function generateAlgorithmAnalysis(contentDescription) {
      // Analyze content description to generate algorithm-specific insights
      const description = contentDescription.toLowerCase();
      
      // Instagram Algorithm Analysis
      const instagramScore = {
        engagement: description.includes('video') ? '15.2%' : '12.5%',
        reach: description.includes('behind') ? '9.1/10' : '8.7/10',
        timing: '9.2/10',
        content: description.includes('educational') ? '9.3/10' : '8.9/10',
        hashtags: '7.8/10',
        stories: '9.1/10'
      };
      
      // TikTok Algorithm Analysis
      const tiktokScore = {
        completion: description.includes('short') ? '92%' : '85%',
        viral: description.includes('trending') ? '9.7/10' : '9.3/10',
        sound: description.includes('music') ? '9.2/10' : '8.5/10',
        hook: description.includes('tutorial') ? '9.8/10' : '9.7/10',
        trend: description.includes('behind') ? '9.1/10' : '8.8/10',
        retention: description.includes('educational') ? '95%' : '92%'
      };
      
      // YouTube Algorithm Analysis
      const youtubeScore = {
        ctr: description.includes('tutorial') ? '9.1%' : '8.2%',
        retention: description.includes('educational') ? '82%' : '78%',
        seo: description.includes('tutorial') ? '9.5/10' : '9.1/10',
        thumbnail: description.includes('behind') ? '9.2/10' : '8.7/10',
        title: description.includes('tutorial') ? '9.4/10' : '9.0/10',
        engagement: description.includes('music') ? '7.8%' : '6.8%'
      };
      
      // Twitter Algorithm Analysis
      const twitterScore = {
        engagement: description.includes('trending') ? '5.1%' : '4.2%',
        retweet: description.includes('behind') ? '9.2/10' : '8.9/10',
        reply: description.includes('educational') ? '8.1/10' : '7.5/10',
        timing: '8.3/10',
        hashtags: '6.8/10',
        trend: description.includes('trending') ? '9.5/10' : '9.1/10'
      };
      
      // LinkedIn Algorithm Analysis
      const linkedinScore = {
        engagement: description.includes('professional') ? '4.8%' : '3.8%',
        professional: description.includes('educational') ? '9.5/10' : '9.2/10',
        content: description.includes('tutorial') ? '9.1/10' : '8.7/10',
        network: '8.9/10',
        timing: '9.0/10',
        comment: description.includes('educational') ? '9.0/10' : '8.5/10'
      };
      
      // Facebook Algorithm Analysis
      const facebookScore = {
        engagement: description.includes('video') ? '3.2%' : '2.1%',
        reach: description.includes('live') ? '8.9/10' : '7.8/10',
        video: description.includes('video') ? '9.5/10' : '8.9/10',
        live: description.includes('behind') ? '9.7/10' : '9.3/10',
        group: '8.6/10',
        comment: description.includes('educational') ? '8.8/10' : '8.2/10'
      };
      
      return {
        instagram: instagramScore,
        tiktok: tiktokScore,
        youtube: youtubeScore,
        twitter: twitterScore,
        linkedin: linkedinScore,
        facebook: facebookScore,
        recommendations: generateAlgorithmRecommendations(description),
        predictions: generatePerformancePredictions(description)
      };
    }
    
    function updateAlgorithmAnalysis(algorithmData) {
      // Update Instagram scores
      document.getElementById('igEngagement').textContent = algorithmData.instagram.engagement;
      document.getElementById('igReach').textContent = algorithmData.instagram.reach;
      document.getElementById('igTiming').textContent = algorithmData.instagram.timing;
      document.getElementById('igContent').textContent = algorithmData.instagram.content;
      document.getElementById('igHashtags').textContent = algorithmData.instagram.hashtags;
      document.getElementById('igStories').textContent = algorithmData.instagram.stories;
      
      // Update TikTok scores
      document.getElementById('ttCompletion').textContent = algorithmData.tiktok.completion;
      document.getElementById('ttViral').textContent = algorithmData.tiktok.viral;
      document.getElementById('ttSound').textContent = algorithmData.tiktok.sound;
      document.getElementById('ttHook').textContent = algorithmData.tiktok.hook;
      document.getElementById('ttTrend').textContent = algorithmData.tiktok.trend;
      document.getElementById('ttRetention').textContent = algorithmData.tiktok.retention;
      
      // Update YouTube scores
      document.getElementById('ytCTR').textContent = algorithmData.youtube.ctr;
      document.getElementById('ytRetention').textContent = algorithmData.youtube.retention;
      document.getElementById('ytSEO').textContent = algorithmData.youtube.seo;
      document.getElementById('ytThumbnail').textContent = algorithmData.youtube.thumbnail;
      document.getElementById('ytTitle').textContent = algorithmData.youtube.title;
      document.getElementById('ytEngagement').textContent = algorithmData.youtube.engagement;
      
      // Update Twitter scores
      document.getElementById('twEngagement').textContent = algorithmData.twitter.engagement;
      document.getElementById('twRetweet').textContent = algorithmData.twitter.retweet;
      document.getElementById('twReply').textContent = algorithmData.twitter.reply;
      document.getElementById('twTiming').textContent = algorithmData.twitter.timing;
      document.getElementById('twHashtags').textContent = algorithmData.twitter.hashtags;
      document.getElementById('twTrend').textContent = algorithmData.twitter.trend;
      
      // Update LinkedIn scores
      document.getElementById('liEngagement').textContent = algorithmData.linkedin.engagement;
      document.getElementById('liProfessional').textContent = algorithmData.linkedin.professional;
      document.getElementById('liContent').textContent = algorithmData.linkedin.content;
      document.getElementById('liNetwork').textContent = algorithmData.linkedin.network;
      document.getElementById('liTiming').textContent = algorithmData.linkedin.timing;
      document.getElementById('liComment').textContent = algorithmData.linkedin.comment;
      
      // Update Facebook scores
      document.getElementById('fbEngagement').textContent = algorithmData.facebook.engagement;
      document.getElementById('fbReach').textContent = algorithmData.facebook.reach;
      document.getElementById('fbVideo').textContent = algorithmData.facebook.video;
      document.getElementById('fbLive').textContent = algorithmData.facebook.live;
      document.getElementById('fbGroup').textContent = algorithmData.facebook.group;
      document.getElementById('fbComment').textContent = algorithmData.facebook.comment;
      
      // Update recommendations
      if (algorithmData.recommendations) {
        document.getElementById('highImpact1').textContent = algorithmData.recommendations.highImpact[0];
        document.getElementById('highImpact2').textContent = algorithmData.recommendations.highImpact[1];
        document.getElementById('highImpact3').textContent = algorithmData.recommendations.highImpact[2];
        document.getElementById('highImpact4').textContent = algorithmData.recommendations.highImpact[3];
        
        document.getElementById('contentStrategy1').textContent = algorithmData.recommendations.contentStrategy[0];
        document.getElementById('contentStrategy2').textContent = algorithmData.recommendations.contentStrategy[1];
        document.getElementById('contentStrategy3').textContent = algorithmData.recommendations.contentStrategy[2];
        document.getElementById('contentStrategy4').textContent = algorithmData.recommendations.contentStrategy[3];
      }
      
      // Update predictions
      if (algorithmData.predictions) {
        document.getElementById('predictedReach').textContent = algorithmData.predictions.reach;
        document.getElementById('predictedEngagement').textContent = algorithmData.predictions.engagement;
        document.getElementById('predictedFollowers').textContent = algorithmData.predictions.followers;
      }
    }
    
    function generateAlgorithmRecommendations(description) {
      const desc = description.toLowerCase();
      
      const highImpact = [
        "• Post at 6:30 PM for 23% higher engagement",
        "• Use 3-5 hashtags for optimal reach",
        "• Include call-to-action in 80% of posts",
        "• Post Stories 2x daily for algorithm boost"
      ];
      
      let contentStrategy = [
        "• Video content performs 3.2x better",
        "• Educational posts get 45% more saves",
        "• Behind-the-scenes content drives engagement",
        "• User-generated content increases reach by 28%"
      ];
      
      if (desc.includes('music')) {
        contentStrategy[0] = "• Music content gets 4.1x more engagement";
        contentStrategy[1] = "• Behind-the-scenes studio content performs best";
      }
      
      if (desc.includes('tutorial')) {
        contentStrategy[0] = "• Tutorial content has 5.2x higher retention";
        contentStrategy[1] = "• Step-by-step posts get 67% more saves";
      }
      
      return {
        highImpact: highImpact,
        contentStrategy: contentStrategy
      };
    }
    
    function generatePerformancePredictions(description) {
      const desc = description.toLowerCase();
      
      let reach = "+127%";
      let engagement = "+89%";
      let followers = "+156%";
      
      if (desc.includes('video')) {
        reach = "+189%";
        engagement = "+134%";
        followers = "+203%";
      }
      
      if (desc.includes('tutorial')) {
        reach = "+156%";
        engagement = "+112%";
        followers = "+178%";
      }
      
      if (desc.includes('music')) {
        reach = "+198%";
        engagement = "+145%";
        followers = "+234%";
      }
      
      return {
        reach: reach,
        engagement: engagement,
        followers: followers
      };
    }
    
    // Clone Station functionality
    function initializeCloneStation() {
      // DAW Integration buttons
      document.querySelectorAll('#dawIntegration .console-button').forEach(button => {
        button.addEventListener('click', (e) => {
          const daw = e.target.closest('.text-center').querySelector('h4').textContent;
          installDAWPlugin(daw);
        });
      });
      
      // Streaming Platform buttons
      document.querySelectorAll('#streamingIntegration .console-button').forEach(button => {
        button.addEventListener('click', (e) => {
          const platform = e.target.closest('.text-center').querySelector('h4').textContent;
          uploadToPlatform(platform);
        });
      });
      
      // Auto upload checkbox
      const autoUpload = document.getElementById('autoUpload');
      if (autoUpload) {
        autoUpload.addEventListener('change', (e) => {
          updateAutoUploadStatus(e.target.checked);
        });
      }
    }
    
    function installDAWPlugin(daw) {
      showToast(`Installing Son1kVers3 plugin for ${daw}...`, 'info');
      
      // Get plugin format based on DAW
      const pluginFormats = {
        'Ableton Live': 'VST3',
        'Logic Pro': 'AU',
        'FL Studio': 'VST3',
        'Studio One': 'VST3',
        'Pro Tools': 'AAX'
      };
      
      const format = pluginFormats[daw] || 'VST3';
      
      // Simulate plugin installation
      setTimeout(() => {
        showToast(`${daw} plugin (${format}) installed successfully!`, 'success');
        
        // Show specific installation instructions for Studio One
        if (daw === 'Studio One') {
          showToast('Studio One: Restart the application and check VST3 folder', 'info');
        }
        
        // Update DAW status
        const statusDot = document.querySelector('#dawIntegration .bg-red-500');
        const statusText = document.querySelector('#dawIntegration .text-gray-400');
        
        if (statusDot && statusText) {
          statusDot.className = 'w-3 h-3 bg-green-500 rounded-full';
          statusText.textContent = 'Connected';
        }
      }, 2000);
    }
    
    function uploadToPlatform(platform) {
      showToast(`Uploading track to ${platform}...`, 'info');
      
      // Simulate upload process
      setTimeout(() => {
        showToast(`Track uploaded to ${platform} successfully!`, 'success');
      }, 3000);
    }
    
    function updateAutoUploadStatus(enabled) {
      if (enabled) {
        showToast('Auto-upload enabled. Generated tracks will be automatically uploaded to selected platforms.', 'info');
      } else {
        showToast('Auto-upload disabled. You will need to manually upload tracks.', 'info');
      }
    }
  </script>
</body>
</html>